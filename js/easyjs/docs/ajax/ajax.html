<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>ajax - easy.js docs</title>
<link rel="stylesheet" href="../assets/style.css" />
</head>
<body>
<div class="slidebar">
    <div class="top_box">
        <h1 class="logo">easy</h1>
        <h2 class="sub_logo">.js</h2>
    </div>

    <h3 class="page_title">Docs<span class="ver">Version : 0.8.0</span></h3>
    
        <ul class="menu_left">
        <li><a href="../index.html">速查表</a></li>
        <li><a href="../easy/index.html">种子</a></li>
        <li><a href="../lang/index.html">语言扩展</a></li>
        <li><a href="../support/index.html">特征嗅探</a></li>
        <li><a href="../data/index.html">数据存储</a></li>
        <li><a href="../selector/index.html">选择器</a></li>
        <li><a href="../node/index.html">节点</a></li>
        <li><a href="../attr/index.html">属性</a></li>
        <li><a href="../css/index.html">样式</a></li>        
        <li><a href="../event/index.html">事件</a></li>
        <li><a href="../promise/index.html">异步回调</a></li>
        <li><a href="../anim/index.html">动画</a></li>
        <li class="current"><a href="index.html">数据交互</a></li>
    </ul>
</div>

<div class="content">
    <div class="caption"><h2>ajax( <span>options</span> )</h2><span class="type static">静态方法</span><span class="file">Define in : ajax.js</span></div>
    <div class="mod_desc">
        <p>数据交互模块的基础方法，该方法可配置的参数很多，其他的简单易用的方法 <a href="get.html">get</a>、<a href="getJSON.html">getJSON</a>、<a href="post.html">post</a> 都是通过该方法实现的。</p>
    </div>
    
    <div class="params_box">
        <h5>参数</h5>
        <ul class="params_list">
            <li>
                <dl>
                    <dt>options</dt>
                    <dd>Object</dd>
                </dl>
                <div class="params_desc">
                    <span class="type required">必需</span>
                    <p>由于可配置的参数较多，具体的参数说明请看下表。</p>
                </div>
            </li>
        </ul>
    </div>
        
    <table class="props_tb">
        <colgroup>
            <col style="width:120px" />
            <col style="width:100px" />
            <col style="width:450px" />
        </colgroup>
        <thead>
            <tr class="even">
                <th>参数</th>
                <th>数据类型</th>
                <th>说明</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><b class="name">async</b></td>
                <td><span class="type">Boolean</span></td>
                <td class="t_l">
                    <p>是否发起异步请求，为 true 为异步请求，为 false 时，将发起同步请求。同步请求将锁住浏览器，用户其它操作必须等待请求完成才可以执行。默认为 true。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">cache</b></td>
                <td><span class="type">Boolean</span></td>
                <td class="t_l">
                    <p>是否缓存请求，dataType 为 script 和 jsonp 时默认为 false，否则为 true。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">contentType</b></td>
                <td><span class="type">String</span></td>
                <td class="t_l">
                    <p>发送请求到服务端时内容的编码类型。默认值适合大多数情况。默认值为 application/x-www-form-urlencoded; charset=UTF-8。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">context</b></td>
                <td><span class="type">Object</span></td>
                <td class="t_l">
                    <p>回调函数的 this 指针，如果没有设置，默认为 ajax 请求时的 options 参数。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">data</b></td>
                <td><span class="type">String | Object</span></td>
                <td class="t_l">
                    <p>发送到服务端的数据，非 POST 请求，如果是 key/value 形式的数据，将转换成编码过的URI。比如 { foo1 : 'bar1', foo2 : 'bar2' } 将转换成 foo1=bar1&foo2=bar2，如果是字符串形式的参数必须按照这种规则来传参。POST 请求是通过 send 方法来发送数据，无需转换。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">dataType</b></td>
                <td><span class="type">String</span></td>
                <td class="t_l">
                    <p>希望服务端返回的数据类型，该参数必须指定。可用值如下：</p>
                    <p><b>xml</b>&emsp;返回 XML 文档。</p>
                    <p><b>json</b>&emsp;返回 JSON 格式的数据。</p>
                    <p><b>jsonp</b>&emsp;返回 JSONP 格式的数据。</p>
                    <p><b>text</b>&emsp;返回纯文本字符串。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">end</b></td>
                <td><span class="type">Function</span></td>
                <td class="t_l">
                    <p>请求结束的回调函数，该函数接受两个参数，第一个参数是请求状态文本，第二个参数是模拟的 XMLHttpRequest 对象。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">failure</b></td>
                <td><span class="type">Function</span></td>
                <td class="t_l">
                    <p>请求失败的回调函数，该函数接受两个参数，第一个参数是请求状态文本，第二个参数是模拟的 XMLHttpRequest 对象。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">global</b></td>
                <td><span class="type">Boolean</span></td>
                <td class="t_l">
                    <p>是否触发全局 ajax 回调函数。设置为 false 将不会触发全局 AJAX 事件，默认为 true。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">headers</b></td>
                <td><span class="type">Object</span></td>
                <td class="t_l">
                    <p>添加额外的请求头信息，该设置是在 start 被调用前，如果想对其进行修改可以在 start 回调函数被调用时进行修改。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">ifModified</b></td>
                <td><span class="type">Boolean</span></td>
                <td class="t_l">
                    <p>是否仅在服务器数据改变时才获取新数据，使用 HTTP 请求的 Last-Modified 头信息和检查服务器指定的 etag 来确定数据没有被修改过。默认为 false。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">jsonp</b></td>
                <td><span class="type">String</span></td>
                <td class="t_l">
                    <p>在 jsonp 的请求中设置回调函数的名字，默认的函数名字是 callback。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">jsonpCallback</b></td>
                <td><span class="type">String</span></td>
                <td class="t_l">
                    <p>为 jsonp 的请求设置回调函数名，默认是随机的函数名。指定函数名更方便管理请求，如果要缓存 jsonp 的请求，可以将 cache 参数设置成 true，并指定该参数。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">mimeType</b></td>
                <td><span class="type">String</span></td>
                <td class="t_l">
                    <p>设置覆盖请求的 mime 信息。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">password</b></td>
                <td><span class="type">String</span></td>
                <td class="t_l">
                    <p>用于访问需要身份验证的请求的密码。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">parseData</b></td>
                <td><span class="type">Boolean</span></td>
                <td class="t_l">
                    <p>是否将 key/value 形式的 data 数据转换成 URI 格式的查询字符串。默认为 ture，如果是 false，将不会进行转换。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">scriptCharset</b></td>
                <td><span class="type">String</span></td>
                <td class="t_l">
                    <p>当请求类型为 script 或 jsonp 时，可以指定返回内容的编码，通常只在客户端和服务端编码不一致时才使用。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">start</b></td>
                <td><span class="type">Function</span></td>
                <td class="t_l">
                    <p>请求开始的回调函数，该函数接受一个参数，这个参数是模拟的 XMLHttpRequest 对象。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">success</b></td>
                <td><span class="type">Function</span></td>
                <td class="t_l">
                    <p>请求成功的回调函数，该函数接受三个参数，第一个参数是请求的数据，第二个参数是请求状态文本，第三个参数是模拟的 XMLHttpRequest 对象。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">timeout</b></td>
                <td><span class="type">Number</span></td>
                <td class="t_l">
                    <p>设置请求超时时间，单位为 ms。此设置将覆盖全局设置。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">type</b></td>
                <td><span class="type">String</span></td>
                <td class="t_l">
                    <p>指定请求方式，通常只有 GET 和 POST 请求，默认为 GET 请求。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">url</b></td>
                <td><span class="type">String</span></td>
                <td class="t_l">
                    <p>发送请求的 url 地址。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">username</b></td>
                <td><span class="type">String</span></td>
                <td class="t_l">
                    <p>用于访问需要身份验证的请求的用户名。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">xhr</b></td>
                <td><span class="type">Function</span></td>
                <td class="t_l">
                    <p>需要返回一个 XMLHttpRequest 对象。默认在IE下是 ActiveXObject 而其他情况下是 XMLHttpRequest。可以设置一个 XMLHttpRequest 对象，用于覆盖 easy.js 提供的对象。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">xhrFields</b></td>
                <td><span class="type">Object</span></td>
                <td class="t_l">
                    <p>用于设置一些原生 XMLHttpRequest 的属性和方法，该设置是在 start 函数被调用前。如果想对原生 XMLHttpRequest 的属性和方法进行修改可以在 start 回调函数被调用时进行修改。</p>
                </td>
            </tr>
        </tbody>
    </table>    
    
    <div class="returns_box">
        <h5>返回值</h5>
        <ul class="returns_list">
            <li>    
                <h6>promise object</h6>
                <p>返回一个 promise 实例，并且集合了模拟的 XMLHttpRequest 对象，具体的有属性和方法的详细说明请看下表。</p>
            </li>            
        </ul>
    </div>
    
    <table class="props_tb">
        <colgroup>
            <col style="width:180px" />
            <col style="width:80px" />
            <col style="width:410px" />
        </colgroup>
        <thead>
            <tr class="even">
                <th>属性名</th>
                <th>数据类型</th>
                <th>说明</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><b class="name">readyState</b></td>
                <td><span class="type">Number</span></td>
                <td class="t_l">
                    <p>HTTP 请求状态值。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">responseText</b></td>
                <td><span class="type">String</span></td>
                <td class="t_l">
                    <p>请求响应的文本内容。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">responseXML</b></td>
                <td><span class="type">XML</span></td>
                <td class="t_l">
                    <p>请求响应的 XML文档内容，只有在 dataType 的值是 xml 时才会返回 responseXML。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">status</b></td>
                <td><span class="type">Number</span></td>
                <td class="t_l">
                    <p>服务器返回的 HTTP 状态码。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">statusText</b></td>
                <td><span class="type">XML</span></td>
                <td class="t_l">
                    <p>服务器返回的 HTTP 状态文本。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">abort</b></td>
                <td><span class="type">Function</span></td>
                <td class="t_l">
                    <p>中断请求的方法，该方法接受一个 HTTP 状态文本的参数。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">getAllResponseHeaders</b></td>
                <td><span class="type">Function</span></td>
                <td class="t_l">
                    <p>将响应头信息以字符串格式返回。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">getResponseHeader</b></td>
                <td><span class="type">Function</span></td>
                <td class="t_l">
                    <p>建立响应头的哈希表。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">overrideMimeType</b></td>
                <td><span class="type">Function</span></td>
                <td class="t_l">
                    <p>覆盖响应头的 content-type，可配合 start 回调函数使用，可以在请求发起前修改 content-type。该方法接受一个 mimeType 字符串形式的参数。</p>
                </td>
            </tr>
            <tr class="even">
                <td><b class="name">setRequestHeader</b></td>
                <td><span class="type">Function</span></td>
                <td class="t_l">
                    <p>设置请求头。该方法接收两个参数，第一个参数是请求头的属性名，第二个参数是请求头的属性值。</p>
                </td>
            </tr>
            <tr>
                <td><b class="name">then</b></td>
                <td><span class="type">Function</span></td>
                <td class="t_l">
                    <p>给该 ajax 请求添加回调，具体使用请参考异步回调的 <a href="../promise/then.html">then</a> 的使用方法。传递给已完成的回调是一个数组，该数组的第一个元素是请求内容，第二个元素是状态文本，第三个元素是模拟的 xhr 对象。传递给已拒绝的回调函数同样是一个数组，该数组的第一个元素是状态文本，第二个参数是模拟的 xhr 对象。</p>
                </td>
            </tr>
        </tbody>
    </table>
    
    <div class="example_box">
        <h5>例子1</h5>
        <p>发起一个 GET 请求，期望服务器返回一组 json 数据。</p>    
        <div class="code_box">
            <pre>E.ajax({
    url : 'get1.php',
    type : 'GET',
    dataType : 'json',
    success : function( data ){
        console.log( data );  // 如果请求成功将输出一组 json 数据
    }
});</pre>
        </div>            
    </div>
    
    <div class="example_box">
        <h5>例子2</h5>
        <p>发起一个 GET 请求，并向服务器提交数据，期望服务器返回 HTML 字符串。</p>    
        <div class="code_box">
            <pre>E.ajax({
    url : 'get2.php',
    type : 'GET',
    data : { foo : 'bar' }
    dataType : 'text',
    success : function( data ){
        console.log( data );  // 如果请求成功将输出 HTML 字符串
    },
    failure : function( statusText ){
        console.log( statusText );  // 如果请求失败将输出失败的 HTTP 状态文本
    },
    end : function( statusText ){
        console.log( statusText );  // 无论请求成功还是失败都将输出失败的 HTTP 状态文本
    }
});</pre>
        </div>            
    </div>
    
    <div class="example_box">
        <h5>例子3</h5>
        <p>E.ajax 返回的是一个 promise 对象和 xhr 对象的集合体，所以可以给该方法很方便的绑定回调。</p>    
        <div class="code_box">
            <pre>E.ajax({
    url : 'get1.php',
    type : 'GET',
    dataType : 'json'
})
.then(function( arg ){
    // 请求成功的内容
    console.log( arg[0] ); 
    // 请求成功的状态文本
    console.log( arg[1] );
    // 模拟的xhr对象
    console.log( arg[2] );
}, function( arg ){
    // 请求失败的状态文本
    console.log( arg[0] );
    // 模拟的xhr对象
    console.log( arg[1] );
})</pre>
        </div>            
    </div>
    
</div>

</body>
</html>