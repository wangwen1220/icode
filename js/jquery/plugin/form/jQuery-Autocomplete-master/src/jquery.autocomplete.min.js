(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(jQuery)}}(function(d){var a=(function(){return{extend:function(f,e){return d.extend(f,e)},addEvent:function(f,e,g){if(f.addEventListener){f.addEventListener(e,g,false)}else{if(f.attachEvent){f.attachEvent("on"+e,g)}else{throw new Error("Browser doesn't support addEventListener or attachEvent")}}},removeEvent:function(f,e,g){if(f.removeEventListener){f.removeEventListener(e,g,false)}else{if(f.detachEvent){f.detachEvent("on"+e,g)}}},createNode:function(e){var f=document.createElement("div");f.innerHTML=e;return f.firstChild}}}()),c={ESC:27,TAB:9,RETURN:13,UP:38,DOWN:40};function b(f,e){var h=function(){},g=this,i={autoSelectFirst:false,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:b.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:false,onSearchStart:h,onSearchComplete:h,containerClass:"autocomplete-suggestions",tabDisabled:false,dataType:"text",lookupFilter:function(k,j,l){return k.value.toLowerCase().indexOf(l)!==-1},paramName:"query",transformResult:function(j){return typeof j==="string"?d.parseJSON(j):j}};g.element=f;g.el=d(f);g.suggestions=[];g.badQueries=[];g.selectedIndex=-1;g.currentValue=g.element.value;g.intervalId=0;g.cachedResponse=[];g.onChangeInterval=null;g.onChange=null;g.ignoreValueChange=false;g.isLocal=false;g.suggestionsContainer=null;g.options=d.extend({},i,e);g.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"};g.initialize();g.setOptions(e)}b.utils=a;d.Autocomplete=b;b.formatResult=function(e,g){var f=new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\"].join("|\\")+")","g"),h="("+g.replace(f,"\\$1")+")";return e.value.replace(new RegExp(h,"gi"),"<strong>$1</strong>")};b.prototype={killerFn:null,initialize:function(){var h=this,i="."+h.classes.suggestion,g=h.classes.selected,f=h.options,e;h.element.setAttribute("autocomplete","off");h.killerFn=function(j){if(d(j.target).closest("."+h.options.containerClass).length===0){h.killSuggestions();h.disableKillerFn()}};if(!f.width||f.width==="auto"){f.width=h.el.outerWidth()}h.suggestionsContainer=b.utils.createNode('<div class="'+f.containerClass+'" style="position: absolute; display: none;"></div>');e=d(h.suggestionsContainer);e.appendTo(f.appendTo).width(f.width);e.on("mouseover",i,function(){h.activate(d(this).data("index"))});e.on("mouseout",function(){h.selectedIndex=-1;e.children("."+g).removeClass(g)});e.on("click",i,function(){h.select(d(this).data("index"),false)});h.fixPosition();if(window.opera){h.el.on("keypress",function(j){h.onKeyPress(j)})}else{h.el.on("keydown",function(j){h.onKeyPress(j)})}h.el.on("keyup",function(j){h.onKeyUp(j)});h.el.on("blur",function(){h.onBlur()});h.el.on("focus",function(){h.fixPosition()})},onBlur:function(){this.enableKillerFn()},setOptions:function(g){var f=this,e=f.options;a.extend(e,g);f.isLocal=d.isArray(e.lookup);if(f.isLocal){e.lookup=f.verifySuggestionsFormat(e.lookup)}d(f.suggestionsContainer).css({"max-height":e.maxHeight+"px",width:e.width+"px","z-index":e.zIndex})},clearCache:function(){this.cachedResponse=[];this.badQueries=[]},disable:function(){this.disabled=true},enable:function(){this.disabled=false},fixPosition:function(){var e=this,f;if(e.options.appendTo!=="body"){return}f=e.el.offset();d(e.suggestionsContainer).css({top:(f.top+e.el.outerHeight())+"px",left:f.left+"px"})},enableKillerFn:function(){var e=this;d(document).on("click",e.killerFn)},disableKillerFn:function(){var e=this;d(document).off("click",e.killerFn)},killSuggestions:function(){var e=this;e.stopKillSuggestions();e.intervalId=window.setInterval(function(){e.hide();e.stopKillSuggestions()},300)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},onKeyPress:function(g){var f=this;if(!f.disabled&&!f.visible&&g.keyCode===c.DOWN&&f.currentValue){f.suggest();return}if(f.disabled||!f.visible){return}switch(g.keyCode){case c.ESC:f.el.val(f.currentValue);f.hide();break;case c.TAB:case c.RETURN:if(f.selectedIndex===-1){f.hide();return}f.select(f.selectedIndex,g.keyCode===c.RETURN);if(g.keyCode===c.TAB&&this.options.tabDisabled===false){return}break;case c.UP:f.moveUp();break;case c.DOWN:f.moveDown();break;default:return}g.stopImmediatePropagation();g.preventDefault()},onKeyUp:function(g){var f=this;if(f.disabled){return}switch(g.keyCode){case c.UP:case c.DOWN:return}clearInterval(f.onChangeInterval);if(f.currentValue!==f.el.val()){if(f.options.deferRequestBy>0){f.onChangeInterval=setInterval(function(){f.onValueChange()},f.options.deferRequestBy)}else{f.onValueChange()}}},onValueChange:function(){var e=this,f;clearInterval(e.onChangeInterval);e.currentValue=e.element.value;f=e.getQuery(e.currentValue);e.selectedIndex=-1;if(e.ignoreValueChange){e.ignoreValueChange=false;return}if(f.length<e.options.minChars){e.hide()}else{e.getSuggestions(f)}},getQuery:function(f){var e=this.options.delimiter,g;if(!e){return d.trim(f)}g=f.split(e);return d.trim(g[g.length-1])},getSuggestionsLocal:function(h){var g=this,e=h.toLowerCase(),f=g.options.lookupFilter;return{suggestions:d.grep(g.options.lookup,function(i){return f(i,h,e)})}},getSuggestions:function(h){var e,g=this,f=g.options;e=g.isLocal?g.getSuggestionsLocal(h):g.cachedResponse[h];if(e&&d.isArray(e.suggestions)){g.suggestions=e.suggestions;g.suggest()}else{if(!g.isBadQuery(h)){f.params[f.paramName]=h;f.onSearchStart.call(g.element,f.params);d.ajax({url:f.serviceUrl,data:f.params,type:f.type,dataType:f.dataType}).done(function(i){g.processResponse(i,h);f.onSearchComplete.call(g.element,h)})}}},isBadQuery:function(f){var g=this.badQueries,e=g.length;while(e--){if(f.indexOf(g[e])===0){return true}}return false},hide:function(){var e=this;e.visible=false;e.selectedIndex=-1;d(e.suggestionsContainer).hide()},suggest:function(){if(this.suggestions.length===0){this.hide();return}var i=this,k=i.options.formatResult,j=i.getQuery(i.currentValue),h=i.classes.suggestion,g=i.classes.selected,e=d(i.suggestionsContainer),f="";d.each(i.suggestions,function(m,l){f+='<div class="'+h+'" data-index="'+m+'">'+k(l,j)+"</div>"});e.html(f).show();i.visible=true;if(i.options.autoSelectFirst){i.selectedIndex=0;e.children().first().addClass(g)}},verifySuggestionsFormat:function(e){if(e.length&&typeof e[0]==="string"){return d.map(e,function(f){return{value:f,data:null}})}return e},processResponse:function(g,f){var i=this,h=i.options,e=h.transformResult(g,f);e.suggestions=i.verifySuggestionsFormat(e.suggestions);if(!h.noCache){i.cachedResponse[e[h.paramName]]=e;if(e.suggestions.length===0){i.badQueries.push(e[h.paramName])}}if(f===i.getQuery(i.currentValue)){i.suggestions=e.suggestions;i.suggest()}},activate:function(f){var i=this,j,h=i.classes.selected,e=d(i.suggestionsContainer),g=e.children();e.children("."+h).removeClass(h);i.selectedIndex=f;if(i.selectedIndex!==-1&&g.length>i.selectedIndex){j=g.get(i.selectedIndex);d(j).addClass(h);return j}return null},select:function(g,e){var h=this,f=h.suggestions[g];if(f){h.el.val(f);h.ignoreValueChange=e;h.hide();h.onSelect(g)}},moveUp:function(){var e=this;if(e.selectedIndex===-1){return}if(e.selectedIndex===0){d(e.suggestionsContainer).children().first().removeClass(e.classes.selected);e.selectedIndex=-1;e.el.val(e.currentValue);return}e.adjustScroll(e.selectedIndex-1)},moveDown:function(){var e=this;if(e.selectedIndex===(e.suggestions.length-1)){return}e.adjustScroll(e.selectedIndex+1)},adjustScroll:function(e){var g=this,k=g.activate(e),f,i,j,h=25;if(!k){return}f=k.offsetTop;i=d(g.suggestionsContainer).scrollTop();j=i+g.options.maxHeight-h;if(f<i){d(g.suggestionsContainer).scrollTop(f)}else{if(f>j){d(g.suggestionsContainer).scrollTop(f-g.options.maxHeight+h)}}g.el.val(g.getValue(g.suggestions[e].value))},onSelect:function(f){var h=this,g=h.options.onSelect,e=h.suggestions[f];h.el.val(h.getValue(e.value));if(d.isFunction(g)){g.call(h.element,e)}},getValue:function(h){var g=this,e=g.options.delimiter,f,i;if(!e){return h}f=g.currentValue;i=f.split(e);if(i.length===1){return h}return f.substr(0,f.length-i[i.length-1].length)+h}};d.fn.autocomplete=function(f,e){return this.each(function(){var i="autocomplete",h=d(this),g;if(typeof f==="string"){g=h.data(i);if(typeof g[f]==="function"){g[f](e)}}else{g=new b(this,f);h.data(i,g)}})}}));
