(function(b){var a={};a.config={hook:{AUTHOR:".J_Author",T_POPUP:".J_Tpopup",CM:".J_Cm",CM_FIELD:".J_CmFormField",CM_LIST_CONDITION:".J_CmListCondition",CM_LIST_ITEM:".J_CommentListItem",SINGLE_POST:".J_SinglePost",SINGLE_POST_TITLE:".J_SinglePostTitle",HISTORIES:".J_Histories",ALREADY_READ:".J_AlreadyRead",POST_TITLE:".J_Post_Title"},data:{EMAIL:"data-email",COMMENT_LIST_CONDITION:"data-comment-list-condition",ID:"data-id",DATA_HISTORIES:"data-histories"},cls:{BY_POST_AUTHOR:"bypostauthor",ALREADY_READ_TITLE:"already_read_title"},tpl:{T_POPUP:'<div class="popup-wrap J_Tpopup"><s class="popup-triangle"></s><div class="popup"><iframe width="100%" height="165" class="share_self"  frameborder="0" scrolling="no" src="http://service.t.sina.com.cn/widget/WeiboShow.php?width=0&height=165&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=0&isFans=1&uid={uid}&verifier={verifier}"></iframe></div></div>',HISTORIES:'<li data-id="{id}"><a href="{url}" target="_blank">{title}</a></li>'},authorWb:{"mohaiguyan12@126.com":["1653905027","bc8818e2"],"minghe36@126.com":["1653905027","bc8818e2"],"greenerieshu@gmail.com":["1649427365","cc8c1592"],"spikelinyu@163.com":["1867624004","0b6bb11b"],"xthsky@gmail.com":["1038409867","bd483efb"],"zhou2ting@gmial.com":["1848084744","2d9045fb"]},commentListCondition:{ALL:"all",AUTHOR:"author",READER:"reader",RECENT20:"recent-20"},IS_HAS_LOCAL_STORAGE:false};String.prototype.TFtpl=function(c){return this.replace(/{([^{}]*)}/g,function(e,d){var f=c[d];return typeof f==="string"?f:e})};a.Tpopup=function(c,e){var d=this;d.container=b(c);d.config=b.extend(a.Tpopup.DEFAULT_CONFIG,e)};a.Tpopup.DEFAULT_CONFIG={authorWb:a.config.authorWb,hook:a.config.hook.T_POPUP,tpl:a.config.tpl.T_POPUP,anim:{show:{top:"102px",opacity:1,display:"block"},hide:{top:"122px",opacity:0,display:"none"}}};a.Tpopup.boxCache={};a.Tpopup.prototype={_init:function(){var c=this;if(c.container.length==0){return false}},_create:function(c,l){var m=this,e=m.config,f=a.Tpopup.boxCache,h,i=e.tpl,d=b(c),k=l[0],j=l[1],g;if(f[k]){h=f[k];d.append(h)}else{g=i.TFtpl({uid:k,verifier:j});h=b(g).appendTo(d).clone();d.children(e.hook).css(e.anim.hide);f[k]=h}},show:function(c,g){var e=this,h=b(c),f=e.config,d=f.authorWb[g];if(h.children(f.hook).length==0){e._create(c,d)}h.children(f.hook).fadeIn("fast");e.anim(h.children(f.hook),"show")},hide:function(c){var d=this,f=b(c),e=d.config;d.anim(f.children(e.hook),"hide")},anim:function(c,e){var d=this,g={},f=d.config.anim;g=e=="show"&&f.show||f.hide;c.stop().animate(g,"normal",function(){if(e=="hide"){c.hide()}})}};a.localStorage={item:function(c,d){var e=null;if(a.localStorage.isSupportLocalStorage()){if(d){localStorage.setItem(c,d);e=d}else{e=localStorage.getItem(c)}}else{console.log("\u5a34\u5fda\ue74d\u9363\u3124\u7b09\u93c0\ue21b\u5bd4html5\u9428\u52ec\u6e70\u9366\u677f\u74e8\u934c\ufffd")}return e},removeItem:function(c){if(a.localStorage.isSupportLocalStorage()){localStorage.removeItem(c)}else{console.log("\u5a34\u5fda\ue74d\u9363\u3124\u7b09\u93c0\ue21b\u5bd4html5\u9428\u52ec\u6e70\u9366\u677f\u74e8\u934c\ufffd");return false}return true},isSupportLocalStorage:function(){var c=a.localStorage,d=c.IS_HAS_LOCAL_STORAGE;if(d==null){if(window.localStorage){d=c.IS_HAS_LOCAL_STORAGE=true}}return d},IS_HAS_LOCAL_STORAGE:null};a.CommentList=function(j){var d=a.config,g=d.hook,c=d.cls,f=d.commentListCondition,i=b(g.CM_LIST_ITEM),h,e=20;switch(j){case f.ALL:i.show();break;case f.AUTHOR:i.each(function(){if(!b(this).hasClass(c.BY_POST_AUTHOR)){b(this).hide()}else{b(this).show()}});break;case f.READER:i.each(function(){if(b(this).hasClass(c.BY_POST_AUTHOR)){b(this).hide()}else{b(this).show()}});break;case f.RECENT20:if(i.length<e){return false}h=i.length-e;i.each(function(k){if(k>=h){b(this).show()}else{b(this).hide()}});break}};a.Histories=function(d){var c=this;c.data=[];c.config=b.extend(a.Histories.DEFAULT_CONFIG,d);c._init()};a.Histories.DEFAULT_CONFIG={count:13,maxClearNumber:100,maxTitleLen:24,ls:a.localStorage,storeName:a.config.data.DATA_HISTORIES,tpl:a.config.tpl.HISTORIES};a.Histories.prototype={_init:function(){var d=this,c=d.config.ls;if(!c.isSupportLocalStorage()){return false}d.getData()},appendTo:function(c){var k=this,j=b(c),f="",e=k.data,d=k.config,i=d.maxTitleLen,h=d.tpl,g=d.count;if(j.length==0||e.length==0){return false}b.each(e,function(l){this.title=this.title.substr(0,i);f+=h.TFtpl(this);if(l>=g){return false}});return b(f).appendTo(j)},getData:function(){var e=this,f=e.config,d=f.ls,c=d.item(f.storeName);if(c){e.data=JSON.parse(c)}return e.data},save:function(g){var e=this,f=e.config,d=f.ls,c;if(typeof g=="object"){if(e.isExist(g.id)){return false}e._removeExceedPost();e.data.unshift(g);c=JSON.stringify(e.data);d.item(f.storeName,c)}return true},isExist:function(g){var d=this,f=d.data,e=false,c;if(f.length>0){b.each(f,function(){c=this.id;if(g==c){e=true;return false}})}return e},clear:function(){var d=this,e=d.config,c=e.ls;c.removeItem(e.storeName);d.data=[]},_removeExceedPost:function(){var c=this,d=c.config,e=d.maxClearNumber,f=c.data;if(f.length<e){return false}c.data.splice(e-1,f.length-e+1)}};b(function(){var o=a.config,h=o.hook,q=o.data,s=o.tpl,g=a.localStorage,i,l,f=b(h.CM),c=b(h.CM_LIST_CONDITION),t,m,p=b(h.SINGLE_POST),n=b(h.SINGLE_POST_TITLE),r,k,d,j,e=b(h.ALREADY_READ);if(b(h.AUTHOR).length>0){i=new a.Tpopup();b(h.AUTHOR).hover(function(){l=b(this).attr(q.EMAIL);i.show(this,l)},function(){i.hide(this)})}if(f.length>0){if(window.localStorage){b(h.CM_FIELD).bind("blur",function(){g.item(b(this).attr("id"),b(this).val())}).each(function(){t=g.item(b(this).attr("id"));if(t!=null){b(this).val(t)}})}}if(c.length>0){if(g.item(q.COMMENT_LIST_CONDITION)==null){g.item(q.COMMENT_LIST_CONDITION,o.commentListCondition.ALL)}c.bind("change",function(){var u=b(this).val();if(b(this).attr("checked")){a.CommentList(u);g.item(q.COMMENT_LIST_CONDITION,u)}}).each(function(){var u=b(this).val();g.item(q.COMMENT_LIST_CONDITION)==u&&b(this).attr("checked",true);if(b(this).attr("checked")){a.CommentList(u)}})}m=new a.Histories();m.appendTo(h.HISTORIES);if(e.length>0){e.each(function(){k=Number(b(this).attr(q.ID));if(m.isExist(k)){b(this).show();b(this).parents("article").find(h.POST_TITLE).addClass(o.cls.ALREADY_READ_TITLE)}})}if(p.length>0){r=n.text();d=location.href;k=Number(p.attr(q.ID));j={id:k,title:r,url:d};m.save(j)}})})(jQuery);
