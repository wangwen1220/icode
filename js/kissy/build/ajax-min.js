/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Nov 15 23:33
*/
KISSY.add("ajax",function(c,h,j){function k(e,g,d,b,f){c.isFunction(g)&&(b=d,d=g,g=i);return j({type:f||"get",url:e,data:g,success:d,dataType:b})}var i=void 0;c.mix(j,{serialize:h.serialize,get:k,post:function(e,g,d,b){c.isFunction(g)&&(b=d,d=g,g=i);return k(e,g,d,b,"post")},jsonp:function(e,g,d){c.isFunction(g)&&(d=g,g=i);return k(e,g,d,"jsonp")},getScript:c.getScript,getJSON:function(e,g,d){c.isFunction(g)&&(d=g,g=i);return k(e,g,d,"json")},upload:function(e,g,d,b,f){c.isFunction(d)&&(f=b,b=d,d=
i);return j({url:e,type:"post",dataType:f,form:g,data:d,success:b})}});c.mix(c,{Ajax:j,IO:j,ajax:j,io:j,jsonp:j.jsonp});return j},{requires:"ajax/form-serializer,ajax/base,ajax/xhr-transport,ajax/script-transport,ajax/jsonp,ajax/form,ajax/iframe-transport,ajax/methods".split(",")});
KISSY.add("ajax/base",function(c,h,j,k){function i(a){var e=a.context,f=a.ifModified;delete a.context;a=c.mix(c.clone(p),a,{deep:!0});a.context=e||a;var d,g=a.type,o=a.dataType,i;i=a.query=new c.Uri.Query;e=a.uri=n.resolve(a.url);"crossDomain"in a||(a.crossDomain=!a.uri.hasSameDomainAs(n));if(a.processData&&(d=a.data))c.isObject(d)?i.add(d):i.reset(d);g=a.type=g.toUpperCase();a.hasContent=!l.test(g);o=a.dataType=c.trim(o||"*").split(b);!("cache"in a)&&c.inArray(o[0],["script","jsonp"])&&(a.cache=
!1);var h;a.hasContent||(i.count()&&e.query.add(i),f&&(h=e.clone()),!1===a.cache&&e.query.set("_ksTS",c.now()+"_"+c.guid()));f&&(a.ifModifiedKeyUri=h||e.clone());return a}function e(a,b){g.fire(a,{ajaxConfig:b.config,xhr:b,io:b})}function g(b){function l(a){return function(l){if(h=f.timeoutTimer)clearTimeout(h),f.timeoutTimer=0;var d=b[a];d&&d.apply(v,l);e(a,f)}}var f=this;if(!b.url)return k;if(!(f instanceof g))return new g(b);a.call(f);b=i(b);c.mix(f,{responseData:null,config:b||{},timeoutTimer:null,
responseText:null,responseXML:null,responseHeadersString:"",responseHeaders:null,requestHeaders:{},readyState:0,state:0,statusText:null,status:0,transport:null,_defer:new c.Defer(this)});var d;e("start",f);d=new (q[b.dataType[0]]||q["*"])(f);f.transport=d;b.contentType&&f.setRequestHeader("Content-Type",b.contentType);var o=b.dataType[0],h,m,j=b.timeout,v=b.context,r=b.headers,n=b.accepts;f.setRequestHeader("Accept",o&&n[o]?n[o]+("*"===o?"":", */*; q=0.01"):n["*"]);for(m in r)f.setRequestHeader(m,
r[m]);if(b.beforeSend&&!1===b.beforeSend.call(v,f,b))return k;f.then(l("success"),l("error"));f.fin(l("complete"));f.readyState=1;e("send",f);b.async&&0<j&&(f.timeoutTimer=setTimeout(function(){f.abort("timeout")},1E3*j));try{f.state=1,d.send()}catch(s){2>f.state&&f._ioReady(-1,s)}return k}var d=/^(?:about|app|app\-storage|.+\-extension|file|widget)$/,b=/\s+/,f=function(a){return a},a=c.Promise,l=/^(?:GET|HEAD)$/,o,v=c.Uri,m=c.Env.host,s=m.document,m=m.location,n;if(m){try{o=m.href}catch(r){o=s.createElement("a"),
o.href="",o=o.href}n=new v(o)}var d=n&&d.test(n.getScheme()),q={},p={type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",async:!0,serializeArray:!0,processData:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":"*/*"},converters:{text:{json:h.parse,html:f,text:f,xml:c.parseXML}},contents:{xml:/xml/,html:/html/,json:/json/}};p.converters.html=p.converters.text;c.mix(g,j.Target);c.mix(g,{isLocal:d,setupConfig:function(a){c.mix(p,
a,{deep:!0})},setupTransport:function(a,b){q[a]=b},getTransport:function(a){return q[a]},getConfig:function(){return p}});return g},{requires:["json","event"]});
KISSY.add("ajax/form-serializer",function(c,h){function j(d){return d.replace(i,"\r\n")}var k=/^(?:select|textarea)/i,i=/\r?\n/g,e,g=/^(?:color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i;return e={serialize:function(d,b){return c.param(e.getFormData(d),void 0,void 0,b||!1)},getFormData:function(d){var b=[],f={};c.each(h.query(d),function(a){a=a.elements?c.makeArray(a.elements):[a];b.push.apply(b,a)});b=c.filter(b,function(a){return a.name&&!a.disabled&&
(a.checked||k.test(a.nodeName)||g.test(a.type))});c.each(b,function(a){var b=h.val(a),d,b=c.isArray(b)?c.map(b,j):j(b);(d=f[a.name])?(d&&!c.isArray(d)&&(d=f[a.name]=[d]),d.push.apply(d,c.makeArray(b))):f[a.name]=b});return f}}},{requires:["dom"]});
KISSY.add("ajax/form",function(c,h,j,k){h.on("start",function(c){var e,g,c=c.io.config;if(e=c.form)e=j.get(e),g=e.encoding||e.enctype,"multipart/form-data"!=g.toLowerCase()?(e=k.getFormData(e),c.hasContent?c.query.add(e):(c.uri.query.add(e),c.ifModifiedKeyUri&&c.ifModifiedKeyUri.query.add(e))):(e=c.dataType,c=e[0],"*"==c&&(c="text"),e.length=2,e[0]="iframe",e[1]=c)});return h},{requires:["./base","dom","./form-serializer"]});
KISSY.add("ajax/iframe-transport",function(c,h,j,k){function i(b){var f=c.guid("ajax-iframe"),a=h.getEmptyIframeSrc(),b=b.iframe=h.create("<iframe "+(a?' src="'+a+'" ':"")+' id="'+f+'" name="'+f+'" style="position:absolute;left:-9999px;top:-9999px;"/>');h.prepend(b,d.body||d.documentElement);return b}function e(b,f,a){var l=[],e,g,m,i,j=b.keys();c.each(j,function(j){var k=b.get(j);e=c.isArray(k);g=c.makeArray(k);for(m=0;m<g.length;m++)i=d.createElement("input"),i.type="hidden",i.name=j+(e&&a?"[]":
""),i.value=g[m],h.append(i,f),l.push(i)});return l}function g(b){this.io=b}var d=c.Env.host.document;k.setupConfig({converters:{iframe:k.getConfig().converters.text,text:{iframe:function(b){return b}},xml:{iframe:function(b){return b}}}});c.augment(g,{send:function(){var b=this,f=b.io,a=f.config,l,d,c=a.query,g=h.get(a.form);b.attrs={target:h.attr(g,"target")||"",action:h.attr(g,"action")||"",method:h.attr(g,"method")};b.form=g;d=i(f);h.attr(g,{target:d.id,action:a.uri.toString(a.serializeArray),
method:"post"});c.count()&&(l=e(c,g,a.serializeArray));b.fields=l;setTimeout(function(){j.on(d,"load error",b._callback,b);g.submit()},10)},_callback:function(b){var f=this.io,b=b.type,a,d=f.iframe;if(d)if(h.attr(this.form,this.attrs),h.remove(this.fields),j.detach(d),setTimeout(function(){h.remove(d)},30),f.iframe=null,"load"==b)try{if((a=d.contentWindow.document)&&a.body)f.responseText=c.trim(h.text(a.body)),c.startsWith(f.responseText,"<?xml")&&(f.responseText=void 0);f.responseXML=a&&a.XMLDocument?
a.XMLDocument:a;a?f._ioReady(200,"success"):f._ioReady(500,"parser error")}catch(e){f._ioReady(500,"parser error")}else"error"==b&&f._ioReady(500,"error")},abort:function(){this._callback({})}});k.setupTransport("iframe",g);return k},{requires:["dom","event","./base"]});
KISSY.add("ajax/jsonp",function(c,h){var j=c.Env.host;h.setupConfig({jsonp:"callback",jsonpCallback:function(){return c.guid("jsonp")}});h.on("start",function(h){var i=h.io,e=i.config,h=e.dataType;if("jsonp"==h[0]){var g,d=e.jsonpCallback,b=c.isFunction(d)?d():d,f=j[b];e.uri.query.set(e.jsonp,b);j[b]=function(a){1<arguments.length&&(a=c.makeArray(arguments));g=[a]};i.fin(function(){j[b]=f;if(void 0===f)try{delete j[b]}catch(a){}else g&&f(g[0])});i=i.converters=i.converters||{};i.script=i.script||
{};i.script.json=function(){return g[0]};h.length=2;h[0]="script";h[1]="json"}});return h},{requires:["./base"]});
KISSY.add("ajax/methods",function(c,h,j){function k(e){var g=e.responseText,d=e.responseXML,b=e.config,f=b.converters,a=e.converters||{},l,h,i=b.contents,m=b.dataType;if(g||d){for(b=e.mimeType||e.getResponseHeader("Content-Type");"*"==m[0];)m.shift();if(!m.length)for(l in i)if(i[l].test(b)){m[0]!=l&&m.unshift(l);break}m[0]=m[0]||"text";if("text"==m[0]&&g!==j)h=g;else if("xml"==m[0]&&d!==j)h=d;else{var k={text:g,xml:d};c.each(["text","xml"],function(b){var l=m[0];if((a[b]&&a[b][l]||f[b]&&f[b][l])&&
k[b])return m.unshift(b),h="text"==b?g:d,!1})}}i=m[0];for(b=1;b<m.length;b++){l=m[b];var n=a[i]&&a[i][l]||f[i]&&f[i][l];if(!n)throw"no covert for "+i+" => "+l;h=n(h);i=l}e.responseData=h}var i=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg;c.extend(h,c.Promise,{setRequestHeader:function(e,c){this.requestHeaders[e]=c;return this},getAllResponseHeaders:function(){return 2===this.state?this.responseHeadersString:null},getResponseHeader:function(c){var g,d;if(2===this.state){if(!(d=this.responseHeaders))for(d=this.responseHeaders=
{};g=i.exec(this.responseHeadersString);)d[g[1]]=g[2];g=d[c]}return g===j?null:g},overrideMimeType:function(c){this.state||(this.mimeType=c);return this},abort:function(c){c=c||"abort";this.transport&&this.transport.abort(c);this._ioReady(0,c);return this},getNativeXhr:function(){var c;if(c=this.transport)return c.nativeXhr},_ioReady:function(c,g){if(2!=this.state){this.state=2;this.readyState=4;var d;if(200<=c&&300>c||304==c)if(304==c)g="not modified",d=!0;else try{k(this),g="success",d=!0}catch(b){g=
"parser error"}else 0>c&&(c=0);this.status=c;this.statusText=g;this._defer[d?"resolve":"reject"]([this.responseData,g,this])}}})},{requires:["./base"]});
KISSY.add("ajax/script-transport",function(c,h,j,k){function i(c){if(!c.config.crossDomain)return new (h.getTransport("*"))(c);this.io=c;return 0}var e=c.Env.host,g=e.document;h.setupConfig({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{text:{script:function(d){c.globalEval(d);return d}}}});c.augment(i,{send:function(){var c=this,b,f=c.io.config,a=g.head||g.getElementsByTagName("head")[0]||
g.documentElement;c.head=a;b=g.createElement("script");c.script=b;b.async="async";f.scriptCharset&&(b.charset=f.scriptCharset);b.src=f.uri.toString(f.serializeArray);b.onerror=b.onload=b.onreadystatechange=function(a){a=a||e.event;c._callback((a.type||"error").toLowerCase())};a.insertBefore(b,a.firstChild)},_callback:function(c,b){var f=this.script,a=this.io,l=this.head;if(f&&(b||!f.readyState||/loaded|complete/.test(f.readyState)||"error"==c))f.onerror=f.onload=f.onreadystatechange=null,l&&f.parentNode&&
l.removeChild(f),this.head=this.script=k,!b&&"error"!=c?a._ioReady(200,"success"):"error"==c&&a._ioReady(500,"script error")},abort:function(){this._callback(0,1)}});h.setupTransport("script",i);return h},{requires:["./base","./xhr-transport"]});
KISSY.add("ajax/sub-domain-transport",function(c,h,j,k){function i(b){var c=b.config;this.io=b;c.crossDomain=!1}function e(){var b=this.io.config.uri.getHostname(),b=d[b];b.ready=1;j.detach(b.iframe,"load",e,this);this.send()}var g=c.Env.host.document,d={};c.augment(i,h.proto,{send:function(){var b=this.io.config,f=b.uri,a=f.getHostname(),l;l=d[a];var i="/sub_domain_proxy.html";b.xdr&&b.xdr.subDomain&&b.xdr.subDomain.proxy&&(i=b.xdr.subDomain.proxy);l&&l.ready?(this.nativeXhr=h.nativeXhr(0,l.iframe.contentWindow))&&
this.sendInternal():(l?b=l.iframe:(l=d[a]={},b=l.iframe=g.createElement("iframe"),k.css(b,{position:"absolute",left:"-9999px",top:"-9999px"}),k.prepend(b,g.body||g.documentElement),l=new c.Uri,l.setScheme(f.getScheme()),l.setPort(f.getPort()),l.setHostname(a),l.setPath(i),b.src=l.toString()),j.on(b,"load",e,this))}});return i},{requires:["./xhr-transport-base","event","dom"]});
KISSY.add("ajax/xdr-flash-transport",function(c,h,j){function k(a,c,d){f||(f=!0,a='<object id="'+g+'" type="application/x-shockwave-flash" data="'+a+'" width="0" height="0"><param name="movie" value="'+a+'" /><param name="FlashVars" value="yid='+c+"&uid="+d+'&host=KISSY.require(\'ajax\')" /><param name="allowScriptAccess" value="always" /></object>',c=b.createElement("div"),j.prepend(c,b.body||b.documentElement),c.innerHTML=a)}function i(a){this.io=a}var e={},g="io_swf",d,b=c.Env.host.document,f=
!1;c.augment(i,{send:function(){var a=this,b=a.io.config;k((b.xdr||{}).src||c.Config.base+"ajax/io.swf",1,1);d?(a._uid=c.guid(),e[a._uid]=a,d.send(b.uri.toString(b.serializeArray),{id:a._uid,uid:a._uid,method:b.type,data:b.hasContent&&b.query.toString(b.serializeArray)||{}})):setTimeout(function(){a.send()},200)},abort:function(){d.abort(this._uid)},_xdrResponse:function(a,b){var c,f=b.id,d=this.io;d.responseText=decodeURI(b.c.responseText);switch(a){case "success":c={status:200,statusText:"success"};
delete e[f];break;case "abort":delete e[f];break;case "timeout":case "transport error":case "failure":delete e[f],c={status:500,statusText:a}}c&&d._ioReady(c.status,c.statusText)}});h.applyTo=function(a,b,f){var a=b.split(".").slice(1),d=h;c.each(a,function(a){d=d[a]});d.apply(null,f)};h.xdrReady=function(){d=b.getElementById(g)};h.xdrResponse=function(a,b){var c=e[b.uid];c&&c._xdrResponse(a,b)};return i},{requires:["./base","dom"]});
KISSY.add("ajax/xhr-transport-base",function(c,h){function j(b,c){try{return new (c||k).XMLHttpRequest}catch(a){}}var k=c.Env.host,i=k.XDomainRequest,e={proto:{}},g={},d={};h.__lastModifiedCached=g;h.__eTagCached=d;e.nativeXhr=k.ActiveXObject?function(b,c){var a;if(b&&i)a=new i;else if(!(a=!h.isLocal&&j(b,c)))a:{try{a=new (c||k).ActiveXObject("Microsoft.XMLHTTP");break a}catch(d){}a=void 0}return a}:j;c.mix(e.proto,{sendInternal:function(){var b=this,c=b.io,a=c.config,e=b.nativeXhr,h=a.type,j=a.async,
k,s=a.crossDomain,n=c.mimeType,c=c.requestHeaders||{},r=a.serializeArray,q=a.uri.toString(r),p,t,u;if(p=a.ifModifiedKeyUri&&a.ifModifiedKeyUri.toString()){if(t=g[p])c["If-Modified-Since"]=t;if(t=d[p])c["If-None-Match"]=t}(k=a.username)?e.open(h,q,j,k,a.password):e.open(h,q,j);if(h=a.xhrFields)for(u in h)e[u]=h[u];n&&e.overrideMimeType&&e.overrideMimeType(n);!s&&!c["X-Requested-With"]&&(c["X-Requested-With"]="XMLHttpRequest");try{if(!s)for(u in c)e.setRequestHeader(u,c[u])}catch(w){}e.send(a.hasContent&&
a.query.toString(r)||null);!j||4==e.readyState?b._callback():i&&e instanceof i?(e.onload=function(){e.readyState=4;e.status=200;b._callback()},e.onerror=function(){e.readyState=4;e.status=500;b._callback()}):e.onreadystatechange=function(){b._callback()}},abort:function(){this._callback(0,1)},_callback:function(b,f){try{var a=this.nativeXhr,e=this.io,h=e.config;if(f||4==a.readyState)if(i&&a instanceof i?(a.onerror=c.noop,a.onload=c.noop):a.onreadystatechange=c.noop,f)4!==a.readyState&&a.abort();else{var j=
h.ifModifiedKeyUri&&h.ifModifiedKeyUri.toString(),k=a.status;i&&a instanceof i||(e.responseHeadersString=a.getAllResponseHeaders());if(j){var s=a.getResponseHeader("Last-Modified"),n=a.getResponseHeader("ETag");s&&(g[j]=s);n&&(d[n]=n)}var r=a.responseXML;r&&r.documentElement&&(e.responseXML=r);e.responseText=a.responseText;try{var q=a.statusText}catch(p){q=""}!k&&e.isLocal&&!h.crossDomain?k=e.responseText?200:404:1223===k&&(k=204);e._ioReady(k,q)}}catch(t){a.onreadystatechange=c.noop,f||e._ioReady(-1,
t)}}});return e},{requires:["./base"]});
KISSY.add("ajax/xhr-transport",function(c,h,j,k,i,e){var g=c.Env.host.XDomainRequest,d=j.nativeXhr();if(d){var b=function(a){var a=a.split("."),b=a.length,c=3<b?3:2;return b<c?a.join("."):a.reverse().slice(0,c).reverse().join(".")},f=function(a){var c=a.config,f=c.crossDomain,h=c.xdr||{};if(f){if(b(location.hostname)==b(c.uri.getHostname()))return new k(a);if(!("withCredentials"in d)&&("flash"===""+h.use||!g))return new i(a)}this.io=a;this.nativeXhr=j.nativeXhr(f);return e};c.augment(f,j.proto,{send:function(){this.sendInternal()}});
h.setupTransport("*",f)}return h},{requires:["./base","./xhr-transport-base","./sub-domain-transport","./xdr-flash-transport"]});
