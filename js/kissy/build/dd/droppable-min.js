/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Nov 14 21:50
*/
KISSY.add("dd/droppable/base",function(h,e,f,k){function g(){g.superclass.constructor.apply(this,arguments);this.addTarget(d);this._init()}var d=k.DDM,b=d.PREFIX_CLS;g.ATTRS={node:{setter:function(a){if(a)return e.one(a)}},groups:{value:!0}};h.extend(g,f,{getNodeFromTarget:function(a,c,b){var a=this.get("node"),d=a[0];return d==c||d==b?null:a},_init:function(){d._regDrop(this)},_active:function(){var a=d.get("activeDrag"),c=this.get("node"),j=this.get("groups"),a=a.get("groups");a:if(!0===j)j=1;else{for(var f in j)if(a[f]){j=
1;break a}j=0}j?(d._addValidDrop(this),c&&(c.addClass(b+"drop-active-valid"),d.cacheWH(c))):c&&c.addClass(b+"drop-active-invalid")},_deActive:function(){var a=this.get("node");a&&a.removeClass(b+"drop-active-valid").removeClass(b+"drop-active-invalid")},__getCustomEvt:function(a){return h.mix({drag:d.get("activeDrag"),drop:this},a)},_handleOut:function(){var a=this.__getCustomEvt();this.get("node").removeClass(b+"drop-over");this.fire("dropexit",a)},_handleEnter:function(a){a=this.__getCustomEvt(a);
a.drag._handleEnter(a);this.get("node").addClass(b+"drop-over");this.fire("dropenter",a)},_handleOver:function(a){a=this.__getCustomEvt(a);a.drag._handleOver(a);this.fire("dropover",a)},_end:function(){var a=this.__getCustomEvt();this.get("node").removeClass(b+"drop-over");this.fire("drophit",a)},destroy:function(){d._unRegDrop(this)}});return g},{requires:["node","base","dd/base"]});
KISSY.add("dd/droppable/delegate",function(h,e,f,k,g){function d(){var c=this.get("container"),b=[],d=this.get("selector");c.all(d).each(function(c){a.cacheWH(c);b.push(c)});this.__allNodes=b}function b(){b.superclass.constructor.apply(this,arguments);a.on("dragstart",d,this)}var a=e.DDM;h.extend(b,f,{destroy:function(){b.superclass.destroy.apply(this,arguments)},getNodeFromTarget:function(c,b,d){var f={left:c.pageX,top:c.pageY},c=this.__allNodes,e=0,g=Number.MAX_VALUE;c&&h.each(c,function(c){var i=
c[0];i===d||i===b||(i=a.region(c),a.inRegion(i,f)&&(i=a.area(i),i<g&&(g=i,e=c)))});e&&(this.setInternal("lastNode",this.get("node")),this.setInternal("node",e));return e},_handleOut:function(){b.superclass._handleOut.apply(this,arguments);this.setInternal("node",0);this.setInternal("lastNode",0)},_handleOver:function(a){var d=this.get("node"),e=b.superclass._handleOut,f=b.superclass._handleOver,g=b.superclass._handleEnter,h=this.get("lastNode");h[0]!==d[0]?(this.setInternal("node",h),e.apply(this,
arguments),this.setInternal("node",d),g.call(this,a)):f.call(this,a)},_end:function(){b.superclass._end.apply(this,arguments);this.setInternal("node",0)}},{ATTRS:{lastNode:{},selector:{},container:{setter:function(a){return g.one(a)}}}});return b},{requires:["dd/base","./base","dom","node"]});KISSY.add("dd/droppable",function(h,e,f,k){f.Delegate=k;e.Droppable=f;e.DroppableDelegate=k;return f},{requires:["dd/base","./droppable/base","./droppable/delegate"]});
