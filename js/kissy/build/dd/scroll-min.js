/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Nov 14 21:50
*/
KISSY.add("dd/scroll",function(c,e,f,o,m){function g(){g.superclass.constructor.apply(this,arguments);this[p]={}}var t=e.DDM,v=c.Env.host,u=c.stamp,w=100,p="__dd_scrolls";g.ATTRS={node:{valueFn:function(){return o.one(v)},setter:function(a){return o.one(a)}},rate:{value:[10,10]},diff:{value:[20,20]}};var q=c.isWindow;c.extend(g,f,{getRegion:function(a){return q(a[0])?{width:m.viewportWidth(),height:m.viewportHeight()}:{width:a.outerWidth(),height:a.outerHeight()}},getOffset:function(a){return q(a[0])?
{left:m.scrollLeft(),top:m.scrollTop()}:a.offset()},getScroll:function(a){return{left:a.scrollLeft(),top:a.scrollTop()}},setScroll:function(a,b){a.scrollLeft(b.left);a.scrollTop(b.top)},detachDrag:function(a){var b,c=this[p];if(!(b=u(a,1,"__dd-scroll-id-"))||!c[b])return this;c[b].fn();delete c[b];return this},destroy:function(){var a=this;c.each(a[p],function(b){a.detachDrag(b.drag)})},attachDrag:function(a){function b(){if(q(j[0]))return 0;var b=a.mousePos,c=t.region(j);return!t.inRegion(c,b)?(clearTimeout(n),
n=0,1):0}function f(i){!i.fake&&!b()&&(l=i,k=c.clone(a.mousePos),i=h.getOffset(j),k.left-=i.left,k.top-=i.top,n||m())}function g(){clearTimeout(n);n=null}function m(){if(!b()){var i=h.getRegion(j),f=i.width,i=i.height,d=h.getScroll(j),g=c.clone(d),e=!1;k.top-i>=-r[1]&&(d.top+=s[1],e=!0);k.top<=r[1]&&(d.top-=s[1],e=!0);k.left-f>=-r[0]&&(d.left+=s[0],e=!0);k.left<=r[0]&&(d.left-=s[0],e=!0);e?(h.setScroll(j,d),n=setTimeout(m,w),l.fake=!0,q(j[0])&&(d=h.getScroll(j),l.left+=d.left-g.left,l.top+=d.top-
g.top),a.get("move")&&a.get("node").offset(l),a.fire("drag",l)):n=null}}var h=this,j=h.get("node"),e=u(a,0,"__dd-scroll-id-"),o=h[p];if(o[e])return h;var s=h.get("rate"),r=h.get("diff"),l,k,n=null;a.on("drag",f);a.on("dragstart",function(){t.cacheWH(j)});a.on("dragend",g);o[e]={drag:a,fn:function(){a.detach("drag",f);a.detach("dragend",g)}};return h}});f=g.prototype;f.attach=f.attachDrag;f.unAttach=f.detachDrag;return e.Scroll=g},{requires:["dd/base","base","node","dom"]});
