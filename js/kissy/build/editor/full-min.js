/*
Copyright 2012, KISSY UI Library v1.40dev
MIT Licensed
build time: Nov 14 21:52
*/
/*
 thanks to CKSource's intelligent work on CKEditor
 @author yiminghe@gmail.com
*/
KISSY.add("editor/core/base",function(d,g,j){g=j.Controller.extend({initializer:function(){this.__commands={};this.__controls={}}},{Config:{},XHTML_DTD:g.DTD,ATTRS:{textarea:{},iframe:{},window:{},document:{},toolBarEl:{},statusBarEl:{},handleMouseEvents:{value:!1},focusable:{value:!1},mode:{value:1},data:{getter:function(){return this._getData()},setter:function(d){return this._setData(d)}},formatData:{getter:function(){return this._getData(1)},setter:function(d){return this._setData(d)}},customStyle:{value:""},
customLink:{value:[]}}},{xclass:"editor"});g.HTML_PARSER={textarea:function(d){return d.one("."+this.get("prefixCls")+"editor-textarea")}};d.mix(g,d.EventTarget);return KISSY.Editor=g},{requires:["htmlparser","component/base","core"]});
KISSY.add("editor/core/clipboard",function(d,g,j,i){function f(a){this.editor=a;this._init()}function a(a){if(e.ie&&"BackCompat"!=a.get("document")[0].compatMode){var m=a.getSelection(),b;if(m.getType()==i.SELECTION_ELEMENT&&(b=m.getSelectedElement())){var d=m.getRanges()[0],n=c(a.get("document")[0].createTextNode(""));n.insertBefore(b);d.setStartBefore(n);d.setEndAfter(b);m.selectRanges([d]);setTimeout(function(){b.parent()&&(n.remove(),m.selectElement(b))},0)}}}var c=d.all,e=d.UA,b=g.RANGE,o=d.Event;
d.augment(f,{_init:function(){var a=this.editor,b=a.get("document")[0].body;o.on(b,e.ie?"beforepaste":"paste",this._paste,this);o.on(b,"contextmenu",function(){m=1;setTimeout(function(){m=0},10)});a.addCommand("copy",new r("copy"));a.addCommand("cut",new r("cut"));a.addCommand("paste",new r("paste"))},_paste:function(){if(!m){var a=this.editor,k=a.get("document")[0];if(!k.getElementById("ke_pastebin")){var l=a.getSelection(),h=new j(k),n=c(e.webkit?"<body></body>":k.createElement("div"),null,k);n.attr("id",
"ke_pastebin");e.webkit&&n[0].appendChild(k.createTextNode("\u00a0"));k.body.appendChild(n[0]);n.css({position:"absolute",top:l.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});n.css("left","-1000px");var f=l.createBookmarks();h.setStartAt(n,b.POSITION_AFTER_START);h.setEndAt(n,b.POSITION_BEFORE_END);h.select(!0);setTimeout(function(){var m;n=e.webkit&&(m=n.first())&&m.hasClass("Apple-style-span")?m:n;l.selectBookmarks(f);n.remove();var b=n.html();if(b=d.trim(b.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,
"")))m=a.fire("paste",{html:b,holder:n}),void 0!==m&&(b=m),/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(b)?d.use("editor/plugin/word-filter/dynamic/",function(m,c){a.insertHtml(c.toDataFormat(b,a))}):a.insertHtml(b)},0)}}}});var h=function(a,m){var b=a.get("document")[0],d=c(b.body),n=!1,k=function(){n=!0};d.on(m,k);(7<e.ie?b:b.selection.createRange()).execCommand(m);d.detach(m,k);return n},k=e.ie?function(a,m){return h(a,m)}:function(a,m){try{return a.get("document")[0].execCommand(m)}catch(b){return!1}},
s={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},r=function(a){this.type=a};r.prototype={exec:function(m){"cut"==this.type&&a(m);(m=k(m,this.type))||alert(s[this.type]);return m}};var p={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"},m;return{init:function(a){a.docReady(function(){new f(a)});var m={copy:1,cut:1,paste:1};a.on("contextmenu",function(b){b=b.contextmenu;if(!b.__copy_fix){b.__copy_fix=
1;for(var c in m)b.addChild({xclass:"menuitem",content:p[c],value:c});b.on("click",function(b){var c=b.target.get("value");m[c]&&(this.hide(),setTimeout(function(){a.execCommand(c)},30))})}})}}},{requires:["./base","./range","./selection"]});
KISSY.add("editor/core/dom",function(d,g,j){function i(a,b){var c=a[b?"next":"prev"](f,1);if(c&&c[0].nodeType==e.ELEMENT_NODE){for(var l=[];c.attr("_ke_bookmark")||c._4e_isEmptyInlineRemovable(f);)if(l.push(c),c=b?c.next(f,1):c.prev(f,1),!c)return;if(a._4e_isIdentical(c,f)){for(var d=new o(b?a[0].lastChild:a[0].firstChild);l.length;)l.shift()._4e_move(a,!b,f);c._4e_moveChildren(a,!b,f);c.remove();d[0]&&d[0].nodeType==e.ELEMENT_NODE&&d._4e_mergeSiblings()}}}var f=f,a=g.XHTML_DTD,c=d.DOM,e=c.NodeType,
b=d.UA,o=d.Node,h={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};g.POSITION={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var k=g.POSITION,s={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,
"table-column":1,"table-cell":1,"table-caption":1},r={hr:1},p=function(a){return a&&(a[0]||a)};j.injectDom({_4e_sameLevel:function(a,b){var b=p(b),c=a.parentNode;return c&&c==b.parentNode},_4e_isBlockBoundary:function(a,b){var e=d.merge(r,b);return!(!s[c.css(a,"display")]&&!e[c.nodeName(a)])},_4e_index:function(a,b){for(var c=a.parentNode.childNodes,l,e=-1,n=0;n<c.length;n++)if(l=c[n],!b||!(3==l.nodeType&&l.previousSibling&&3==l.previousSibling.nodeType))if(e++,l===a)return e;return-1},_4e_move:function(a,
b,c){b=p(b);c?b.insertBefore(a,b.firstChild):b.appendChild(a)},_4e_isIdentical:function(a,b){if(!b)return!1;b=p(b);if(c.nodeName(a)!=c.nodeName(b))return!1;var e=a.attributes,l=b.attributes,d=e.length,n=l.length;if(d!=n)return!1;for(var k=0;k<d;k++){var h=e[k],f=h.name;if(h.specified&&c.attr(a,f)!=c.attr(b,f))return!1}if(8>j.ieEngine)for(k=0;k<n;k++)if(h=l[k],f=h.name,h.specified&&c.attr(a,f)!=c.attr(b,f))return!1;return!0},_4e_isEmptyInlineRemovable:function(b){if(!a.$removeEmpty[c.nodeName(b)])return!1;
for(var b=b.childNodes,q=0,k=b.length;q<k;q++){var l=b[q],h=l.nodeType;if(!(h==e.ELEMENT_NODE&&l.getAttribute("_ke_bookmark"))&&(h==e.ELEMENT_NODE&&!c._4e_isEmptyInlineRemovable(l)||h==c.NodeType.TEXT_NODE&&d.trim(l.nodeValue)))return!1}return!0},_4e_moveChildren:function(a,b,c){b=p(b);if(a!=b)if(c)for(;c=a.lastChild;)b.insertBefore(a.removeChild(c),b.firstChild);else for(;c=a.firstChild;)b.appendChild(a.removeChild(c))},_4e_mergeSiblings:function(a){a=new o(a);h[a.nodeName()]&&(i(a,!0),i(a))},_4e_splitText:function(a,
e){var d=a.ownerDocument;if(a.nodeType==c.NodeType.TEXT_NODE){if(b.ie&&e==a.nodeValue.length){var l=d.createTextNode("");c.insertAfter(l,a);return l}l=a.splitText(e);d.documentMode&&(d=d.createTextNode(""),c.insertAfter(d,l),c.remove(d));return l}},_4e_parents:function(a,b){var c=[];c.__IS_NODELIST=1;do c[b?"push":"unshift"](a);while(a=a.parentNode);return c},_4e_nextSourceNode:function(a,b,d,l){if(l&&!l.call)var k=p(l),l=function(a){return a!==k};var b=!b&&a.firstChild,n=a;if(!b){if(a.nodeType==
e.ELEMENT_NODE&&l&&!1===l(a,!0))return null;b=a.nextSibling}for(;!b&&(n=n.parentNode);){if(l&&!1===l(n,!0))return null;b=n.nextSibling}return!b||l&&!1===l(b)?null:d&&d!=b.nodeType?c._4e_nextSourceNode(b,!1,d,l):b},_4e_previousSourceNode:function(a,b,d,l){if(l&&!l.call)var k=p(l),l=function(a){return a!==k};var b=!b&&a.lastChild,n=a;if(!b){if(a.nodeType==e.ELEMENT_NODE&&l&&!1===l(a,!0))return null;b=a.previousSibling}for(;!b&&(n=n.parentNode);){if(l&&!1===l(n,!0))return null;b=n.previousSibling}return!b||
l&&!1===l(b)?null:d&&b.nodeType!=d?c._4e_previousSourceNode(b,!1,d,l):b},_4e_commonAncestor:function(a,b){b=p(b);if(a===b)return a;if(c.contains(b,a))return b;var d=a;do if(c.contains(d,b))return d;while(d=d.parentNode);return null},_4e_hasAttributes:9>j.ieEngine?function(a){for(var b=a.attributes,c=0;c<b.length;c++){var d=b[c];switch(d.name){case "class":if(a.getAttribute("class"))return!0;break;default:if(d.specified)return!0}}return!1}:function(a){b.gecko&&a.removeAttribute("_moz_dirty");return a.hasAttributes()},
_4e_position:function(a,b){var d=p(b);if(a.compareDocumentPosition)return a.compareDocumentPosition(d);if(a==d)return k.POSITION_IDENTICAL;if(a.nodeType==e.ELEMENT_NODE&&d.nodeType==e.ELEMENT_NODE){if(c.contains(a,d))return k.POSITION_CONTAINS+k.POSITION_PRECEDING;if(c.contains(d,a))return k.POSITION_IS_CONTAINED+k.POSITION_FOLLOWING;if("sourceIndex"in a)return 0>a.sourceIndex||0>d.sourceIndex?k.POSITION_DISCONNECTED:a.sourceIndex<d.sourceIndex?k.POSITION_PRECEDING:k.POSITION_FOLLOWING}for(var l=
c._4e_address(a),d=c._4e_address(d),h=Math.min(l.length,d.length),n=0;n<=h-1;n++)if(l[n]!=d[n])return l[n]<d[n]?k.POSITION_PRECEDING:k.POSITION_FOLLOWING;return l.length<d.length?k.POSITION_CONTAINS+k.POSITION_PRECEDING:k.POSITION_IS_CONTAINED+k.POSITION_FOLLOWING},_4e_address:function(a,b){for(var d=[],e=a.ownerDocument.documentElement,k=a;k&&k!=e;)d.unshift(c._4e_index(k,b)),k=k.parentNode;return d},_4e_remove:function(a,b){var c=a.parentNode;if(c){if(b)for(var d;d=a.firstChild;)c.insertBefore(a.removeChild(d),
a);c.removeChild(a)}return a},_4e_trim:function(a){c._4e_ltrim(a);c._4e_rtrim(a)},_4e_ltrim:function(a){for(var b;b=a.firstChild;){if(b.nodeType==c.NodeType.TEXT_NODE){var d=j.ltrim(b.nodeValue),e=b.nodeValue.length;if(d)d.length<e&&(c._4e_splitText(b,e-d.length),a.removeChild(a.firstChild));else{a.removeChild(b);continue}}break}},_4e_rtrim:function(a){for(var d;d=a.lastChild;){if(d.type==c.NodeType.TEXT_NODE){var e=j.rtrim(d.nodeValue),l=d.nodeValue.length;if(e)e.length<l&&(c._4e_splitText(d,e.length),
a.removeChild(a.lastChild));else{a.removeChild(d);continue}}break}!b.ie&&!b.opera&&(d=a.lastChild)&&1==d.nodeType&&"br"==c.nodeName(d)&&a.removeChild(d)},_4e_appendBogus:function(a){for(var e=a.lastChild;e&&e.nodeType==c.NodeType.TEXT_NODE&&!d.trim(e.nodeValue);)e=e.previousSibling;if(!e||e.nodeType==c.NodeType.TEXT_NODE||"br"!==c.nodeName(e))e=b.opera?a.ownerDocument.createTextNode(""):a.ownerDocument.createElement("br"),b.gecko&&e.setAttribute("type","_moz"),a.appendChild(e)},_4e_outerHtml:function(a){if(a.outerHTML)return a.outerHTML.replace(/<\?[^>]*>/,
"");var b=a.ownerDocument.createElement("div");b.appendChild(a.cloneNode(!0));return b.innerHTML},_4e_setMarker:function(a,b,c,e){var a=new o(a),k=a.data("list_marker_id")||a.data("list_marker_id",d.guid()).data("list_marker_id"),n=a.data("list_marker_names")||a.data("list_marker_names",{}).data("list_marker_names");b[k]=a;n[c]=1;return a.data(c,e)},_4e_clearMarkers:function(a,b,c){var a=new o(a),d=a.data("list_marker_names"),e=a.data("list_marker_id"),n;for(n in d)a.removeData(n);a.removeData("list_marker_names");
c&&(a.removeData("list_marker_id"),delete b[e])},_4e_copyAttributes:function(a,d,e){for(var d=new o(d),k=a.attributes,e=e||{},h=0;h<k.length;h++){var n=k[h],f=n.name.toLowerCase(),x;if(!(f in e))if("checked"==f&&(x=c.attr(a,f)))d.attr(f,x);else if(n.specified||b.ie&&n.value&&"value"==f)x=c.attr(a,f),null===x&&(x=n.nodeValue),d.attr(f,x)}""!==a.style.cssText&&(d[0].style.cssText=a.style.cssText)},_4e_isEditable:function(b){b=c.nodeName(b);return(b=!a.$nonEditable[b]&&(a[b]||a.span))&&b["#text"]},_4e_getByAddress:function(a,
b,c){for(var a=a.documentElement,d=0;a&&d<b.length;d++){var e=b[d];if(c)for(var n=-1,k=0;k<a.childNodes.length;k++){var h=a.childNodes[k];if(!(!0===c&&3==h.nodeType&&h.previousSibling&&3==h.previousSibling.nodeType)&&(n++,n==e)){a=h;break}}else a=a.childNodes[e]}return a}})},{requires:["./base","./utils"]});
KISSY.add("editor/core/domIterator",function(d){function g(a){1>arguments.length||(this.range=a,this.forceBrBreak=i,this.enlargeBr=j,this.enforceRealBlocks=i,this._||(this._={}))}var j=!0,i=!1,f=d.Editor,a=d.UA,c=f.Walker,e=f.Range,b=f.RANGE,o=f.ElementPath,h=d.Node,k=d.DOM,s=/^[\r\n\t ]*$/;d.augment(g,{getNextParagraph:function(f){var g,m,q,t,l;if(!this._.lastNode){m=this.range.clone();m.shrink(b.SHRINK_ELEMENT,j);m.enlarge(this.forceBrBreak||!this.enlargeBr?b.ENLARGE_LIST_ITEM_CONTENTS:b.ENLARGE_BLOCK_CONTENTS);
var v=new c(m),n=c.bookmark(j,j);v.evaluator=n;this._.nextNode=v.next();v=new c(m);v.evaluator=n;v=v.previous();this._.lastNode=v._4e_nextSourceNode(j);this._.lastNode&&this._.lastNode[0].nodeType==k.NodeType.TEXT_NODE&&!d.trim(this._.lastNode[0].nodeValue)&&this._.lastNode.parent()._4e_isBlockBoundary()&&(n=new e(m.document),n.moveToPosition(this._.lastNode,b.POSITION_AFTER_END),n.checkEndOfBlock()&&(n=new o(n.endContainer),this._.lastNode=(n.block||n.blockLimit)._4e_nextSourceNode(j)));this._.lastNode||
(this._.lastNode=this._.docEndMarker=new h(m.document.createTextNode("")),k.insertAfter(this._.lastNode[0],v[0]));m=null}n=this._.nextNode;v=this._.lastNode;for(this._.nextNode=null;n;){var w=i,x=n[0].nodeType!=k.NodeType.ELEMENT_NODE,z=i;if(x)n[0].nodeType==k.NodeType.TEXT_NODE&&s.test(n[0].nodeValue)&&(x=i);else{var u=n.nodeName();if(n._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){if("br"==u)x=j;else if(!m&&!n[0].childNodes.length&&"hr"!=u){g=n;q=n.equals(v);break}m&&(m.setEndAt(n,b.POSITION_BEFORE_START),
"br"!=u&&(this._.nextNode=n));w=j}else{if(n[0].firstChild){m||(m=new e(this.range.document),m.setStartAt(n,b.POSITION_BEFORE_START));n=new h(n[0].firstChild);continue}x=j}}x&&!m&&(m=new e(this.range.document),m.setStartAt(n,b.POSITION_BEFORE_START));q=(!w||x)&&n.equals(v);if(m&&!w)for(;!n[0].nextSibling&&!q;){u=n.parent();if(u._4e_isBlockBoundary(this.forceBrBreak&&{br:1})){w=j;q||u.equals(v);break}n=u;x=j;q=n.equals(v);z=j}x&&m.setEndAt(n,b.POSITION_AFTER_END);n=n._4e_nextSourceNode(z,null,v);if((q=
!n)||w&&m)break}if(!g){if(!m)return this._.docEndMarker&&this._.docEndMarker._4e_remove(),this._.nextNode=null;g=new o(m.startContainer);n=g.blockLimit;w={div:1,th:1,td:1};g=g.block;if((!g||!g[0])&&!this.enforceRealBlocks&&w[n.nodeName()]&&m.checkStartOfBlock()&&m.checkEndOfBlock())g=n;else if(!g||this.enforceRealBlocks&&"li"==g.nodeName())g=new h(this.range.document.createElement(f||"p")),g[0].appendChild(m.extractContents()),g._4e_trim(),m.insertNode(g),t=l=j;else if("li"!=g.nodeName()){if(!m.checkStartOfBlock()||
!m.checkEndOfBlock())g=g.clone(i),g[0].appendChild(m.extractContents()),g._4e_trim(),l=m.splitBlock(),t=!l.wasStartOfBlock,l=!l.wasEndOfBlock,m.insertNode(g)}else q||(this._.nextNode=g.equals(v)?null:m.getBoundaryNodes().endNode._4e_nextSourceNode(j,null,v))}t&&(m=new h(g[0].previousSibling),m[0]&&m[0].nodeType==k.NodeType.ELEMENT_NODE&&("br"==m.nodeName()?m._4e_remove():m[0].lastChild&&"br"==k.nodeName(m[0].lastChild)&&k._4e_remove(m[0].lastChild)));l&&(m=c.bookmark(i,j),t=new h(g[0].lastChild),
t[0]&&t[0].nodeType==k.NodeType.ELEMENT_NODE&&"br"==t.nodeName()&&(a.ie||t.prev(m,1)||t.next(m,1))&&t.remove());this._.nextNode||(this._.nextNode=q||g.equals(v)?null:g._4e_nextSourceNode(j,null,v));return g}});e.prototype.createIterator=function(){return new g(this)};return g},{requires:["./base","./range","./elementPath","./walker"]});
KISSY.add("editor",function(d,g,j,i,f,a,c,e,b,o){function h(a,b){var c=a.body;C(function(){a.designMode="on";setTimeout(function(){a.designMode="off";c.focus();arguments.callee.retry||(arguments.callee.retry=m)},50)},function(){a.designMode="off";x.attr(c,"contentEditable",l);x.attr(c,"contentEditable",m);!b&&h(a,1)})}function k(a){a.get("iframe");var b=a.get("textarea")[0],c=a.get("window")[0],e=a.get("document")[0];n.webkit&&(y.on(e,"click",function(a){var b=new u(a.target);d.inArray(b.nodeName(),
["input","select"])&&a.preventDefault()}),y.on(e,"mouseup",function(a){var b=new u(a.target);d.inArray(b.nodeName(),["input","textarea"])&&a.preventDefault()}));if(n.gecko||w||n.opera){var k;k=(new u('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>')).insertAfter(b);k.on("focus",function(){a.focus()});a.activateGecko=function(){n.gecko&&a.__iframeFocus&&k[0].focus()};a.on("destroy",function(){k.detach();k.remove()})}y.on(c,"focus",function(){n.gecko?h(e,l):n.opera&&
e.body.focus();a.notifySelectionChange()});if(n.gecko)y.on(e,"mousedown",function(){a.__iframeFocus||h(e,l)});if(w&&(y.on(e,"keydown",function(b){if(b.keyCode in{8:1,46:1}){var c=a.getSelection(),d=c.getSelectedElement();if(d){a.execCommand("save");var e=c.getRanges()[0].createBookmark();d.remove();c.selectBookmarks([e]);a.execCommand("save");b.preventDefault()}}}),"CSS1Compat"==e.compatMode)){var f={33:1,34:1};y.on(e,"keydown",function(b){b.keyCode in f&&setTimeout(function(){a.getSelection().scrollIntoView()},
0)})}if(n.webkit)y.on(e,"mousedown",function(b){b=new u(b.target);d.inArray(b.nodeName(),["img","hr","input","textarea","select"])&&a.getSelection().selectElement(b)});if(n.gecko)y.on(e,"dragstart",function(a){var b=new u(a.target);b.nodeName()==="img"&&/ke_/.test(b[0].className)&&a.preventDefault()});i.add(a)}function s(a,b,c,e){var k="",n,l=j.debugUrl("theme/editor-iframe.css");for(n=0;n<c.length;n++)k+=d.substitute('<link href="{href}" rel="stylesheet" />',{href:c[n]});return d.substitute(B,{doctype:8===
v.documentMode?'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"${title}",href:l,style:b,data:e||"&nbsp;",script:a?'<script id="ke_active_script">'+(x.isCustomDomain()?'document.domain="'+v.domain+'";':"")+'parent.KISSY.Editor._initIFrame("'+a+'");<\/script>':""})}function r(a,b){function c(){l=n.document;a.setInternal("document",new u(l));a.setInternal("window",new u(n));d.detach();l.open("text/html","replace");l.write(e);l.close()}var d=a.get("iframe"),e=s(a._UUID,a.get("customStyle"),
a.get("customLink"),b),k=d[0],n=k.contentWindow,l;d.__loaded=1;try{l=n.document}catch(h){if(k.src=k.src,7>w){setTimeout(c,10);return}}c()}function p(a,b){var c=x.getEmptyIframeSrc()||"";c&&(c=' src="'+c+'" ');var c=new u(d.substitute(D,{iframeSrc:c})),e=a.get("textarea");e.hasAttr("tabindex")&&c.attr("tabIndex",n.webkit?-1:e.attr("tabIndex"));e.parent().prepend(c);a.set("iframe",c);a.__docReady=0;if(n.gecko&&!c.__loaded)c.on("load",function(){r(a,b)},a);else r(a,b)}var m=!0,q=q,t=d.all,l=!1,v=document,
n=d.UA,w=n.ie,x=d.DOM,z=x.NodeType,u=d.Node,y=d.Event,C=j.tryThese,B="<!doctype html><html><head>{doctype}<title>{title}</title><link href='{href}' rel='stylesheet' /><style>{style}</style>{links}</head><body class='ks-editor' >{data}{script}</body></html>",D='<iframe style="width:100%;height:100%;border:none;"  frameborder="0"  title="kissy-editor"  allowTransparency="true"  {iframeSrc} ></iframe>',A='<div class="{prefixCls}editor-tools"></div><div class="{prefixCls}editor-textarea-wrap" '+(n.mobile?
'style="overflow:scroll;-webkit-overflow-scrolling:touch;"':"")+"></div><div class='{prefixCls}editor-status'></div>";d.mix(g,{SOURCE_MODE:0,WYSIWYG_MODE:1});var F=g.WYSIWYG_MODE;d.augment(g,{createDom:function(){var a,b=this.get("prefixCls"),c=this.get("textarea"),e;c?(this.set("textarea",c=t(c)),c[0].parentNode&&c[0].parentNode.removeChild(c[0])):this.set("textarea",c=t("<textarea class='"+b+"-editor-textarea'></textarea>"));e=this.get("el");e.html(d.substitute(A,{prefixCls:b}));a=e.one(d.substitute(".{prefixCls}editor-textarea-wrap",
{prefixCls:b}));this._UUID=d.guid();this.set({toolBarEl:e.one(d.substitute(".{prefixCls}editor-tools",{prefixCls:b})),statusBarEl:e.one(d.substitute(".{prefixCls}editor-status",{prefixCls:b}))},{silent:1});c.css("width","100%");c.css("display","none");a.append(c);i.register(this)},renderUI:function(){c.init(this);e.init(this);b.init(this);o.init(this)},bindUI:function(){function a(){b.detach("docReady",a);if(b.get("focused"))b.focus();else{var c=b.getSelection();c&&c.removeAllRanges()}}var b=this,
c,d=b.get("prefixCls"),e=b.get("textarea");if(b.get("attachForm")&&(c=e[0].form))y.on(c,"submit",b.sync,b),b.on("destroy",function(){y.detach(c,"submit",b.sync,b)});b.on("docReady",a);b.on("blur",function(){b.get("el").removeClass(d+"editor-focused")});b.on("focus",function(){b.get("el").addClass(d+"editor-focused")})},_uiSetHeight:function(a){var b=this.get("textarea"),c=this.get("toolBarEl"),d=this.get("statusBarEl"),a=parseInt(a,10),a=a-((c&&c.outerHeight()||0)+(d&&d.outerHeight()||0));b.parent().css("height",
a);b.css("height",a)},_uiSetMode:function(a){var b=this,c,d=b.get("rendered"),e=b.get("iframe"),k=b.get("textarea");a==F?(d&&b.execCommand("save"),b.on("docReady",c=function(){d&&b.execCommand("save");b.detach("docReady",c)}),b._setData(k.val()),k.hide(),b.fire("wysiwygMode")):(e&&(k.val(b._getData(1,F)),e.hide()),k.show(),b.fire("sourceMode"))},_uiSetFocused:function(a){a&&this.__docReady&&this.focus()},destructor:function(){var a=this.get("document")[0],b=this.get("window");this.sync();i.remove(this);
y.remove([a,a.documentElement,a.body,b[0]]);d.each(this.__controls,function(a){a.destroy&&a.destroy()});this.__commands={};this.__controls={}},getControl:function(a){return this.__controls[a]},getControls:function(){return this.__controls},addControl:function(a,b){this.__controls[a]=b},showDialog:function(a,b){var a=a+"/dialog",c=this.__controls[a];c.show(b);this.fire("dialogShow",{dialog:c.dialog,pluginDialog:c,dialogName:a})},addCommand:function(a,b){this.__commands[a]=b},hasCommand:function(a){return this.__commands[a]},
execCommand:function(a){var b=this.__commands[a],c=d.makeArray(arguments);c.shift();c.unshift(this);if(b)return b.exec.apply(b,c)},queryCommandValue:function(a){return this.execCommand(j.getQueryCmd(a))},_getData:function(a,b){var c=this.htmlDataProcessor,e;b==q&&(b=this.get("mode"));e=b==F?this.get("document")[0].body.innerHTML:c.toDataFormat(this.get("textarea").val());e=a?c.toHtml(e):c.toServer(e);e=d.trim(e);/^(?:<(p)>)?(?:(?:&nbsp;)|\s)*(?:<\/\1>)?$/.test(e)&&(e="");return e},_setData:function(a){var b,
c=a;if(this.get("mode")!=F)this.get("textarea").val(a);else{if(b=this.htmlDataProcessor)c=b.toDataFormat(a);if(this.get("iframe")){a=this.get("iframe");b=this.get("window")[0];var e=this.get("document")[0];y.remove([e,e.documentElement,e.body,b]);a.remove()}p(this,c)}},sync:function(){this.get("textarea").val(this.get("data"))},getDocHtml:function(){return s(0,this.get("customStyle"),this.get("customLink"),this.get("formatData"))},getSelection:function(){return g.Selection.getSelection(this.get("document")[0])},
focus:function(){var a=this.get("window");if(a){var b=this.get("document")[0],a=a[0];n.ie||a&&a.parent&&a.parent.focus();a&&a.focus();try{b.body.focus()}catch(c){}this.notifySelectionChange()}},blur:function(){this.get("window")[0].blur();this.get("document")[0].body.blur()},addCustomStyle:function(a,b){var c=this.get("customStyle")||"",c=c+("\n"+a);this.set("customStyle",c);x.addStyleSheet(this.get("window"),c,b)},removeCustomStyle:function(a){x.remove(x.get("#"+a,this.get("window")[0]))},addCustomLink:function(a){var b=
this.get("customLink")||[],c=this.get("document")[0];b.push(a);this.set("customLink",b);b=c.createElement("link");b.rel="stylesheet";c.getElementsByTagName("head")[0].appendChild(b);b.href=a},removeCustomLink:function(a){for(var b=this.get("document")[0],b=x.query("link",b),c=0;c<b.length;c++)x.attr(b[c],"href")==a&&x.remove(b[c]);b=this.get("customLink")||[];a=d.indexOf(a,b);-1!=a&&b.splice(a,1)},docReady:function(a){this.on("docReady",a);this.__docReady&&a.call(this)},checkSelectionChange:function(){var a=
this;a.__checkSelectionChangeId&&clearTimeout(a.__checkSelectionChangeId);a.__checkSelectionChangeId=setTimeout(function(){var b=a.getSelection();if(b&&!b.isInvalid){var c=b.getStartElement(),e=new g.ElementPath(c);if(!a.__previousPath||!a.__previousPath.compare(e))a.__previousPath=e,a.fire("selectionChange",{selection:b,path:e,element:c})}},100)},notifySelectionChange:function(){this.__previousPath=null;this.checkSelectionChange()},insertElement:function(a){if(this.get("mode")===F){this.focus();
var b,c=a.nodeName(),e=g.XHTML_DTD,d=e.$block[c],k=g.RANGE,n=(c=this.getSelection())&&c.getRanges(),l,h,f;if(n&&0!=n.length){this.execCommand("save");for(h=n.length-1;0<=h;h--)l=n[h],b=!h&&a||a.clone(m),l.insertNodeByDtd(b),f||(f=b);if(f)return l.moveToPosition(f,k.POSITION_AFTER_END),d&&(a=g.Walker.whitespaces(!0),(a=(f=f.next(a,1))&&f[0].nodeType==z.ELEMENT_NODE&&f.nodeName())&&e.$block[a]&&e[a]["#text"]&&l.moveToElementEditablePosition(f)),c.selectRanges([l]),this.focus(),b&&1==b[0].nodeType&&
b.scrollIntoView(q,!1),E.call(this),b}}},insertHtml:function(a,b){var c=this,e,d=c.get("document")[0];if(c.get("mode")===F){if(e=c.htmlDataProcessor)a=e.toDataFormat(a,b);c.focus();c.execCommand("save");if(w){e=d.selection;"Control"==e.type&&e.clear();try{e.createRange().pasteHTML(a)}catch(k){}}else try{d.execCommand("inserthtml",l,a)}catch(n){setTimeout(function(){if(0==c.getSelection().getRanges().length){var b=new g.Range(d),e=x.first(d.body,function(a){return 1==a.nodeType&&"br"!=x.nodeName(a)});
e||(e=new u(d.createElement("p")),e._4e_appendBogus(q),d.body.appendChild(e[0]));b.setStartAt(e,g.RANGE.POSITION_AFTER_START);b.select()}d.execCommand("inserthtml",l,a)},50)}setTimeout(function(){c.getSelection().scrollIntoView()},50);E.call(c)}}});g._initIFrame=function(a){var b=i.getInstance(a),c=b.get("document")[0],a=c.getElementById("ke_active_script");x.remove(a);k(b);var e=c.body;w?(e.hideFocus=m,e.disabled=m,e.contentEditable=m,e.removeAttribute("disabled")):setTimeout(function(){n.gecko||
n.opera?e.contentEditable=m:n.webkit?e.parentNode.contentEditable=m:c.designMode="on"},0);if(n.gecko||n.opera){var d=c.documentElement;y.on(d,"mousedown",function(a){if(a.target==d){n.gecko&&h(c,l);b.activateGecko()}})}setTimeout(function(){w&&setTimeout(function(){if(c){e.runtimeStyle.marginBottom="0px";e.runtimeStyle.marginBottom=""}},1E3)},0);setTimeout(function(){b.__docReady=1;b.fire("docReady");var a=b.get("disableObjectResizing"),d=b.get("disableInlineTableEditing");if(a||d)try{c.execCommand("enableObjectResizing",
l,!a);c.execCommand("enableInlineTableEditing",l,!d)}catch(k){y.on(e,w?"resizestart":"resize",function(b){var c=new u(b.target);(a||c.nodeName()==="table"&&d)&&b.preventDefault()})}},10)};var E=d.buffer(function(){this.execCommand("save")},50);return g},{requires:"editor/core/base,editor/core/utils,editor/core/focusManager,editor/core/styles,editor/core/zIndexManager,editor/core/clipboard,editor/core/enterKey,editor/core/htmlDataProcessor,editor/core/selectionFix".split(",")});
KISSY.add("editor/core/elementPath",function(d){function g(b){for(var d=a,h=a,k=[];b;){if(b[0].nodeType==i.NodeType.ELEMENT_NODE){this.lastElement||(this.lastElement=b);var g=b.nodeName();if(!h&&(!d&&c[g]&&(d=b),e[g])){var j;if(j=!d)if(j="div"==g){a:{j=b[0].childNodes;for(var p=0,m=j.length;p<m;p++){var q=j[p];if(q.nodeType==i.NodeType.ELEMENT_NODE&&f.$block[q.nodeName.toLowerCase()]){j=!0;break a}}j=!1}j=!j}j?d=b:h=b}k.push(b);if("body"==g)break}b=b.parent()}this.block=d;this.blockLimit=h;this.elements=
k}var j=d.Editor,i=d.DOM,f=j.XHTML_DTD,a=null,c={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},e={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1};g.prototype={compare:function(a){var c=this.elements,a=a&&a.elements;if(!a||c.length!=a.length)return!1;for(var e=0;e<c.length;e++)if(!i.equals(c[e],a[e]))return!1;return!0},contains:function(b){for(var c=this.elements,e=0;e<c.length;e++)if(c[e].nodeName()in b)return c[e];return a},toString:function(){var a=
this.elements,c,e=[];for(c=0;c<a.length;c++)e.push(a[c].nodeName());return e.toString()}};return j.ElementPath=g},{requires:["./base","./dom"]});
KISSY.add("editor/core/enterKey",function(d,g,j,i){function f(a){var h;h=a.getSelection().getRanges();for(var f=h.length-1;0<f;f--)h[f].deleteContents();h=h[0];f=h.document;if(h.checkStartOfBlock()&&h.checkEndOfBlock()){var g=(new i(h.startContainer)).block;if(g&&("li"==g.nodeName()||"li"==g.parent().nodeName()))return a.hasCommand("outdent")?(a.execCommand("save"),a.execCommand("outdent"),a.execCommand("save"),!0):!1}var m=h.splitBlock("p");if(!m)return!0;var a=m.previousBlock,g=m.nextBlock,q=m.wasStartOfBlock,
t=m.wasEndOfBlock,l;if(g)l=g.parent(),"li"==l.nodeName()&&(g._4e_breakParent(l),g._4e_move(g.next(),!0));else if(a&&(l=a.parent())&&"li"==l.nodeName())a._4e_breakParent(l),h.moveToElementEditablePosition(a.next()),a._4e_move(a.prev());if(!q&&!t){if("li"==g.nodeName()&&(l=g.first(j.invisible(!0)))&&d.inArray(l.nodeName(),["ul","ol"]))(c.ie?new o(f.createTextNode("\u00a0")):new o(f.createElement("br"))).insertBefore(l);g&&h.moveToElementEditablePosition(g)}else{var v;if(a){if("li"==a.nodeName()||!e.test(a.nodeName()))v=
a.clone()}else g&&(v=g.clone());v||(v=new o("<p>",null,f));if(l=m.elementPath)for(var m=0,n=l.elements.length;m<n;m++){var w=l.elements[m];if(w.equals(l.block)||w.equals(l.blockLimit))break;b.$removeEmpty[w.nodeName()]&&(w=w.clone(),v._4e_moveChildren(w),v.append(w))}c.ie||v._4e_appendBogus();h.insertNode(v);if(c.ie&&q&&(!t||!a[0].childNodes.length))h.moveToElementEditablePosition(t?a:v),h.select();h.moveToElementEditablePosition(q&&!t?g:v)}c.ie||(g?(v=new o(f.createElement("span")),v.html("&nbsp;"),
h.insertNode(v),v.scrollIntoView(void 0,!1),h.deleteContents()):v.scrollIntoView(void 0,!1));h.select();return!0}function a(a){var b=a.get("document")[0];h.on(b,"keydown",function(b){if(13===b.keyCode&&!b.shiftKey&&!b.ctrlKey&&!b.metaKey){a.execCommand("save");var c=a.execCommand("enterBlock");a.execCommand("save");!1!==c&&b.preventDefault()}})}var c=d.UA,e=/^h[1-6]$/,b=g.XHTML_DTD,o=d.Node,h=d.Event;return{init:function(b){b.addCommand("enterBlock",{exec:f});b.docReady(function(){a(b)})}}},{requires:["./base",
"./walker","./elementPath"]});
KISSY.add("editor/core/focusManager",function(d){function g(){var a=this;a.__iframeFocus=b;e=a;c&&clearTimeout(c);c=setTimeout(function(){a.fire("focus")},100)}function j(){var a=this;a.__iframeFocus=o;e=h;c&&clearTimeout(c);c=setTimeout(function(){a.fire("blur")},100)}var i=d.Editor,f=d.Event,a={},c,e,d={refreshAll:function(){for(var b in a){var c=a[b].get("document")[0];c.designMode="off";c.designMode="on"}},currentInstance:function(){return e},getInstance:function(b){return a[b]},add:function(a){var b=
a.get("window")[0];f.on(b,"focus",g,a);f.on(b,"blur",j,a)},register:function(b){a[b._UUID]=b},remove:function(b){delete a[b._UUID];var c=b.get("window")[0];f.remove(c,"focus",g,b);f.remove(c,"blur",j,b)}},b=!0,o=!1,h=null;d.refreshAll=d.refreshAll;i.focusManager=d;i.getInstances=function(){return a};return d},{requires:["./base","./dom"]});
KISSY.add("editor/core/htmlDataProcessor",function(d,g){return{init:function(j){function i(a){if((a.getAttribute("class")+"").match(/Apple-\w+-span/)||!a.attributes.length)a.setTagName(null);else if(!a.childNodes.length&&!a.attributes.length)return!1}function f(a){return a.replace(s,function(a,b,c){return"<"+b+c.replace(r,function(a,b){return-1==c.indexOf("_ke_saved_"+b)?" _ke_saved_"+a+" "+a:a})+">"})}function a(a){return a.replace(m,function(a){return"<ke:encoded>"+encodeURIComponent(a)+"</ke:encoded>"})}
function c(a){return a.replace(q,function(a,b){return d.urlDecode(b)})}var e=d.Node,b=d.UA,o=d.require("htmlparser"),h=new o.Filter,k=new o.Filter;(function(){function a(b){b=o.serialize(b);return new o.Comment(p+encodeURIComponent(b).replace(/--/g,"%2D%2D"))}var c={tagNames:[[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]],tags:{script:a,noscript:a,span:i}},e={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(a){if(a.attributes.length)for(var b=
["name","href","src"],c,e=0;e<b.length;e++)c="_ke_saved_"+b[e],a.getAttribute(c)&&a.removeAttribute(b[e]);return a},embed:function(a){var b=a.parentNode;if(b&&"object"==b.nodeName){var c=b.getAttribute("width"),b=b.getAttribute("height");c&&a.setAttribute("width",c);b&&a.setAttribute("width",b)}},a:function(a){if(!a.childNodes.length&&!a.attributes.length)return!1},span:i},attributes:{style:function(a){if(!d.trim(a))return!1}},attributeNames:[[/^_ke_saved_/,""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,
""],[/^_ks.*/,""]],comment:function(a){if(a.substr(0,p.length)==p)return a=d.trim(d.urlDecode(a.substr(p.length))),o.parse(a).childNodes[0]}};b.ie&&(e.attributes.style=function(a){return a.replace(/(^|;)([^:]+)/g,function(a){return a.toLowerCase()})});h.addRules(e);k.addRules(c)})();(function(){function a(b){for(var b=b.childNodes,c=b.length,e=b[c-1];e&&3==e.nodeType&&!d.trim(e.nodeValue);)e=b[--c];return e}function c(e,d){var l=a(e);l&&((d||!b.ie)&&1==l.nodeType&&"br"==l.nodeName?e.removeChild(l):
3==l.nodeType&&m.test(l.nodeValue)&&e.removeChild(l))}function e(b){var c=a(b);return!c||1==c.nodeType&&"br"==c.nodeName||"form"==b.nodeName&&"input"==c.nodeName}function l(a){c(a,!0);e(a)&&(b.ie?a.appendChild(new o.Text("\u00a0")):(a.appendChild(new o.Text("&nbsp;")),a.appendChild(new o.Tag("br"))))}function f(a){c(a,!1);e(a)&&a.appendChild(new o.Text("\u00a0"))}var m=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,q=g.XHTML_DTD,B=d.merge(q.$block,q.$listItem,q.$tableContent),i;for(i in B)"br"in q[i]||delete B[i];delete B.td;
delete B.pre;var q={tags:{}},v={tags:{}};for(i in B)q.tags[i]=l,v.tags[i]=f;k.addRules(q);h.addRules(v)})();h.addRules({text:function(a){return a.replace(/\xa0/g,"&nbsp;")}});var s=/<(a|area|img|input)\b([^>]*)>/gi,r=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,p="{ke_protected}",m=/(?:<style[^>]*>[\s\S]*<\/style>)|(?:<(:?link|meta|base)[^>]*>)/gi,q=/<ke:encoded>([^<]*)<\/ke:encoded>/gi,t=/(<\/?)((?:object|embed|param|html|body|head|title|script|noscript)[^>]*>)/gi,l=/(<\/?)ke:((?:object|embed|param|html|body|head|title|script|noscript)[^>]*>)/gi,
v=/<ke:(param|embed)([^>]*?)\/?>(?!\s*<\/ke:\1)/gi;j.htmlDataProcessor={dataFilter:k,htmlFilter:h,toHtml:function(a){var b=new o.BeautifyWriter;(new o.Parser(a)).parse().writeHtml(b,h);return a=b.getHtml()},toDataFormat:function(b,d){var d=d||k,b=f(b),b=a(b),b=b.replace(t,"$1ke:$2"),b=b.replace(v,"<ke:$1$2></ke:$1>"),h=new e("<div>");h.html("a"+b);b=h.html().substr(1);b=b.replace(l,"$1$2");b=c(b);h=new o.BasicWriter;(new o.Parser(b)).parse().writeHtml(h,d);return b=h.getHtml()},toServer:function(a){var b=
new o.MinifyWriter;(new o.Parser(a)).parse().writeHtml(b,h);return b.getHtml()}}}}},{requires:["./base"]});
KISSY.config("modules",{"editor/plugin/heading/cmd":{requires:["editor"]},"editor/plugin/page-break/index":{requires:["editor","editor/plugin/fake-objects/"]},"editor/plugin/italic/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/font-size/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/image/dialog":{requires:["ajax","editor","editor/plugin/overlay/","tabs","editor/plugin/menubutton/"]},"editor/plugin/underline/index":{requires:["editor","editor/plugin/font/ui",
"editor/plugin/underline/cmd"]},"editor/plugin/maximize/cmd":{requires:["editor"]},"editor/plugin/contextmenu/index":{requires:["editor","menu","editor/plugin/focus-fix/"]},"editor/plugin/heading/index":{requires:["editor","editor/plugin/heading/cmd"]},"editor/plugin/drag-upload/index":{requires:["editor"]},"editor/plugin/color/cmd":{requires:["editor"]},"editor/plugin/flash/dialog":{requires:["editor","editor/plugin/flash-common/utils","editor/plugin/overlay/","editor/plugin/menubutton/"]},"editor/plugin/code/index":{requires:["editor",
"editor/plugin/dialog-loader/"]},"editor/plugin/strike-through/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/unordered-list/index":{requires:["editor","editor/plugin/list-utils/btn","editor/plugin/unordered-list/cmd"]},"editor/plugin/outdent/cmd":{requires:["editor","editor/plugin/dent-utils/cmd"]},"editor/plugin/italic/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/italic/cmd"]},"editor/plugin/remove-format/cmd":{requires:["editor"]},"editor/plugin/font-size/index":{requires:["editor",
"editor/plugin/font/ui","editor/plugin/font-size/cmd"]},"editor/plugin/indent/cmd":{requires:["editor","editor/plugin/dent-utils/cmd"]},"editor/plugin/table/index":{requires:["editor","editor/plugin/dialog-loader/","editor/plugin/contextmenu/"]},"editor/plugin/word-filter/dynamic/index":{requires:["htmlparser"]},"editor/plugin/justify-left/cmd":{requires:["editor/plugin/justify-utils/cmd"]},"editor/plugin/resize/index":{requires:["editor","dd/base"]},"editor/plugin/video/dialog":{requires:["editor",
"editor/plugin/flash/dialog","editor/plugin/menubutton/"]},"editor/plugin/focus-fix/index":{requires:["editor"]},"editor/plugin/xiami-music/index":{requires:["editor","editor/plugin/flash-common/baseClass","editor/plugin/flash-common/utils","editor/plugin/fake-objects/"]},"editor/plugin/maximize/index":{requires:["editor","editor/plugin/maximize/cmd"]},"editor/plugin/color/color-picker/dialog":{requires:["editor","editor/plugin/overlay/"]},"editor/plugin/smiley/index":{requires:["editor","editor/plugin/overlay/"]},
"editor/plugin/separator/index":{requires:["editor"]},"editor/plugin/video/index":{requires:["editor","editor/plugin/flash-common/utils","editor/plugin/flash-common/baseClass","editor/plugin/fake-objects/"]},"editor/plugin/multiple-upload/index":{requires:["editor","editor/plugin/dialog-loader/"]},"editor/plugin/undo/btn":{requires:["editor","editor/plugin/button/"]},"editor/plugin/menubutton/index":{requires:["editor","menubutton"]},"editor/plugin/flash/index":{requires:["editor","editor/plugin/flash-common/baseClass",
"editor/plugin/flash-common/utils","editor/plugin/fake-objects/"]},"editor/plugin/overlay/index":{requires:["editor","overlay","editor/plugin/focus-fix/","dd/base","dd/constrain"]},"editor/plugin/link/utils":{requires:["editor"]},"editor/plugin/xiami-music/dialog":{requires:["editor","editor/plugin/flash/dialog","editor/plugin/menubutton/"]},"editor/plugin/list-utils/cmd":{requires:["editor","editor/plugin/list-utils/"]},"editor/plugin/button/index":{requires:["editor","button"]},"editor/plugin/checkbox-source-area/index":{requires:["editor"]},
"editor/plugin/strike-through/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/strike-through/cmd"]},"editor/plugin/fore-color/index":{requires:["editor","editor/plugin/color/btn","editor/plugin/fore-color/cmd"]},"editor/plugin/flash-bridge/index":{requires:["editor","editor/plugin/flash-common/utils"]},"editor/plugin/fore-color/cmd":{requires:["editor/plugin/color/cmd"]},"editor/plugin/table/dialog":{requires:["editor","editor/plugin/overlay/","editor/plugin/menubutton/"]},"editor/plugin/justify-utils/cmd":{requires:["editor"]},
"editor/plugin/undo/index":{requires:["editor","editor/plugin/undo/btn","editor/plugin/undo/cmd"]},"editor/plugin/justify-right/cmd":{requires:["editor/plugin/justify-utils/cmd"]},"editor/plugin/image/index":{requires:["editor","editor/plugin/button/","editor/plugin/bubble/","editor/plugin/contextmenu/","editor/plugin/dialog-loader/"]},"editor/plugin/dent-utils/cmd":{requires:["editor","editor/plugin/list-utils/"]},"editor/plugin/ordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]},
"editor/plugin/list-utils/index":{requires:["editor"]},"editor/plugin/dialog-loader/index":{requires:["overlay","editor"]},"editor/plugin/font-family/index":{requires:["editor","editor/plugin/font/ui","editor/plugin/font-family/cmd"]},"editor/plugin/undo/cmd":{requires:["editor"]},"editor/plugin/indent/index":{requires:["editor","editor/plugin/indent/cmd"]},"editor/plugin/font/cmd":{requires:["editor"]},"editor/plugin/ordered-list/index":{requires:["editor","editor/plugin/list-utils/btn","editor/plugin/ordered-list/cmd"]},
"editor/plugin/color/btn":{requires:["editor","editor/plugin/button/","editor/plugin/overlay/","editor/plugin/dialog-loader/"]},"editor/plugin/bold/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/local-storage/index":{requires:["editor","overlay","editor/plugin/flash-bridge/"]},"editor/plugin/bubble/index":{requires:["overlay","editor"]},"editor/plugin/underline/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/bold/index":{requires:["editor","editor/plugin/font/ui",
"editor/plugin/bold/cmd"]},"editor/plugin/back-color/index":{requires:["editor","editor/plugin/color/btn","editor/plugin/back-color/cmd"]},"editor/plugin/draft/index":{requires:["editor","editor/plugin/local-storage/","overlay","editor/plugin/menubutton/"]},"editor/plugin/link/index":{requires:["editor","editor/plugin/bubble/","editor/plugin/link/utils","editor/plugin/dialog-loader/","editor/plugin/button/"]},"editor/plugin/remove-format/index":{requires:["editor","editor/plugin/remove-format/cmd",
"editor/plugin/button/"]},"editor/plugin/font/ui":{requires:["editor","editor/plugin/button/","editor/plugin/menubutton/"]},"editor/plugin/element-path/index":{requires:["editor"]},"editor/plugin/source-area/index":{requires:["editor","editor/plugin/button/"]},"editor/plugin/justify-right/index":{requires:["editor","editor/plugin/justify-right/cmd"]},"editor/plugin/list-utils/btn":{requires:["editor","editor/plugin/button/","editor/plugin/menubutton/"]},"editor/plugin/justify-left/index":{requires:["editor",
"editor/plugin/justify-left/cmd"]},"editor/plugin/outdent/index":{requires:["editor","editor/plugin/outdent/cmd"]},"editor/plugin/fake-objects/index":{requires:["editor"]},"editor/plugin/link/dialog":{requires:["editor","editor/plugin/overlay/","editor/plugin/link/utils"]},"editor/plugin/font-family/cmd":{requires:["editor","editor/plugin/font/cmd"]},"editor/plugin/back-color/cmd":{requires:["editor/plugin/color/cmd"]},"editor/plugin/multiple-upload/dialog":{requires:["editor","editor/plugin/progressbar/",
"editor/plugin/overlay/","editor/plugin/flash-bridge/","editor/plugin/local-storage/"]},"editor/plugin/code/dialog":{requires:["editor/plugin/overlay/","menubutton"]},"editor/plugin/justify-center/cmd":{requires:["editor/plugin/justify-utils/cmd"]},"editor/plugin/flash-common/baseClass":{requires:["editor","editor/plugin/contextmenu/","editor/plugin/bubble/","editor/plugin/dialog-loader/","editor/plugin/flash-common/utils"]},"editor/plugin/justify-center/index":{requires:["editor","editor/plugin/justify-center/cmd"]},
"editor/plugin/unordered-list/cmd":{requires:["editor","editor/plugin/list-utils/cmd"]}});
KISSY.add("editor/core/range",function(d,g,j,i,f){function a(a){var b=a.nodeType!=q.NodeType.TEXT_NODE&&q.nodeName(a)in l.$removeEmpty,c=a.nodeType==q.NodeType.TEXT_NODE&&!d.trim(a.nodeValue),a=!!a.parentNode.getAttribute("_ke_bookmark");return b||c||a}function c(a){return!x(a)&&!z(a)}function e(a){var b=s;return function(c){if(z(c))return k;if(c.nodeType==q.NodeType.TEXT_NODE){if(d.trim(c.nodeValue).length)return s}else if(c.nodeType==q.NodeType.ELEMENT_NODE&&(c=q.nodeName(c),!C[c]))if(!a&&!t.ie&&
"br"==c&&!b)b=k;else return s;return k}}function b(a,b){var c=a.startContainer,e=a.endContainer,d=a.startOffset,l=a.endOffset,h,f=s,n=s,g=void 0,m=a.document,o;0<b&&(g=m.createDocumentFragment());if(a.collapsed)return g;a.optimizeBookmark();e[0].nodeType==q.NodeType.TEXT_NODE?(n=k,e=e._4e_splitText(l)):0<e[0].childNodes.length&&(l>=e[0].childNodes.length?(e=new v(e[0].appendChild(m.createTextNode(""))),o=k):e=new v(e[0].childNodes[l]));c[0].nodeType==q.NodeType.TEXT_NODE?(f=k,c._4e_splitText(d)):
d?d>=c[0].childNodes.length?(c=new v(c[0].appendChild(m.createTextNode(""))),h=k):c=new v(c[0].childNodes[d].previousSibling):(h=new v(m.createTextNode("")),c.prepend(h),c=h,h=k);var i=c._4e_parents(),x=e._4e_parents();i.each(function(a,b){i[b]=a});x.each(function(a,b){x[b]=a});for(var j,w,m=0;m<i.length&&!(j=i[m],w=x[m],!j.equals(w));m++);for(var d=g,p,t,z=m;z<i.length;z++){p=i[z];l=0<b&&!p.equals(c)?d.appendChild(p.clone()[0]):null;p=p[0].nextSibling;t=x[z];for(var r=e[0],u=t&&t[0];p&&!(u==p||r==
p);)t=p.nextSibling,2==b?d.appendChild(p.cloneNode(k)):(q._4e_remove(p),1==b&&d.appendChild(p)),p=t;l&&(d=l)}for(d=g;m<x.length;m++){p=x[m];l=0<b&&!p.equals(e)?d.appendChild(p.clone()[0]):null;if(!i[m]||!p._4e_sameLevel(i[m]))for(p=p[0].previousSibling;p;)t=p.previousSibling,2==b?d.insertBefore(p.cloneNode(k),d.firstChild):(q._4e_remove(p),1==b&&d.insertBefore(p,d.firstChild)),p=t;l&&(d=l)}if(2==b){if(f&&(j=c[0],j.nodeType==q.NodeType.TEXT_NODE&&j.nextSibling&&j.nextSibling.nodeType==q.NodeType.TEXT_NODE&&
(j.data+=j.nextSibling.data,j.parentNode.removeChild(j.nextSibling))),n)n=e[0],n.nodeType==q.NodeType.TEXT_NODE&&n.previousSibling&&n.previousSibling.nodeType==q.NodeType.TEXT_NODE&&(n.previousSibling.data+=n.data,n.parentNode.removeChild(n))}else{if(j&&w&&(!c._4e_sameLevel(j)||!e._4e_sameLevel(w)))n=j._4e_index(),h&&j._4e_sameLevel(c)&&n--,a.setStart(j.parent(),n+1);a.collapse(k)}h&&c.remove();o&&e.remove();return g}function o(a){a.collapsed=a.startContainer&&a.endContainer&&a.startContainer[0]==
a.endContainer[0]&&a.startOffset==a.endOffset}function h(a){this.endOffset=this.endContainer=this.startOffset=this.startContainer=r;this.collapsed=k;this.document=a}g.RANGE={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var k=!0,s=!1,r=null,p=g.RANGE,m=g.POSITION,q=d.DOM,t=d.UA,l=g.XHTML_DTD,v=d.Node,n=v.all,w={area:1,base:1,br:1,col:1,hr:1,
img:1,input:1,link:1,meta:1,param:1},x=new i.whitespaces,z=new i.bookmark,u=i.whitespaces(k),y=i.bookmark(!1,!0),C={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};d.augment(h,{toString:function(){var a=[],b=this.startContainer[0],c=this.endContainer[0];a.push((b.id||b.nodeName)+":"+this.startOffset);a.push((c.id||c.nodeName)+":"+this.endOffset);return a.join("<br/>")},optimize:function(){var a=
this.startContainer,b=this.startOffset;a[0].nodeType!=q.NodeType.ELEMENT_NODE&&(b?b>=a[0].nodeValue.length&&this.setStartAfter(a):this.setStartBefore(a));a=this.endContainer;b=this.endOffset;a[0].nodeType!=q.NodeType.ELEMENT_NODE&&(b?b>=a[0].nodeValue.length&&this.setEndAfter(a):this.setEndBefore(a))},setStartAfter:function(a){this.setStart(a.parent(),a._4e_index()+1)},setStartBefore:function(a){this.setStart(a.parent(),a._4e_index())},setEndAfter:function(a){this.setEnd(a.parent(),a._4e_index()+
1)},setEndBefore:function(a){this.setEnd(a.parent(),a._4e_index())},optimizeBookmark:function(){var a=this.startContainer,b=this.endContainer;a&&"span"==a.nodeName()&&a.attr("_ke_bookmark")&&this.setStartBefore(a);b&&"span"==b.nodeName()&&b.attr("_ke_bookmark")&&this.setEndAfter(b)},setStart:function(a,b){a[0].nodeType==q.NodeType.ELEMENT_NODE&&w[a.nodeName()]&&(a=a.parent(),b=a._4e_index());this.startContainer=a;this.startOffset=b;this.endContainer||(this.endContainer=a,this.endOffset=b);o(this)},
setEnd:function(a,b){a[0].nodeType==q.NodeType.ELEMENT_NODE&&w[a.nodeName()]&&(a=a.parent(),b=a._4e_index()+1);this.endContainer=a;this.endOffset=b;this.startContainer||(this.startContainer=a,this.startOffset=b);o(this)},setStartAt:function(a,b){switch(b){case p.POSITION_AFTER_START:this.setStart(a,0);break;case p.POSITION_BEFORE_END:a[0].nodeType==q.NodeType.TEXT_NODE?this.setStart(a,a[0].nodeValue.length):this.setStart(a,a[0].childNodes.length);break;case p.POSITION_BEFORE_START:this.setStartBefore(a);
break;case p.POSITION_AFTER_END:this.setStartAfter(a)}o(this)},setEndAt:function(a,b){switch(b){case p.POSITION_AFTER_START:this.setEnd(a,0);break;case p.POSITION_BEFORE_END:a[0].nodeType==q.NodeType.TEXT_NODE?this.setEnd(a,a[0].nodeValue.length):this.setEnd(a,a[0].childNodes.length);break;case p.POSITION_BEFORE_START:this.setEndBefore(a);break;case p.POSITION_AFTER_END:this.setEndAfter(a)}o(this)},cloneContents:function(){return b(this,2)},deleteContents:function(){return b(this,0)},extractContents:function(){return b(this,
1)},collapse:function(a){a?(this.endContainer=this.startContainer,this.endOffset=this.startOffset):(this.startContainer=this.endContainer,this.startOffset=this.endOffset);this.collapsed=k},clone:function(){var a=new h(this.document);a.startContainer=this.startContainer;a.startOffset=this.startOffset;a.endContainer=this.endContainer;a.endOffset=this.endOffset;a.collapsed=this.collapsed;return a},getEnclosedNode:function(){var a=this.clone();a.optimize();if(a.startContainer[0].nodeType!=q.NodeType.ELEMENT_NODE||
a.endContainer[0].nodeType!=q.NodeType.ELEMENT_NODE)return r;var b=new i(a);b.evaluator=function(a){return u(a)&&y(a)};a=b.next();b.reset();b=b.previous();return a&&a.equals(b)?a:r},shrink:function(a,b){if(!this.collapsed){var a=a||p.SHRINK_TEXT,c=this.clone(),e=this.startContainer,d=this.endContainer,l=this.startOffset,h=this.endOffset,n=k,f,g,m=k;e&&e[0].nodeType==q.NodeType.TEXT_NODE&&(l?l>=e[0].nodeValue.length?c.setStartAfter(e):(c.setStartBefore(e),n=s):c.setStartBefore(e));d&&d[0].nodeType==
q.NodeType.TEXT_NODE&&(h?h>=d[0].nodeValue.length?c.setEndAfter(d):(c.setEndAfter(d),m=s):c.setEndBefore(d));if(n||m)g=new i(c),g.evaluator=function(b){return b.nodeType==(a==p.SHRINK_ELEMENT?q.NodeType.ELEMENT_NODE:q.NodeType.TEXT_NODE)},g.guard=function(b,c){if(a==p.SHRINK_ELEMENT&&b.nodeType==q.NodeType.TEXT_NODE||c&&b==f)return s;!c&&b.nodeType==q.NodeType.ELEMENT_NODE&&(f=b);return k};n&&(c=g[a==p.SHRINK_ELEMENT?"lastForward":"next"]())&&this.setStartAt(c,b?p.POSITION_AFTER_START:p.POSITION_BEFORE_START);
m&&(g.reset(),(g=g[a==p.SHRINK_ELEMENT?"lastBackward":"previous"]())&&this.setEndAt(g,b?p.POSITION_BEFORE_END:p.POSITION_AFTER_END));return n||m}},createBookmark2:function(a){var b=this.startContainer,c=this.endContainer,e=this.startOffset,d=this.endOffset,l,h;if(!b||!c)return{start:0,end:0};if(a){if(b[0].nodeType==q.NodeType.ELEMENT_NODE&&(l=new v(b[0].childNodes[e]))&&l[0]&&l[0].nodeType==q.NodeType.TEXT_NODE&&0<e&&l[0].previousSibling.nodeType==q.NodeType.TEXT_NODE)b=l,e=0;for(;b[0].nodeType==
q.NodeType.TEXT_NODE&&(h=b.prev(void 0,1))&&h[0].nodeType==q.NodeType.TEXT_NODE;)b=h,e+=h[0].nodeValue.length;if(!this.collapsed){if(c[0].nodeType==q.NodeType.ELEMENT_NODE&&(l=new v(c[0].childNodes[d]))&&l[0]&&l[0].nodeType==q.NodeType.TEXT_NODE&&0<d&&l[0].previousSibling.nodeType==q.NodeType.TEXT_NODE)c=l,d=0;for(;c[0].nodeType==q.NodeType.TEXT_NODE&&(h=c.prev(void 0,1))&&h[0].nodeType==q.NodeType.TEXT_NODE;)c=h,d+=h[0].nodeValue.length}}return{start:b._4e_address(a),end:this.collapsed?r:c._4e_address(a),
startOffset:e,endOffset:d,normalized:a,is2:k}},createBookmark:function(a){var b,c,e,l,h=this.collapsed;b=new v("<span>",r,this.document);b.attr("_ke_bookmark",1);b.css("display","none");b.html("&nbsp;");a&&(e=d.guid("ke_bm_"),b.attr("id",e+"S"));h||(c=b.clone(),c.html("&nbsp;"),a&&c.attr("id",e+"E"),l=this.clone(),l.collapse(),l.insertNode(c));l=this.clone();l.collapse(k);l.insertNode(b);c?(this.setStartAfter(b),this.setEndBefore(c)):this.moveToPosition(b,p.POSITION_AFTER_END);return{startNode:a?
e+"S":b,endNode:a?e+"E":c,serializable:a,collapsed:h}},moveToPosition:function(a,b){this.setStartAt(a,b);this.collapse(k)},trim:function(a,b){var c=this.startContainer,e=this.startOffset,d=this.collapsed;if((!a||d)&&c[0]&&c[0].nodeType==q.NodeType.TEXT_NODE){if(e)if(e>=c[0].nodeValue.length)e=c._4e_index()+1,c=c.parent();else{var l=c._4e_splitText(e),e=c._4e_index()+1,c=c.parent();q.equals(this.startContainer,this.endContainer)?this.setEnd(l,this.endOffset-this.startOffset):q.equals(c,this.endContainer)&&
(this.endOffset+=1)}else e=c._4e_index(),c=c.parent();this.setStart(c,e);if(d){this.collapse(k);return}}c=this.endContainer;e=this.endOffset;!b&&!d&&c[0]&&c[0].nodeType==q.NodeType.TEXT_NODE&&(e?(e>=c[0].nodeValue.length||c._4e_splitText(e),e=c._4e_index()+1):e=c._4e_index(),c=c.parent(),this.setEnd(c,e))},insertNode:function(a){this.optimizeBookmark();this.trim(s,k);var b=this.startContainer;b[0].insertBefore(a[0],b[0].childNodes[this.startOffset]||null);b[0]==this.endContainer[0]&&this.endOffset++;
this.setStartBefore(a)},moveToBookmark:function(a){var b=n(this.document);if(a.is2){var c=b._4e_getByAddress(a.start,a.normalized),e=a.startOffset,b=a.end&&b._4e_getByAddress(a.end,a.normalized),a=a.endOffset;this.setStart(c,e);b?this.setEnd(b,a):this.collapse(k)}else c=(e=a.serializable)?d.one("#"+a.startNode,b):a.startNode,a=e?d.one("#"+a.endNode,b):a.endNode,this.setStartBefore(c),c._4e_remove(),a&&a[0]?(this.setEndBefore(a),a._4e_remove()):this.collapse(k)},getCommonAncestor:function(a,b){var c=
this.startContainer,e=this.endContainer,c=c[0]==e[0]?a&&c[0].nodeType==q.NodeType.ELEMENT_NODE&&this.startOffset==this.endOffset-1?new v(c[0].childNodes[this.startOffset]):c:c._4e_commonAncestor(e);return b&&c[0].nodeType==q.NodeType.TEXT_NODE?c.parent():c},enlarge:function(){function a(b,c,e,d){var l=b[c?"startContainer":"endContainer"],h,f=c?0:1,k=0,g=c?"previousSibling":"nextSibling";h=b[c?"startOffset":"endOffset"];if(l[0].nodeType==q.NodeType.TEXT_NODE){if(c){if(h)return}else if(h<l[0].nodeValue.length)return;
h=l[0][g];l=l[0].parentNode}else h=l[0].childNodes[h+(c?-1:1)]||null,l=l[0];for(;l;){for(;h;)if(x(h)||z(h))h=h[g];else break;if(h){if(!k)b[c?"setStartAfter":"setEndBefore"](n(h));break}l=n(l);if("body"==l.nodeName())break;if(k||l.equals(d))e[f]=l,k=1;else b[c?"setStartBefore":"setEndAfter"](l);h=l[0][g];l=l[0].parentNode}}return function(b){switch(b){case p.ENLARGE_ELEMENT:if(this.collapsed)break;var b=this.getCommonAncestor(),c=[];a(this,1,c,b);a(this,0,c,b);c[0]&&c[1]&&(b=c[0].contains(c[1])?c[1]:
c[0],this.setStartBefore(b),this.setEndAfter(b));break;case p.ENLARGE_BLOCK_CONTENTS:case p.ENLARGE_LIST_ITEM_CONTENTS:var e=new h(this.document),c=new v(this.document.body);e.setStartAt(c,p.POSITION_AFTER_START);e.setEnd(this.startContainer,this.startOffset);var e=new i(e),d,l,f=i.blockBoundary(b==p.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:r),k=function(a){var b=f(a);b||(d=n(a));return b},g=function(a){var b=k(a);!b&&"br"==q.nodeName(a)&&(l=n(a));return b};e.guard=k;e=e.lastBackward();d=d||c;this.setStartAt(d,
"br"!=d.nodeName()&&(!e&&this.checkStartOfBlock()||e&&d.contains(e))?p.POSITION_AFTER_START:p.POSITION_AFTER_END);e=this.clone();e.collapse();e.setEndAt(c,p.POSITION_BEFORE_END);e=new i(e);e.guard=b==p.ENLARGE_LIST_ITEM_CONTENTS?g:k;d=r;e=e.lastForward();d=d||c;this.setEndAt(d,!e&&this.checkEndOfBlock()||e&&d.contains(e)?p.POSITION_BEFORE_END:p.POSITION_BEFORE_START);l&&this.setEndAfter(l)}}}(),checkStartOfBlock:function(){var a=this.startContainer,b=this.startOffset;if(b&&a[0].nodeType==q.NodeType.TEXT_NODE&&
d.trim(a[0].nodeValue.substring(0,b)).length)return s;this.trim();a=new f(this.startContainer);b=this.clone();b.collapse(k);b.setStartAt(a.block||a.blockLimit,p.POSITION_AFTER_START);a=new i(b);a.evaluator=e(k);return a.checkBackward()},checkEndOfBlock:function(){var a=this.endContainer,b=this.endOffset;if(a[0].nodeType==q.NodeType.TEXT_NODE&&d.trim(a[0].nodeValue.substring(b)).length)return s;this.trim();a=new f(this.endContainer);b=this.clone();b.collapse(s);b.setEndAt(a.block||a.blockLimit,p.POSITION_BEFORE_END);
a=new i(b);a.evaluator=e(s);return a.checkForward()},checkBoundaryOfElement:function(b,c){var e=this.clone();e[c==p.START?"setStartAt":"setEndAt"](b,c==p.START?p.POSITION_AFTER_START:p.POSITION_BEFORE_END);e=new i(e);e.evaluator=a;return e[c==p.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var a=this.startContainer,b=this.endContainer,c=this.startOffset,e=this.endOffset,d;if(a[0].nodeType==q.NodeType.ELEMENT_NODE)if(d=a[0].childNodes.length,d>c)a=n(a[0].childNodes[c]);else if(0==
d)a=a._4e_previousSourceNode();else{for(a=a[0];a.lastChild;)a=a.lastChild;a=n(a);a=a._4e_nextSourceNode()||a}if(b[0].nodeType==q.NodeType.ELEMENT_NODE)if(d=b[0].childNodes.length,d>e)b=n(b[0].childNodes[e])._4e_previousSourceNode(k);else if(0==d)b=b._4e_previousSourceNode();else{for(b=b[0];b.lastChild;)b=b.lastChild;b=n(b)}a._4e_position(b)&m.POSITION_FOLLOWING&&(a=b);return{startNode:a,endNode:b}},fixBlock:function(a,b){var c=this.createBookmark(),e=n(this.document.createElement(b));this.collapse(a);
this.enlarge(p.ENLARGE_BLOCK_CONTENTS);e[0].appendChild(this.extractContents());e._4e_trim();t.ie||e._4e_appendBogus();this.insertNode(e);this.moveToBookmark(c);return e},splitBlock:function(a){var b=new f(this.startContainer),c=new f(this.endContainer),e=b.block,l=c.block,h=r;if(!b.blockLimit.equals(c.blockLimit))return r;"br"!=a&&(e||(e=this.fixBlock(k,a),l=(new f(this.endContainer)).block),l||(l=this.fixBlock(s,a)));a=e&&this.checkStartOfBlock();b=l&&this.checkEndOfBlock();this.deleteContents();
e&&e[0]==l[0]&&(b?(h=new f(this.startContainer),this.moveToPosition(l,p.POSITION_AFTER_END),l=r):a?(h=new f(this.startContainer),this.moveToPosition(e,p.POSITION_BEFORE_START),e=r):(l=this.splitElement(e),!t.ie&&!d.inArray(e.nodeName(),["ul","ol"])&&e._4e_appendBogus()));return{previousBlock:e,nextBlock:l,wasStartOfBlock:a,wasEndOfBlock:b,elementPath:h}},splitElement:function(a){if(!this.collapsed)return r;this.setEndAt(a,p.POSITION_BEFORE_END);var b=this.extractContents(),c=a.clone(s);c[0].appendChild(b);
c.insertAfter(a);this.moveToPosition(a,p.POSITION_AFTER_END);return c},moveToElementEditablePosition:function(a,b){for(var e=0;a;){if(a[0].nodeType==q.NodeType.TEXT_NODE){this.moveToPosition(a,b?p.POSITION_AFTER_END:p.POSITION_BEFORE_START);e=1;break}a[0].nodeType==q.NodeType.ELEMENT_NODE&&a._4e_isEditable()&&(this.moveToPosition(a,b?p.POSITION_BEFORE_END:p.POSITION_AFTER_START),e=1);var d=a,l=e,h=void 0;d[0].nodeType==q.NodeType.ELEMENT_NODE&&d._4e_isEditable()&&(h=d[b?"last":"first"](c,1));!l&&
!h&&(h=d[b?"prev":"next"](c,1));a=h}return!!e},selectNodeContents:function(a){var b=a[0];this.setStart(a,0);this.setEnd(a,b.nodeType==q.NodeType.TEXT_NODE?b.nodeValue.length:b.childNodes.length)},insertNodeByDtd:function(a){var b,c,e,d=a.nodeName();b=l.$block[d];this.deleteContents();if(b){for(b=this.getCommonAncestor(s,k);(c=l[b.nodeName()])&&(!c||!c[d]);){var h=b.parent();this.checkStartOfBlock()&&this.checkEndOfBlock()?(this.setStartBefore(b),this.collapse(k),b.remove()):e=b;b=h}e&&this.splitElement(e)}this.insertNode(a)}});
j.injectDom({_4e_breakParent:function(a,b){var b=n(b),a=n(a),c,e=new g.Range(a[0].ownerDocument);e.setStartAfter(a);e.setEndAfter(b);c=e.extractContents();e.insertNode(a.remove());a.after(c)}});return g.Range=h},{requires:["./base","./utils","./walker","./elementPath","./dom"]});
KISSY.add("editor/core/selection",function(d){function g(a){this.document=a;this._={cache:{}};if(k)try{var b=this.getNative().createRange();if(!b||b.item&&b.item(0).ownerDocument!=a||b.parentElement&&b.parentElement().ownerDocument!=a)this.isInvalid=f}catch(c){this.isInvalid=f}}function j(b){b=new g(b);return!b||b.isInvalid?a:b}var i=d.Editor;i.SELECTION={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var f=!0,a=null,c=d.UA,e=d.DOM,b=d.Node,o=i.SELECTION,h=i.RANGE,k=c.ie,s=i.Walker,r=i.Range,
p={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};d.augment(g,{getNative:!k?function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=e._getWin(this.document).getSelection())}:function(){var a=this._.cache;return a.nativeSel||(a.nativeSel=this.document.selection)},getType:!k?function(){var a=this._.cache;if(a.type)return a.type;var b=o.SELECTION_TEXT,c=this.getNative();if(c){if(1==c.rangeCount){var c=
c.getRangeAt(0),d=c.startContainer;d==c.endContainer&&d.nodeType==e.NodeType.ELEMENT_NODE&&1==Number(c.endOffset-c.startOffset)&&p[d.childNodes[c.startOffset].nodeName.toLowerCase()]&&(b=o.SELECTION_ELEMENT)}}else b=o.SELECTION_NONE;return a.type=b}:function(){var a=this._.cache;if(a.type)return a.type;var b=o.SELECTION_NONE;try{var c=this.getNative(),e=c.type;"Text"==e&&(b=o.SELECTION_TEXT);"Control"==e&&(b=o.SELECTION_ELEMENT);c.createRange().parentElement&&(b=o.SELECTION_TEXT)}catch(d){}return a.type=
b},getRanges:k?function(){var c=function(b,c){b=b.duplicate();b.collapse(c);for(var d=b.parentElement(),l=d.childNodes,h,f=0;f<l.length;f++){var k=l[f];if(k.nodeType==e.NodeType.ELEMENT_NODE){h=b.duplicate();h.moveToElementText(k);var k=h.compareEndPoints("StartToStart",b),g=h.compareEndPoints("EndToStart",b);h.collapse();if(0<k)break;else{if(!k||1==g&&-1==k)return{container:d,offset:f};if(!g)return{container:d,offset:f+1}}h=a}}h||(h=b.duplicate(),h.moveToElementText(d),h.collapse(!1));h.setEndPoint("StartToStart",
b);h=(""+h.text).replace(/\r\n|\r/g,"\n").length;try{for(;0<h;)h-=l[--f].nodeValue.length}catch(m){h=0}return 0===h?{container:d,offset:f}:{container:l[f],offset:-h}};return function(a){var e=this._.cache;if(e.ranges&&!a)return e.ranges;var d=this.getNative(),a=d&&d.createRange(),h=this.getType();if(!d)return[];if(h==o.SELECTION_TEXT)return d=new r(this.document),h=c(a,f),d.setStart(new b(h.container),h.offset),h=c(a),d.setEnd(new b(h.container),h.offset),e.ranges=[d];if(h==o.SELECTION_ELEMENT){e=
e.ranges=[];for(h=0;h<a.length;h++){for(var k=a.item(h),g=k.parentNode,m=0,d=new r(this.document);m<g.childNodes.length&&g.childNodes[m]!=k;m++);d.setStart(new b(g),m);d.setEnd(new b(g),m+1);e.push(d)}return e}return e.ranges=[]}}():function(a){var c=this._.cache;if(c.ranges&&!a)return c.ranges;var a=[],e=this.getNative();if(!e)return[];for(var d=0;d<e.rangeCount;d++){var h=e.getRangeAt(d),f=new r(this.document);f.setStart(new b(h.startContainer),h.startOffset);f.setEnd(new b(h.endContainer),h.endOffset);
a.push(f)}return c.ranges=a},getStartElement:function(){var a=this._.cache;if(void 0!==a.startElement)return a.startElement;var c,d=this.getNative();switch(this.getType()){case o.SELECTION_ELEMENT:return this.getSelectedElement();case o.SELECTION_TEXT:var h=this.getRanges()[0];if(h&&!h.collapsed){for(h.optimize();f;)if(c=h.startContainer,h.startOffset==(c[0].nodeType===e.NodeType.ELEMENT_NODE?c[0].childNodes.length:c[0].nodeValue.length)&&!c._4e_isBlockBoundary())h.setStartAfter(c);else break;c=h.startContainer;
if(c[0].nodeType!=e.NodeType.ELEMENT_NODE)return c.parent();c=new b(c[0].childNodes[h.startOffset]);if(!c[0]||c[0].nodeType!=e.NodeType.ELEMENT_NODE)return h.startContainer;for(h=c[0].firstChild;h&&h.nodeType==e.NodeType.ELEMENT_NODE;)c=new b(h),h=h.firstChild;return c}if(k)h=d.createRange(),h.collapse(f),c=new b(h.parentElement());else{if((c=d.anchorNode)&&c.nodeType!=e.NodeType.ELEMENT_NODE)c=c.parentNode;c&&(c=new b(c))}}return a.startElement=c},getSelectedElement:function(){var a,c=this._.cache;
if(void 0!==c.selectedElement)return c.selectedElement;k&&(a=this.getNative().createRange(),a=a.item&&a.item(0));var d;if(a)d=new b(a);else{a=this.getRanges()[0];for(var f,g=2;g&&(!(d=a.getEnclosedNode())||!(d[0].nodeType==e.NodeType.ELEMENT_NODE&&p[d.nodeName()]&&(f=d)));g--)a.shrink(h.SHRINK_ELEMENT);d=f}return c.selectedElement=d},reset:function(){this._.cache={}},selectElement:function(a){var b,c=this.document;if(k)try{b=c.body.createControlRange(),b.addElement(a[0]),b.select()}catch(e){b=c.body.createTextRange(),
b.moveToElementText(a[0]),b.select()}finally{}else b=c.createRange(),b.selectNode(a[0]),a=this.getNative(),a.removeAllRanges(),a.addRange(b);this.reset()},selectRanges:function(a){if(k){if(1<a.length){var b=a[a.length-1];a[0].setEnd(b.endContainer,b.endOffset);a.length=1}a[0]&&a[0].select()}else{b=this.getNative();if(!b)return;b.removeAllRanges();for(var d=0;d<a.length;d++){var h=a[d],f=this.document.createRange(),g=h.startContainer;if(h.collapsed&&(c.gecko&&1.09>c.gecko||c.opera||c.webkit)&&g[0].nodeType==
e.NodeType.ELEMENT_NODE&&!g[0].childNodes.length)g[0].appendChild(this.document.createTextNode(c.webkit?"\u200b":"")),h.startOffset++,h.endOffset++;f.setStart(g[0],h.startOffset);f.setEnd(h.endContainer[0],h.endOffset);b.addRange(f)}}this.reset()},createBookmarks2:function(a){for(var b=[],c=this.getRanges(),e=0;e<c.length;e++)b.push(c[e].createBookmark2(a));return b},createBookmarks:function(a,b){for(var c=[],h=this.document,k,b=b||this.getRanges(),g=b.length,m=0;m<g;m++){c.push(k=b[m].createBookmark(a,
f));var o=(a=k.serializable)?d.one("#"+k.startNode,h):k.startNode;k=a?d.one("#"+k.endNode,h):k.endNode;for(var q=m+1;q<g;q++){var i=b[q],j=i.startContainer,p=i.endContainer;e.equals(j,o.parent())&&i.startOffset++;e.equals(j,k.parent())&&i.startOffset++;e.equals(p,o.parent())&&i.endOffset++;e.equals(p,k.parent())&&i.endOffset++}}return c},selectBookmarks:function(a){for(var b=[],c=0;c<a.length;c++){var e=new r(this.document);e.moveToBookmark(a[c]);b.push(e)}this.selectRanges(b);return this},getCommonAncestor:function(){var a=
this.getRanges();return a[0].startContainer._4e_commonAncestor(a[a.length-1].endContainer)},scrollIntoView:function(){var a=this.getStartElement();a&&a.scrollIntoView(void 0,!1)},removeAllRanges:function(){var a=this.getNative();k?a&&a.clear():a&&a.removeAllRanges()}});var m={table:1,tbody:1,tr:1},q=s.whitespaces(f),t=/\ufeff|\u00a0/;r.prototype.select=r.prototype.select=!k?function(){var a=this.startContainer;this.collapsed&&a[0].nodeType==e.NodeType.ELEMENT_NODE&&!a[0].childNodes.length&&a[0].appendChild(this.document.createTextNode(""));
var b=this.document.createRange();b.setStart(a[0],this.startOffset);try{b.setEnd(this.endContainer[0],this.endOffset)}catch(c){if(0<=c.toString().indexOf("NS_ERROR_ILLEGAL_VALUE"))this.collapse(f),b.setEnd(this.endContainer[0],this.endOffset);else throw c;}a=j(this.document).getNative();a.removeAllRanges();a.addRange(b)}:function(a){var c=this.collapsed,d,k;if(this.startContainer[0]===this.endContainer[0]&&1==this.endOffset-this.startOffset){var o=this.startContainer[0].childNodes[this.startOffset];
if(o.nodeType==e.NodeType.ELEMENT_NODE){(new g(this.document)).selectElement(new b(o));return}}(this.startContainer[0].nodeType==e.NodeType.ELEMENT_NODE&&this.startContainer.nodeName()in m||this.endContainer[0].nodeType==e.NodeType.ELEMENT_NODE&&this.endContainer.nodeName()in m)&&this.shrink(h.SHRINK_ELEMENT,f);var i=this.createBookmark(),o=i.startNode,j;c||(j=i.endNode);i=this.document.body.createTextRange();i.moveToElementText(o[0]);i.moveStart("character",1);if(j)a=this.document.body.createTextRange(),
a.moveToElementText(j[0]),i.setEndPoint("EndToEnd",a),i.moveEnd("character",-1);else{for(d=o[0].nextSibling;d&&!q(d);)d=d.nextSibling;d=!(d&&d.nodeValue&&d.nodeValue.match(t))&&(a||!o[0].previousSibling||o[0].previousSibling&&"br"==e.nodeName(o[0].previousSibling));k=new b(this.document.createElement("span"));k.html("&#65279;");k.insertBefore(o);d&&e.insertBefore(this.document.createTextNode("\ufeff"),o[0]||o)}this.setStartBefore(o);o._4e_remove();if(c){if(d?(i.moveStart("character",-1),i.select(),this.document.selection.clear()):
i.select(),k)this.moveToPosition(k,h.POSITION_BEFORE_START),k._4e_remove()}else this.setEndBefore(j),j._4e_remove(),i.select()};g.getSelection=j;return i.Selection=g},{requires:["./base","./walker","./range","./dom"]});
KISSY.add("editor/core/selectionFix",function(d,g){function j(a){function c(a,e){var d=g.body.createTextRange();try{d.moveToPoint(a,e)}catch(h){d=b}return d}function e(){var a=g.selection.createRange();o&&!a.item&&0===a.compareEndPoints("StartToEnd",a)&&o.select();h.remove(g,"mouseup",e);h.remove(g,"mousemove",d);o=k=0}function d(a){if(a.button){if(a=c(a.pageX,a.pageY))0<a.compareEndPoints("StartToStart",o)?a.setEndPoint("StartToStart",o):a.setEndPoint("EndToEnd",o),a.select()}else e()}var k,f=a.get("window")[0],
g=a.get("document")[0],o;h.on(g,"mousedown contextmenu",function(a){var b=g.documentElement;if(a.target===b&&(k&&e(),!(b.scrollHeight>b.clientHeight)&&(k=1,o=c(a.pageX,a.pageY))))h.on(g,"mouseup",e),h.on(g,"mousemove",d),f.focus(),o.select()})}function i(a){function d(b){if(i){var e=a.getSelection(),k=e&&e.getType(),f=e&&h.selection;if(b&&f&&k==r.SELECTION_NONE&&!h.queryCommandEnabled("InsertImage"))setTimeout(function(){d(c)},50);else{var g;if(!f||!f.type||!("Control"!=f.type&&(g=f.createRange())&&
(g=g.parentElement())&&(g=g.nodeName)&&g.toLowerCase()in{input:1,textarea:1}))o=f&&e.getRanges()[0],a.checkSelectionChange()}}}var h=a.get("document")[0],k=new s(h.body),f=new s(h.documentElement);if(8>g.Utils.ieEngine)f.on("click",function(b){"html"===(new s(b.target)).nodeName()&&a.getSelection().getNative().createRange().select()});var o,i,j=c;f.on("mousedown",function(){j=e});f.on("mouseup",function(){j=c});k.on("focusin",function(a){if("body"==(new s(a.target)).nodeName()&&o){try{j&&o.select()}catch(c){}o=
b}});k.on("focus",function(){i=c;d()});k.on("beforedeactivate",function(a){a.relatedTarget||(i=e,j=c)});k.on("mousedown",function(){i=e});k.on("mouseup",function(){i=c;setTimeout(function(){d(c)},0)});k.on("keydown",function(){i=e});k.on("keyup",function(){i=c;setTimeout(function(){d()},0)})}function f(a){var b=a.get("document")[0];h.on(b,"mouseup keyup selectionchange",function(){a.checkSelectionChange()})}function a(a){function b(a){var c=g.XHTML_DTD;return a._4e_isBlockBoundary()&&c.$empty[a.nodeName()]}
function d(a){return f(a)&&i(a)}var h=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<\!--[\s\S]*?--\>))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,f=g.Walker.whitespaces(c),i=g.Walker.bookmark(e,c),n=function(a){return f(a)&&8!=a.nodeType};a.on("selectionChange",function(f){var l=f.path,i=new s(a.get("document")[0].body),f=(f=f.selection)&&f.getRanges()[0],j=l.blockLimit;if(o.gecko){var r=l.block||l.blockLimit,v=r&&r.last(d);r&&r._4e_isBlockBoundary()&&(!v||!(1==v[0].nodeType&&
v._4e_isBlockBoundary()))&&"pre"!=r.nodeName()&&!r._4e_getBogus()&&r._4e_appendBogus()}if(f&&f.collapsed&&!l.block){if("body"==j.nodeName()){if((l=f.fixBlock(c,"p"))&&l[0]!=i[0].lastChild&&l._4e_outerHtml().match(h))if((j=l.next(n,1))&&j[0].nodeType==k.NodeType.ELEMENT_NODE&&!b[j])f.moveToElementEditablePosition(j),l._4e_remove();else if((j=l.prev(n,1))&&j[0].nodeType==k.NodeType.ELEMENT_NODE&&!b[j])f.moveToElementEditablePosition(j,j._4e_outerHtml().match(h)?e:c),l._4e_remove();f.select();a.notifySelectionChange()}l=
a.get("document")[0];f=new g.Range(l);f.moveToElementEditablePosition(i,c);"body"!==(new g.ElementPath(f.startContainer)).blockLimit.nodeName()&&(i=(new s(l.createElement("p"))).appendTo(i),o.ie||i._4e_appendBogus())}})}var c=!0,e=!1,b=null,o=d.UA,h=d.Event,k=d.DOM,s=d.Node,r=g.SELECTION;return{init:function(b){b.docReady(function(){o.ie?(j(b),i(b)):f(b)});a(b)}}},{requires:["./base","./selection"]});
KISSY.add("editor/core/styles",function(d,g){function j(a){return!y.attr(a,"_ke_bookmark")}function i(a,b){for(var c in a)"string"==typeof a[c]?a[c]=a[c].replace(M,function(a,c){return b[c]}):i(a[c],b)}function f(a,b){b&&(a=d.clone(a),i(a,b));var c=this.element=this.element=(a.element||"*").toLowerCase();this.type=this.type="#text"==c||L[c]?C.STYLE_BLOCK:J[c]?C.STYLE_OBJECT:C.STYLE_INLINE;this._={definition:a}}function a(a,b){var c=b?this.removeFromRange:this.applyToRange;a.body.focus();for(var e=
new D(a),d=e.getRanges(),h=0;h<d.length;h++)c.call(this,d[h]);e.selectRanges(d)}function c(a,b,c){var e=a.element;"*"==e&&(e="span");b=new E(b.createElement(e));c&&c._4e_copyAttributes(b);c=a._.definition;a=c.attributes;c=f.getStyleText(c);if(a)for(var d in a)b.attr(d,a[d]);c&&(b[0].style.cssText=c);return b}function e(a){var e=a.createBookmark(w),d=a.createIterator();d.enforceRealBlocks=w;d.enlargeBr=w;for(var f,k=a.document;f=d.getNextParagraph();){var g=c(this,k,f),l=g,g="pre"==l.nodeName,i="pre"==
f.nodeName,m=!g&&i;g&&!i?(i=f,m=i.html(),m=b(m,/(?:^[ \t\n\r]+)|(?:[ \t\n\r]+$)/g,""),m=m.replace(/[ \t\r\n]*(<br[^>]*>)[ \t\r\n]*/gi,"$1"),m=m.replace(/([ \t\n\r]+|&nbsp;)/g," "),m=m.replace(/<br\b[^>]*>/gi,"\n"),H.ie?(i=i[0].ownerDocument.createElement("div"),i.appendChild(l[0]),l[0].outerHTML="<pre>"+m+"</pre>",l=new E(i.firstChild),l._4e_remove()):l.html(m)):m?l=h(o(f),l):f._4e_moveChildren(l);f[0].parentNode.replaceChild(l[0],f[0]);if(g&&(f=l,g=void 0,(g=f._4e_previousSourceNode(w,y.NodeType.ELEMENT_NODE))&&
"pre"==g.nodeName()))l=b(g.html(),/\n$/,"")+"\n\n"+b(f.html(),/^\n/,""),H.ie?f[0].outerHTML="<pre>"+l+"</pre>":f.html(l),g._4e_remove()}a.moveToBookmark(e)}function b(a,b,c){var e="",d="",a=a.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(a,b,c){b&&(e=b);c&&(d=c);return""});return e+a.replace(b,c)+d}function o(a){var c=[];b(a._4e_outerHtml(),/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,function(a,b,c){return b+"</pre>"+c+"<pre>"}).replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,
function(a,b){c.push(b)});return c}function h(a,c){for(var e=c[0].ownerDocument.createDocumentFragment(),d=0;d<a.length;d++){var h=a[d],h=h.replace(/(\r\n|\r)/g,"\n"),h=b(h,/^[ \t]*\n/,""),h=b(h,/\n$/,""),h=b(h,/^[ \t]+|[ \t]+$/g,function(a,b){return 1==a.length?"&nbsp;":b?" "+Array(a.length).join("&nbsp;"):Array(a.length).join("&nbsp;")+" "}),h=h.replace(/\n/g,"<br>"),h=h.replace(/[ \t]{2,}/g,function(a){return Array(a.length).join("&nbsp;")+" "}),f=c.clone();f.html(h);e.appendChild(f[0])}return e}
function k(a){var b=a.document;if(a.collapsed)b=c(this,b,void 0),a.insertNode(b),a.moveToPosition(b,B.POSITION_BEFORE_END);else{var e=this.element,d=this._.definition,h,f=G[e];f||(h=w,f=G.span);var k=a.createBookmark();a.enlarge(B.ENLARGE_ELEMENT);a.trim();for(var g=a.createBookmark(),m=g.startNode,g=g.endNode,i=m,o;i&&i[0];){var q=x;if(y.equals(i,g))i=z,q=w;else{var n=i[0].nodeType,p=n==y.NodeType.ELEMENT_NODE?i.nodeName():z;if(p&&i.attr("_ke_bookmark")){i=i._4e_nextSourceNode(w);continue}if(!p||
f[p]&&(i._4e_position(g)|A.POSITION_PRECEDING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_PRECEDING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED&&(!d.childRule||d.childRule(i))){var s=i.parent();if(s&&"a"==e&&s.nodeName()==e)n=c(this,b,void 0),s._4e_moveChildren(n),s[0].parentNode.replaceChild(n[0],s[0]),n._4e_mergeSiblings();else if(s&&s[0]&&((G[s.nodeName()]||G.span)[e]||h)&&(!d.parentRule||d.parentRule(s))){if(!o&&(!p||!G.$removeEmpty[p]||(i._4e_position(g)|A.POSITION_PRECEDING|A.POSITION_IDENTICAL|
A.POSITION_IS_CONTAINED)==A.POSITION_PRECEDING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED))o=new F(b),o.setStartBefore(i);if(n==y.NodeType.TEXT_NODE||n==y.NodeType.ELEMENT_NODE&&!i[0].childNodes.length){s=i;for(n=null;(q=!s.next(j,1))&&(n=s.parent())&&f[n.nodeName()]&&(n._4e_position(m)|A.POSITION_FOLLOWING|A.POSITION_IDENTICAL|A.POSITION_IS_CONTAINED)==A.POSITION_FOLLOWING+A.POSITION_IDENTICAL+A.POSITION_IS_CONTAINED&&(!d.childRule||d.childRule(n));)s=n;o.setEndAfter(s)}}else q=w}else q=w;i=i._4e_nextSourceNode()}if(q&&
o&&!o.collapsed){for(var q=c(this,b,void 0),s=o.getCommonAncestor(),n={},p={},t,r=null,v;q&&s&&q[0]&&s[0];){if(s.nodeName()==e){for(t in d.attributes)if(!p[t]&&(v=s.attr(r)))q.attr(t)==v?q.removeAttr(t):p[t]=1;for(r in d.styles)if(!n[r]&&(v=s.style(r)))q.style(r)==v?q.style(r,""):n[r]=1;if(!q._4e_hasAttributes()){q=z;break}}s=s.parent()}q?(q[0].appendChild(o.extractContents()),l(this,q),o.insertNode(q),q._4e_mergeSiblings(),H.ie||q[0].normalize()):(q=new E(b.createElement("span")),q[0].appendChild(o.extractContents()),
o.insertNode(q),l(this,q),q._4e_remove(!0));o=z}}m._4e_remove();g._4e_remove();a.moveToBookmark(k);a.shrink(B.SHRINK_TEXT)}}function s(a){a.enlarge(B.ENLARGE_ELEMENT);var b=a.createBookmark(),c=b.startNode;if(a.collapsed){for(var e=new I(c.parent()),d,h=0,f;h<e.elements.length&&(f=e.elements[h])&&!(f==e.block||f==e.blockLimit);h++)if(this.checkElementRemovable(f)){var k=a.checkBoundaryOfElement(f,B.END),g=!k&&a.checkBoundaryOfElement(f,B.START);g||k?(d=f,d.match=g?"start":"end"):(f._4e_mergeSiblings(),
f.nodeName()!=this.element?(k=m(this),v(f,k[f.nodeName()]||k["*"])):q(this,f))}if(d){f=c;for(h=0;;h++){k=e.elements[h];if(k.equals(d))break;else if(k.match)continue;else k=k.clone();k[0].appendChild(f[0]);f=k}f["start"==d.match?"insertBefore":"insertAfter"](d);e=d.html();!e||"\u200b"==e?d.remove():H.webkit&&u(a.document.createTextNode("\u200b")).insertBefore(f)}}else{var l=b.endNode,i=this;d=function(){for(var a=new I(c.parent()),b=new I(l.parent()),e=z,d=z,h=0;h<a.elements.length;h++){var f=a.elements[h];
if(f==a.block||f==a.blockLimit)break;i.checkElementRemovable(f)&&(e=f)}for(h=0;h<b.elements.length;h++){f=b.elements[h];if(f==b.block||f==b.blockLimit)break;i.checkElementRemovable(f)&&(d=f)}d&&l._4e_breakParent(d);e&&c._4e_breakParent(e)};d();for(e=new E(c[0].nextSibling);e[0]!==l[0];){h=e._4e_nextSourceNode();if(e[0]&&e[0].nodeType==y.NodeType.ELEMENT_NODE&&this.checkElementRemovable(e)&&(e.nodeName()==this.element?q(this,e):(f=m(this),v(e,f[e.nodeName()]||f["*"])),h[0].nodeType==y.NodeType.ELEMENT_NODE&&
h.contains(c)))d(),h=new E(c[0].nextSibling);e=h}}a.moveToBookmark(b)}function r(a){var b={};(""+a).replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(a,c,e){b[c]=e});return b}function p(a,b){var c="";b!==x?(c=document.createElement("span"),c.style.cssText=a,c=c.style.cssText||""):c=a;return c.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function m(a){if(a._.overrides)return a._.overrides;var b=a._.overrides={},c=a._.definition.overrides;
if(c){d.isArray(c)||(c=[c]);for(var e=0;e<c.length;e++){var h=c[e],f,k,g;"string"==typeof h?f=h.toLowerCase():(f=h.element?h.element.toLowerCase():a.element,k=h.attributes,g=h.styles);h=b[f]||(b[f]={});if(k){f=h.attributes=h.attributes||[];for(var l in k)f.push([l.toLowerCase(),k[l]])}if(g){var h=h.styles=h.styles||[],i;for(i in g)h.push([i.toLowerCase(),g[i]])}}}return b}function q(a,b){var c=a._.definition,e=m(a),h=d.merge(c.attributes,(e[b.nodeName()]||e["*"]||{}).attributes),c=d.merge(c.styles,
(e[b.nodeName()]||e["*"]||{}).styles),e=d.isEmptyObject(h)&&d.isEmptyObject(c),f;for(f in h)("class"==f||a._.definition.fullMatch)&&b.attr(f)!=t(f,h[f])||(e=e||!!b.hasAttr(f),b.removeAttr(f));for(var k in c)a._.definition.fullMatch&&b.style(k)!=t(k,c[k],w)||(e=e||!!b.style(k),b.style(k,""));n(b)}function t(a,b,c){var e=new E("<span>");e[c?"style":"attr"](a,b);return e[c?"style":"attr"](a)}function l(a,b){for(var c=m(a),e=b.all(a.element),d=e.length;0<=--d;)q(a,new E(e[d]));for(var h in c)if(h!=a.element){e=
b.all(h);for(d=e.length-1;0<=d;d--){var f=new E(e[d]);v(f,c[h])}}}function v(a,b){var c,e=b&&b.attributes;if(e)for(c=0;c<e.length;c++){var d=e[c][0],h;if(h=a.attr(d)){var f=e[c][1];(f===z||f.test&&f.test(h)||"string"==typeof f&&h==f)&&a[0].removeAttribute(d)}}if(e=b&&b.styles)for(c=0;c<e.length;c++)if(d=e[c][0],f=a.css(d)){var k=e[c][1];(k===z||k.test&&k.test(h)||"string"==typeof k&&f==k)&&a.css(d,"")}n(a)}function n(a){if(!a._4e_hasAttributes()){var b=a[0].firstChild,c=a[0].lastChild;a._4e_remove(w);
b&&(b.nodeType==y.NodeType.ELEMENT_NODE&&y._4e_mergeSiblings(b),c&&b!=c&&c.nodeType==y.NodeType.ELEMENT_NODE&&y._4e_mergeSiblings(c))}}var w=!0,x=!1,z=null,u=d.all,y=d.DOM,C={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},B=g.RANGE,D=g.Selection,A=g.POSITION,F=g.Range,E=d.Node,H=d.UA,I=g.ElementPath,L={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},G=g.XHTML_DTD,J={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},K=/\s*(?:;\s*|$)/g,M=/#\((.+?)\)/g;g.STYLE=
C;f.prototype={apply:function(b){a.call(this,b,x)},remove:function(b){a.call(this,b,w)},applyToRange:function(a){return(this.applyToRange=this.type==C.STYLE_INLINE?k:this.type==C.STYLE_BLOCK?e:z).call(this,a)},removeFromRange:function(a){return(this.removeFromRange=this.type==C.STYLE_INLINE?s:z).call(this,a)},checkElementRemovable:function(a,b){if(!a)return x;var c=this._.definition,e;if(a.nodeName()==this.element){if(!b&&!a._4e_hasAttributes())return w;var d=c._AC;if(d)c=d;else{var d={},h=0,k=c.attributes;
if(k)for(var g in k)h++,d[g]=k[g];if(k=f.getStyleText(c))d.style||h++,d.style=k;d._length=h;c=c._AC=d}if(c._length){for(var l in c)if("_length"!=l){h=a.attr(l)||"";if("style"==l)a:{d=c[l];h=p(h,x);"string"==typeof d&&(d=r(d));"string"==typeof h&&(h=r(h));k=void 0;for(k in d)if(!(k in h&&(h[k]==d[k]||"inherit"==d[k]||"inherit"==h[k]))){d=x;break a}d=w}else d=c[l]==h;if(d){if(!b)return w}else if(b)return x}if(b)return w}else return w}l=m(this);if(l=l[a.nodeName()]||l["*"]){if(!(c=l.attributes)&&!(e=
l.styles))return w;if(c)for(d=0;d<c.length;d++)if(l=c[d][0],l=a.attr(l))if(h=c[d][1],h===z||"string"==typeof h&&l==h||h.test&&h.test(l))return w;if(e)for(d=0;d<e.length;d++)if(l=a.css(e[d][0]))if(c=e[d][1],c===z||"string"==typeof c&&l==c||c.test&&c.test(l))return w}return x},checkActive:function(a){switch(this.type){case C.STYLE_BLOCK:return this.checkElementRemovable(a.block||a.blockLimit,w);case C.STYLE_OBJECT:case C.STYLE_INLINE:for(var b=a.elements,c=0,e;c<b.length;c++)if(e=b[c],!(this.type==
C.STYLE_INLINE&&(y.equals(e,a.block)||y.equals(e,a.blockLimit))))if((this.type!=C.STYLE_OBJECT||e.nodeName()in J)&&this.checkElementRemovable(e,w))return w}return x}};f.getStyleText=function(a){var b=a._ST;if(b)return b;var b=a.styles,c=a.attributes&&a.attributes.style||"",e="";c.length&&(c=c.replace(K,";"));for(var d in b){var h=b[d],f=(d+":"+h).replace(K,";");"inherit"==h?e+=f:c+=f}c.length&&(c=p(c));return a._ST=c+e};return g.Style=f},{requires:["./base","./range","./selection","./domIterator",
"./elementPath"]});
KISSY.add("editor/core/utils",function(d){var g=d.Node,j=d.DOM,i=d.UA,f={debugUrl:function(a){var c=d.Config;c.debug||(a=a.replace(/\.(js|css)/i,"-min.$1"));-1==a.indexOf("?t")&&(a=-1!=a.indexOf("?")?a+"&":a+"?",a+="t="+encodeURIComponent(c.tag));return c.base+"editor/"+a},lazyRun:function(a,c,e){var b=a[c],d=a[e];a[c]=function(){b.apply(this,arguments);a[c]=a[e];return d.apply(this,arguments)}},getXY:function(a,c){var e=a.left,b=a.top,d=c.get("window")[0],e=e-j.scrollLeft(d),b=b-j.scrollTop(d),d=
c.get("iframe").offset(),e=e+d.left,b=b+d.top;return{left:e,top:b}},tryThese:function(a){for(var c,e=0,b=arguments.length;e<b;e++){var d=arguments[e];try{c=d();break}catch(h){}}return c},arrayCompare:function(a,c){if(!a&&!c)return!0;if(!a||!c||a.length!=c.length)return!1;for(var e=0;e<a.length;e++)if(a[e]!==c[e])return!1;return!0},clearAllMarkers:function(a){for(var c in a)a[c]._4e_clearMarkers(a,!0,void 0)},ltrim:function(a){return a.replace(/^\s+/,"")},rtrim:function(a){return a.replace(/\s+$/,
"")},isNumber:function(a){return/^\d+(.\d+)?$/.test(d.trim(a))},verifyInputs:function(a){for(var c=0;c<a.length;c++){var e=new g(a[c]),b=d.trim(f.valInput(e)),i=e.attr("data-verify"),e=e.attr("data-warning");if(i&&!RegExp(i).test(b))return alert(e),!1}return!0},sourceDisable:function(a,c){a.on("sourceMode",c.disable,c);a.on("wysiwygMode",c.enable,c)},resetInput:function(a){var c=a.attr("placeholder");c&&i.ie?(a.addClass("ks-editor-input-tip"),a.val(c)):i.ie||a.val("")},valInput:function(a,c){if(void 0===
c)return a.hasClass("ks-editor-input-tip")?"":a.val();a.removeClass("ks-editor-input-tip");a.val(c)},placeholder:function(a,c){a.attr("placeholder",c);i.ie&&(a.on("blur",function(){d.trim(a.val())||(a.addClass("ks-editor-input-tip"),a.val(c))}),a.on("focus",function(){a.removeClass("ks-editor-input-tip");d.trim(a.val())==c&&a.val("")}))},htmlEncode:function(a){return!a?a:(""+a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},normParams:function(a){var a=d.clone(a),
c;for(c in a){var e=a[c];d.isFunction(e)&&(a[c]=e())}return a},map:function(a,c){for(var e=0;e<a.length;e++)a[e]=c(a[e]);return a},ieEngine:document.documentMode||i.ie,preventFocus:function(a){i.ie?a.unselectable(void 0):a.attr("onmousedown","return false;")},injectDom:function(a){d.mix(j,a);for(var c in a)(function(c){g.prototype[c]=function(){var b=[].slice.call(arguments,0);b.unshift(this[0]);return(b=a[c].apply(null,b))&&(b.nodeType||d.isWindow(b))?new g(b):d.isArray(b)&&(b.__IS_NODELIST||b[0]&&
b[0].nodeType)?new g(b):b}})(c)},addRes:function(){var a=this.__res=this.__res||[];a.push.apply(a,d.makeArray(arguments))},destroyRes:function(){for(var a=this.__res||[],c=0;c<a.length;c++){var e=a[c];d.isFunction(e)?e():e.destroy?e.destroy():e.remove&&e.remove()}this.__res=[]},getQueryCmd:function(a){return"query"+("-"+a).replace(/-(\w)/g,function(a,e){return e.toUpperCase()})+"Value"}};return d.Editor.Utils=f},{requires:["./base"]});
KISSY.add("editor/core/walker",function(d,g){function j(b,d){if(this._.end)return e;var h,f=this.range,g,i=this.guard,m=this.type,j=b?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start&&(this._.start=1,f.trim(),f.collapsed))return this.end(),e;if(!b&&!this._.guardLTR){var s=f.endContainer[0],p=s.childNodes[f.endOffset];this._.guardLTR=function(a,b){return b&&(s==a||"body"==o.nodeName(a))?!1:a!=p}}if(b&&!this._.guardRTL){var r=f.startContainer[0],B=0<f.startOffset&&r.childNodes[f.startOffset-
1]||null;this._.guardRTL=function(a,b){return b&&(r==a||"body"==o.nodeName(a))?!1:a!=B}}var D=b?this._.guardRTL:this._.guardLTR;g=i?function(a,b){return D(a,b)===c?c:i(a,b)}:D;this.current?h=this.current[j](c,m,g):b?(h=f.endContainer,0<f.endOffset?(h=new k(h[0].childNodes[f.endOffset-1]),g(h[0])===c&&(h=e)):h=g(h,a)===c?e:h._4e_previousSourceNode(a,m,g,void 0)):(h=f.startContainer,h=new k(h[0].childNodes[f.startOffset]),h.length?g(h[0])===c&&(h=e):h=g(f.startContainer,a)===c?e:f.startContainer._4e_nextSourceNode(a,
m,g,void 0));for(;h&&!this._.end;){this.current=h;if(!this.evaluator||this.evaluator(h[0])!==c){if(!d)return h}else if(d&&this.evaluator)return c;h=h[j](c,m,g)}this.end();return this.current=e}function i(a){for(var b,c=e;b=j.call(this,a);)c=b;return c}function f(a){this.range=a;this.guard=this.evaluator=e;this._={}}var a=!0,c=!1,e=null,b=d.UA,o=d.DOM,h=g.XHTML_DTD,k=d.Node;d.augment(f,{end:function(){this._.end=1},next:function(){return j.call(this)},previous:function(){return j.call(this,a)},checkForward:function(){return j.call(this,
c,a)!==c},checkBackward:function(){return j.call(this,a,a)!==c},lastForward:function(){return i.call(this)},lastBackward:function(){return i.call(this,a)},reset:function(){delete this.current;this._={}},_iterator:j});d.mix(f,{blockBoundary:function(a){return function(b){return!(b.nodeType==o.NodeType.ELEMENT_NODE&&o._4e_isBlockBoundary(b,a))}},bookmark:function(a,b){function c(a){return"span"==o.nodeName(a)&&o.attr(a,"_ke_bookmark")}return function(e){var d,h;d=e.nodeType==o.NodeType.TEXT_NODE&&(h=
e.parentNode)&&c(h);d=a?d:d||c(e);return!!(b^d)}},whitespaces:function(a){return function(b){b=b.nodeType==o.NodeType.TEXT_NODE&&!d.trim(b.nodeValue);return!!(a^b)}},invisible:function(a){var b=f.whitespaces();return function(c){c=b(c)||c.nodeType==o.NodeType.ELEMENT_NODE&&!c.offsetHeight;return!!(a^c)}}});var s=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,r=f.whitespaces(),p=f.bookmark(),m=function(a){var b=o.nodeName(a);return p(a)||r(a)||1==a.nodeType&&b in h.$inline&&!(b in h.$empty)};g.Utils.injectDom({_4e_getBogus:function(a){a=
new k(a);do a=a._4e_previousSourceNode();while(a&&m(a[0]));return a&&(!b.ie?"br"==a.nodeName():3==a[0].nodeType&&s.test(a.text()))?a[0]:!1}});return g.Walker=f},{requires:["./base","./utils","./dom"]});KISSY.add("editor/core/zIndexManager",function(d){var g=d.Editor,d=g.zIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11E3,LOADING_CANCEL:12E3,SELECT:1200};g.baseZIndex=function(d){return(g.Config.baseZIndex||1E4)+d};return d},{requires:["./base"]});
KISSY.add("editor/plugin/back-color/cmd",function(d,g){var j={element:"span",styles:{"background-color":"#(color)"},overrides:[{element:"*",styles:{"background-color":null}}],childRule:function(){return!1}};return{init:function(d){d.hasCommand("backColor")||d.addCommand("backColor",{exec:function(d,a){d.execCommand("save");g.applyColor(d,a,j);d.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/back-color/index",function(d,g,j,i){function f(a){this.config=a||{}}d.augment(f,{renderUI:function(a){i.init(a);j.init(a,{defaultColor:"rgb(255, 217, 102)",cmdType:"backColor",tooltip:"\u80cc\u666f\u989c\u8272"})}});return f},{requires:["editor","../color/btn","./cmd"]});
KISSY.add("editor/plugin/bold/cmd",function(d,g,j){var i=new g.Style({element:"strong",overrides:[{element:"b"},{element:"span",attributes:{style:"font-weight: bold;"}}]});return{init:function(d){j.addButtonCmd(d,"bold",i)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/bold/index",function(d,g,j,i){function f(){}d.augment(f,{renderUI:function(a){i.init(a);a.addButton("bold",{cmdType:"bold",tooltip:"\u7c97\u4f53 "},j.Button);a.docReady(function(){a.get("document").on("keydown",function(c){c.ctrlKey&&c.keyCode==d.Node.KeyCodes.B&&(a.execCommand("bold"),c.preventDefault())})})}});return f},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/bubble/index",function(d,g,j){function i(a){var e=null,b=a.get("editor").getControls();d.each(b,function(b){var d;if(d=b.get)if(d=-1!=(b.get("elCls")||"").indexOf("bubble"))if(d=b!==a)if(d=b.get("visible")){d=a.get("y");var f=d+a.get("el").outerHeight(),g=b.get("y"),i=g+b.get("el").outerHeight();d=d<=i&&f>=i||d<=g&&f>=g}d&&(e?e.get("y")<b.get("y")&&(e=b):e=b);return e})}var f={}.a,a={zIndex:j.baseZIndex(j.zIndexManager.BUBBLE_VIEW),elCls:"{prefixCls}editor-bubble",prefixCls:"{prefixCls}editor-",
effect:{effect:"fade",duration:0.3}};j.prototype.addBubble=function(c,e,b){function o(){m.hide();var a=r.get("window");a&&(a.detach("scroll",k),q.stop())}function h(){var a;var b=m;if(a=b.get("editorSelectedEl")){var c=b.get("editor"),e=c.get("window"),h=c.get("iframe").offset(),b=h.top,h=h.left,k=h+e.width(),e=b+e.height(),g=a.offset(),g=j.Utils.getXY(g,c),c=g.top,g=g.left,o=g+a.width(),q=c+a.height(),s,p;d.UA.ie&&"img"==a[0].nodeName.toLowerCase()&&q>e?a=f:(q>e&&c<e?p=e-30:q>b&&q<e&&(p=q),o>h&&
g<h?s=h:g>h&&g<k&&(s=g),a=s!==f&&p!==f?[s,p]:f)}else a=f;if(a){m.set("xy",a);if(s=i(m))a[1]=s.get("y")+s.get("el").outerHeight(),m.set("xy",a);m.get("visible")||m.show()}}function k(){m.get("editorSelectedEl")&&(m.get("el"),m.hide(),q())}function s(){r.get("window").on("scroll",k);h()}var r=this,p=r.get("prefixCls"),m,b=b||{};b.editor=r;d.mix(b,a);b.elCls=d.substitute(b.elCls,{prefixCls:p});b.prefixCls=d.substitute(b.prefixCls,{prefixCls:p});m=new g(b);r.addControl(c+"/bubble",m);r.on("selectionChange",
function(a){var a=a.path,b=a.elements;if(a&&b&&(a=a.lastElement))(a=e(a))?(m.set("editorSelectedEl",a),m.hide(),d.later(s,10)):o()});r.on("sourceMode",o);var q=d.buffer(h,350)}},{requires:["overlay","editor"]});
KISSY.add("editor/plugin/button/index",function(d,g,j){g.prototype.addButton=function(i,f,a){void 0===a&&(a=j);var c=this.get("prefixCls")+"editor-toolbar-";f.elCls&&(f.elCls=c+f.elCls);f.elCls=c+"button "+(f.elCls||"");var e=(new a(d.mix({render:this.get("toolBarEl"),content:'<span class="'+c+"item "+c+i+'"></span>',prefixCls:this.get("prefixCls")+"editor-",editor:this},f))).render();e.get("el").unselectable();if(!f.content){var b=e.get("el").one("span");e.on("afterContentClsChange",function(a){b[0].className=
c+"item "+c+a.newVal})}e.get("mode")==g.WYSIWYG_MODE&&(this.on("wysiwygMode",function(){e.set("disabled",false)}),this.on("sourceMode",function(){e.set("disabled",true)}));this.addControl(i+"/button",e);return e};return j},{requires:["editor","button"]});
KISSY.add("editor/plugin/checkbox-source-area/index",function(d,g){function j(a){this.editor=a;this._init()}function i(){}var f=d.Node,a=g.SOURCE_MODE,c=g.WYSIWYG_MODE;d.augment(j,{_init:function(){var a=this.editor,b=a.get("statusBarEl");this.holder=(new f("<span style='zoom:1;display:inline-block;height:22px;line-height:22px;'><input style='margin:0 5px;vertical-align:middle;' type='checkbox' /><span style='vertical-align:middle;'>\u7f16\u8f91\u6e90\u4ee3\u7801</span></span>")).appendTo(b);(this.el=this.holder.one("input")).on("click",
this._check,this);a.on("wysiwygMode",this._wysiwygmode,this);a.on("sourceMode",this._sourcemode,this)},_sourcemode:function(){this.el.attr("checked",!0)},_wysiwygmode:function(){this.el.attr("checked",!1)},_check:function(){var e=this.editor;this.el.attr("checked")?e.set("mode",a):e.set("mode",c)},destroy:function(){this.holder.remove()}});d.augment(i,{renderUI:function(a){var b=new j(a);a.on("destroy",function(){b.destroy()})}});return i},{requires:["editor"]});
KISSY.add("editor/plugin/code/index",function(d,g,j){function i(){}d.augment(i,{renderUI:function(d){d.addButton("code",{tooltip:"\u63d2\u5165\u4ee3\u7801",listeners:{click:function(){j.useDialog(d,"code")}},mode:g.WYSIWYG_MODE})}});return i},{requires:["editor","../dialog-loader/"]});
KISSY.add("editor/plugin/color/btn",function(d,g,j,i,f){function a(a,b,c){setTimeout(function(){a.execCommand(b,c)},0)}var c=d.Node,e=["000,444,666,999,CCC,EEE,F3F3F3,FFF".split(","),"F00,F90,FF0,0F0,0FF,00F,90F,F0F".split(","),"F4CCCC,FCE5CD,FFF2CC,D9EAD3,D0E0E3,CFE2F3,D9D2E9,EAD1DC,EA9999,F9CB9C,FFE599,B6D7A8,A2C4C9,9FC5E8,B4A7D6,D5A6BD,E06666,F6B26B,FFD966,93C47D,76A5AF,6FA8DC,8E7CC3,C27BAD,CC0000,E69138,F1C232,6AA84F,45818E,3D85C6,674EA7,A64D79,990000,B45F06,BF9000,38761D,134F5C,0B5394,351C75,741B47,660000,783F04,7F6000,274E13,0C343D,073763,20124D,4C1130".split(",")],b;
(function(){b="<div class='{prefixCls}editor-color-panel'><a class='{prefixCls}editor-color-remove' href=\"javascript:void('\u6e05\u9664');\">\u6e05\u9664</a>";for(var a=0;3>a;a++){b+="<div class='{prefixCls}editor-color-palette'><table>";for(var c=e[a],d=c.length/8,f=0;f<d;f++){b+="<tr>";for(var g=0;8>g;g++){var i="#"+c[8*f+g];b+="<td>";b+="<a href='javascript:void(0);' class='{prefixCls}editor-color-a' style='background-color:"+i+"'></a>";b+="</td>"}b+="</tr>"}b+="</table></div>"}b+="<div><a class='{prefixCls}editor-button {prefixCls}editor-color-others ks-inline-block'>\u5176\u4ed6\u989c\u8272</a></div></div>"})();
var o=j.extend({initializer:function(){var a=this;a.on("blur",function(){setTimeout(function(){a.colorWin&&a.colorWin.hide()},150)});a.on("click",function(){a.get("checked")?a._prepare():a.colorWin&&a.colorWin.hide()})},_prepare:function(){var a=this,c=a.get("editor"),e=c.get("prefixCls"),o;a.colorWin=(new i({elAttrs:{tabindex:0},elCls:e+"editor-popup",content:d.substitute(b,{prefixCls:e}),width:172,zIndex:g.baseZIndex(g.zIndexManager.POPUP_MENU)})).render();var j=a.colorWin;o=j.get("contentEl");
o.on("click",a._selectColor,a);j.on("hide",function(){a.set("checked",!1)});o.one("."+e+"editor-color-others").on("click",function(b){b.halt();j.hide();f.useDialog(c,"color/color-picker",a)});a._prepare=a._show;a._show()},_show:function(){var a=this.get("el"),b=this.colorWin;b.set("align",{node:a,points:["bl","tl"],offset:[0,2],overflow:{adjustX:1,adjustY:1}});b.show()},_selectColor:function(a){a.halt();var b=this.get("editor").get("prefixCls"),a=new c(a.target);a.hasClass(b+"editor-color-a")&&this.fire("selectColor",
{color:a.style("background-color")})},destructor:function(){this.colorWin&&this.colorWin.destroy()}},{ATTRS:{checkable:{value:!0},mode:{value:g.WYSIWYG_MODE}}});o.init=function(b,c){var e=b.get("prefixCls")+"editor-toolbar-",f=c.cmdType,i=c.tooltip,m=b.addButton(f,{elCls:f+"Btn",content:d.substitute('<div class="{icon}"></div><div style="background-color:{defaultColor}" class="{indicator}"></div>',{defaultColor:c.defaultColor,icon:e+"item "+e+f,indicator:e+"color-indicator"}),mode:g.WYSIWYG_MODE,
tooltip:"\u8bbe\u7f6e"+i}),i=b.addButton(f+"Arrow",{tooltip:"\u9009\u62e9\u5e76\u8bbe\u7f6e"+i,elCls:f+"ArrowBtn"},o),j=m.get("el").one("."+e+"color-indicator");i.on("selectColor",function(c){j.css("background-color",c.color);a(b,f,c.color)});m.on("click",function(){a(b,f,j.style("background-color"))})};return o},{requires:["editor","../button/","../overlay/","../dialog-loader/"]});
KISSY.add("editor/plugin/color/cmd",function(d,g){return{applyColor:function(d,i,f){var a=d.get("document")[0];d.execCommand("save");i?(new g.Style(f,{color:i})).apply(a):(new g.Style(f,{color:"inherit"})).remove(a);d.execCommand("save")}}},{requires:["editor"]});
KISSY.add("editor/plugin/contextmenu/index",function(d,g,j,i){g.prototype.addContextMenu=function(f,a,c){var e=this,c=c||{};c.prefixCls=e.get("prefixCls")+"editor-";c.editor=e;c.focusable=1;c.zIndex=g.baseZIndex(g.zIndexManager.POPUP_MENU);c.children&&d.each(c.children,function(a){a.xclass="menuitem"});var b=new j.PopupMenu(c);i.init(b);b.on("afterRenderUI",function(){b.get("el").on("keydown",function(a){a.keyCode==d.Event.KeyCodes.ESC&&b.hide()})});e.docReady(function(){var c=e.get("document");c.on("mousedown",
function(a){1==a.which&&b.hide()});c.delegate("contextmenu",a,function(a){var c=d.all(a.target);a.halt();var f=a.pageX,i=a.pageY;f&&(a=g.Utils.getXY({left:f,top:i},e),f=a.left,i=a.top,setTimeout(function(){b.set("editorSelectedEl",c,{silent:1});b.set("xy",[f,i]);b.show();e.fire("contextmenu",{contextmenu:b});window.focus();document.body.focus();b.get("el")[0].focus()},30))})});e.addControl(f+"/contextmenu",b);return b}},{requires:["editor","menu","../focus-fix/"]});
KISSY.add("editor/plugin/dent-utils/cmd",function(d,g,j){function i(a){return a.nodeType==b.NodeType.ELEMENT_NODE&&"li"==b.nodeName(a)}function f(a,e,d){for(var f=a.startContainer,i=a.endContainer;f&&!f.parent().equals(e);)f=f.parent();for(;i&&!i.parent().equals(e);)i=i.parent();if(f&&i){for(var s=f,f=[],p=!1;!p;)s.equals(i)&&(p=!0),f.push(s),s=s.next();if(!(1>f.length)){var r=e._4e_parents(!0,void 0);r.each(function(a,b){r[b]=a});for(i=0;i<r.length;i++)if(c[r[i].nodeName()]){e=r[i];break}for(var s=
"indent"==d?1:-1,i=f[0],p=f[f.length-1],f={},u=j.listToArray(e,f),y=u[p.data("listarray_index")].indent,i=i.data("listarray_index");i<=p.data("listarray_index");i++){u[i].indent+=s;var C=u[i].parent;u[i].parent=new o(C[0].ownerDocument.createElement(C.nodeName()))}for(i=p.data("listarray_index")+1;i<u.length&&u[i].indent>y;i++)u[i].indent+=s;p=j.arrayToList(u,f,null,"p");s=[];if("outdent"==d){var B;if((B=e.parent())&&"li"==B.nodeName())for(var d=p.listNode.childNodes,D,i=d.length-1;0<=i;i--)(D=new o(d[i]))&&
"li"==D.nodeName()&&s.push(D)}p&&(b.insertBefore(p.listNode[0]||p.listNode,e[0]||e),e.remove());if(s&&s.length)for(i=0;i<s.length;i++){for(D=e=s[i];(D=D.next())&&D.nodeName()in c;)h.ie&&!e.first(function(a){return k(a)&&m(a)},1)&&e[0].appendChild(a.document.createTextNode("\u00a0")),e[0].appendChild(D[0]);b.insertAfter(e[0],B[0])}g.Utils.clearAllMarkers(f)}}}function a(a,b){var c=parseInt(a.style(s),10);isNaN(c)&&(c=0);c+=("indent"==b?1:-1)*r;if(0>c)return!1;c=Math.max(c,0);c=Math.ceil(c/r)*r;a.css(s,
c?c+p:"");""===a[0].style.cssText&&a.removeAttr("style");return!0}var c={ol:1,ul:1},e=g.Walker,b=d.DOM,o=d.Node,h=d.UA,k=e.whitespaces(!0),s="margin-left",r=40,p="px",m=e.bookmark(!1,!0);return{checkOutdentActive:function(a){var b=a.blockLimit;return a.contains(c)?!0:(a=a.block||b)&&a.style(s)},addCommand:function(d,h){d.hasCommand(h)||d.addCommand(h,{exec:function(d){d.execCommand("save");var g=d.getSelection(),k=g&&g.getRanges()[0];if(k){for(var m=k.startContainer,o=k.endContainer,j=k.getCommonAncestor();j&&
!(j[0].nodeType==b.NodeType.ELEMENT_NODE&&c[j.nodeName()]);)j=j.parent();j&&m[0].nodeType==b.NodeType.ELEMENT_NODE&&m.nodeName()in c&&(m=new e(k),m.evaluator=i,k.startContainer=m.next());j&&o[0].nodeType==b.NodeType.ELEMENT_NODE&&o.nodeName()in c&&(m=new e(k),m.evaluator=i,k.endContainer=m.previous());o=g.createBookmarks(!0);if(j){for(m=j.first();m&&"li"!=m.nodeName();)m=m.next();var q=k.startContainer;(!(m[0]==q[0]||m.contains(q))||!a(j,h))&&f(k,j,h)}else{k=k.createIterator();k.enforceRealBlocks=
!0;for(k.enlargeBr=!0;j=k.getNextParagraph();)a(j,h)}g.selectBookmarks(o)}d.execCommand("save");d.notifySelectionChange()}})}}},{requires:["editor","../list-utils/"]});
KISSY.add("editor/plugin/dialog-loader/index",function(d,g,j){var i,f={loading:function(a){i||(i=new g({x:0,width:6==d.UA.ie?d.DOM.docWidth():"100%",y:0,zIndex:j.baseZIndex(j.zIndexManager.LOADING),prefixCls:a+"editor-",elCls:a+"editor-global-loading"}));i.set("height",d.DOM.docHeight());i.show();i.loading()},unloading:function(){i.hide()}};return{useDialog:function(a,c,e,b){a.focus();var g=a.get("prefixCls");a.getControl(c+"/dialog")?setTimeout(function(){a.showDialog(c,b)},0):(f.loading(g),d.use("editor/plugin/"+
c+"/dialog",function(d,k){f.unloading();a.addControl(c+"/dialog",new k(a,e));a.showDialog(c,b)}))}}},{requires:["overlay","editor"]});
KISSY.add("editor/plugin/draft/index",function(d,g,j,i,f){function a(a,b,c){for(a+="";a.length<b;)a=c+a;return a}function c(b){d.isNumber(b)&&(b=new Date(b));return b instanceof Date?[b.getFullYear(),"-",a(b.getMonth()+1,2,"0"),"-",a(b.getDate(),2,"0")," ",a(b.getHours(),2,"0"),":",a(b.getMinutes(),2,"0"),":",a(b.getSeconds(),2,"0")].join(""):b}function e(a,b){this.editor=a;this.config=b;this._init()}function b(a,b){var c=new e(a,b);a.on("destroy",function(){c.destroy()})}function o(a){this.config=
a||{}}var h=d.Node,k=d.Event,s=d.JSON,r=g.Utils.addRes,p=g.Utils.destroyRes;d.augment(e,{_getSaveKey:function(){var a=this.config;return a.draft&&a.draft.saveKey||"ks-editor-draft-save20110503"},_getDrafts:function(){if(!this.drafts){var a=j.getItem(this._getSaveKey()),b=[];a&&(b=j==window.localStorage?s.parse(d.urlDecode(a)):a);this.drafts=b}return this.drafts},_init:function(){var a=this,b=a.editor,c=b.get("prefixCls"),e=b.get("statusBarEl"),i=this.config;i.draft=i.draft||{};a.draftInterval=i.draft.interval=
i.draft.interval||5;a.draftLimit=i.draft.limit=i.draft.limit||5;e=(new h("<div class='"+c+"editor-draft'><span class='"+c+"editor-draft-title'>\u5185\u5bb9\u6b63\u6587\u6bcf"+i.draft.interval+"\u5206\u949f\u81ea\u52a8\u4fdd\u5b58\u4e00\u6b21\u3002</span></div>")).appendTo(e);a.timeTip=(new h("<span class='"+c+"editor-draft-time'/>")).appendTo(e);var o=(new h(d.substitute("<a href='#' onclick='return false;' class='{prefixCls}editor-button {prefixCls}editor-draft-save-btn ks-inline-block' style='vertical-align:middle;padding:1px 9px;'><span class='{prefixCls}editor-draft-save'></span><span>\u7acb\u5373\u4fdd\u5b58</span></a>",
{prefixCls:c}))).unselectable(void 0).appendTo(e),j=(new f({render:e,collapseOnClick:!0,width:"100px",prefixCls:c+"editor-",menu:{xclass:"popupmenu",width:"225px",align:{points:["tr","br"]}},matchElWidth:!1,content:"\u6062\u590d\u7f16\u8f91\u5386\u53f2"})).render();a.versions=j;j.on("beforeCollapsedChange",function(b){b.newValue||(j.detach("beforeCollapsedChange",arguments.callee),a.sync())});o.on("click",function(b){a.save(!1);b.halt()});r.call(a,o);b.get("textarea")[0].form&&function(){function c(){a.save(!0)}var e=b.get("textarea")[0].form;
k.on(e,"submit",c);r.call(a,function(){k.remove(e,"submit",c)})}();var s=setInterval(function(){a.save(!0)},6E4*a.draftInterval);r.call(a,function(){clearInterval(s)});j.on("click",a.recover,a);r.call(a,j);a.holder=e;if(i.draft.helpHtml){var p=(new h('<a tabindex="0" hidefocus="hidefocus" class="'+c+'editor-draft-help" title="\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9" href="javascript:void(\'\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9 \')">\u70b9\u51fb\u67e5\u770b\u5e2e\u52a9</a>')).unselectable(void 0).appendTo(e);p.on("click",function(){p[0].focus();a.helpPopup&&a.helpPopup.get("visible")?a.helpPopup.hide():
a._prepareHelp()});p.on("blur",function(){a.helpPopup&&a.helpPopup.hide()});a.helpBtn=p;r.call(a,p);g.Utils.lazyRun(a,"_prepareHelp","_realHelp")}r.call(a,e)},_prepareHelp:function(){var a=this.editor.get("prefixCls"),b=new h(this.config.draft.helpHtml||""),c=new h("<div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;border-top-color:#CED5E0;'><div style='height:0;position:absolute;font-size:0;width:0;border:8px #000 solid;border-color:#000 transparent transparent transparent;border-style:solid dashed dashed dashed;left:-8px;top:-10px;border-top-color:white;'></div></div>");
b.append(c);b.css({border:"1px solid #ACB4BE","text-align":"left"});this.helpPopup=(new i({content:b,prefixCls:a+"editor-",width:b.width()+"px",zIndex:g.baseZIndex(g.zIndexManager.OVERLAY),mask:!1})).render();this.helpPopup.get("el").css("border","none");this.helpPopup.arrow=c},_realHelp:function(){var a=this.helpPopup,b=this.helpBtn,c=a.arrow;a.show();b=b.offset();a.get("el").offset({left:b.left-a.get("el").width()+17,top:b.top-a.get("el").height()-7});c.offset({left:b.left-2,top:b.top-8})},disable:function(){this.holder.css("visibility",
"hidden")},enable:function(){this.holder.css("visibility","")},sync:function(){var a;a=this.draftLimit;var b=this.timeTip,e=this.versions,d=this._getDrafts(),h;d.length>a&&d.splice(0,d.length-a);e.removeItems(!0);for(a=0;a<d.length;a++)h=d[a],h=(h.auto?"\u81ea\u52a8":"\u624b\u52a8")+"\u4fdd\u5b58\u4e8e : "+c(h.date),e.addItem({xclass:"menuitem",content:h,value:a});b.html(h);j.setItem(this._getSaveKey(),j==window.localStorage?encodeURIComponent(s.stringify(d)):d)},save:function(a){var b=this._getDrafts(),c=this.editor.get("formatData");
c&&(b[b.length-1]&&c==b[b.length-1].content&&(b.length-=1),this.drafts=b.concat({content:c,date:(new Date).getTime(),auto:a}),this.sync())},recover:function(a){var b=this.editor,e=this._getDrafts(),d=a.target.get("value");confirm("\u786e\u8ba4\u6062\u590d "+c(e[d].date)+" \u7684\u7f16\u8f91\u5386\u53f2\uff1f")&&(b.execCommand("save"),b.set("data",e[d].content),b.execCommand("save"));a.halt()},destroy:function(){p.call(this)}});d.augment(o,{renderUI:function(a){var c=this.config;j.ready?j.ready(function(){b(a,c)}):b(a,c)}});return o},{requires:["editor",
"../local-storage/","overlay","../menubutton/"]});
KISSY.add("editor/plugin/drag-upload/index",function(d,g){function j(a){this.config=a||{}}var i=d.Node,f=d.Event,a=g.Utils,c=d.DOM;d.augment(j,{renderUI:function(e){function b(a){a=a.originalEvent.target;"img"==c.nodeName(a)&&a.src.match(/^file:\/\//)&&(q[a.src]=a)}function o(a,b){var c=new window.FileReader;c.onload=function(e){var d=a.name,e=e.target.result,h=new XMLHttpRequest;h.open("POST",p,!0);h.onreadystatechange=function(){if(4==h.readyState){if(200==h.status||304==h.status){if(""!=h.responseText){var a=
window.JSON.parse(h.responseText);b[0].src=a.imgUrl}}else alert("\u670d\u52a1\u5668\u7aef\u51fa\u9519\uff01"),b.remove();h.onreadystatechange=null}};d="\r\n------kissy-editor-yiminghe\r\n"+('Content-Disposition: form-data; name="'+k+'"; filename="'+encodeURIComponent(d)+'"\r\n');d+="Content-Type: "+(a.type||"application/octet-stream")+"\r\n\r\n";d+=e+"\r\n";r=g.Utils.normParams(r);for(var f in r)d+="------kissy-editor-yiminghe\r\n",d+='Content-Disposition: form-data; name="'+f+'"\r\n\r\n',d+=r[f]+"\r\n";d+="------kissy-editor-yiminghe--";
h.setRequestHeader("Content-Type","multipart/form-data, boundary=----kissy-editor-yiminghe");h.sendAsBinary("Content-Type: multipart/form-data; boundary=----kissy-editor-yiminghe\r\nContent-Length: "+d.length+"\r\n"+d+"\r\n");c.onload=null};c.readAsBinaryString(a)}var h=this.config,k=h.fileInput||"Filedata",j=h.sizeLimit||Number.MAX_VALUE,r=h.serverParams||{},p=h.serverUrl||"",m=RegExp((h.suffix||"png,jpg,jpeg,gif").split(/,/).join("|")+"$","i"),q={},t=!1;e.docReady(function(){var h=e.get("document")[0];
f.on(h,"dragenter",function(){t||(f.on(h,"DOMNodeInserted",b),t=!0)});f.on(h,"drop",function(e){f.remove(h,"DOMNodeInserted",b);t=!1;e.halt();var e=e.originalEvent,k,g;d.isEmptyObject(q)?(g=h.elementFromPoint(e.clientX,e.clientY),k=g.lastChild):(d.each(q,function(a){"img"==c.nodeName(a)&&(k=a.nextSibling,g=a.parentNode,c.remove(a))}),q={});e=e.dataTransfer;e.dropEffect="copy";if(e=e.files)for(var p=0;p<e.length;p++){var r=e[p],u=r.size;if(r.name.match(m)&&!(u/1E3>j)){var u=new i("<img src='"+a.debugUrl("theme/tao-loading.gif")+
"'/>"),y=u[0];g.insertBefore(y,k);var C=c.nodeName(y.parentNode);("head"==C||"html"==C)&&c.insertBefore(y,h.body.firstChild);o(r,u)}}})});window.XMLHttpRequest&&!XMLHttpRequest.prototype.sendAsBinary&&(XMLHttpRequest.prototype.sendAsBinary=function(a,b){for(var c=new (window.BlobBuilder||window.WebKitBlobBuilder),e=a.length,d=new window.Uint8Array(e),h=0;h<e;h++)d[h]=a.charCodeAt(h);c.append(d.buffer);this.send(c.getBlob(b))})}});return j},{requires:["editor"]});
KISSY.add("editor/plugin/element-path/index",function(d,g){function j(a){this.cfg=a;this._cache=[];this._init()}function i(){}var f=d.Node;d.augment(j,{_init:function(){var a=this.cfg.editor;this.holder=new f("<span>");this.holder.appendTo(a.get("statusBarEl"),void 0);a.on("selectionChange",this._selectionChange,this);g.Utils.sourceDisable(a,this)},disable:function(){this.holder.css("visibility","hidden")},enable:function(){this.holder.css("visibility","")},_selectionChange:function(a){var c=this.cfg.editor,
e=c.get("prefixCls"),b=this.holder,a=a.path.elements,d,h;d=this._cache;for(h=0;h<d.length;h++)d[h].remove();this._cache=[];for(h=0;h<a.length;h++){d=a[h];var k=d.attr("_ke_real_element_type")||d.nodeName(),g=new f("<a href='javascript(\""+k+"\")' class='"+e+"editor-element-path'>"+k+"</a>");this._cache.push(g);(function(a){g.on("click",function(b){b.halt();c.focus();setTimeout(function(){c.getSelection().selectElement(a)},50)})})(d);b.prepend(g)}},destroy:function(){this.holder.remove()}});d.augment(i,
{renderUI:function(a){var c=new j({editor:a});a.on("destroy",function(){c.destroy()})}});return i},{requires:["editor"]});
KISSY.add("editor/plugin/fake-objects/index",function(d,g){var j=d.Node,i=d.DOM,f=g.Utils.debugUrl("theme/spacer.gif"),a=d.require("htmlparser");d.augment(g,{createFakeElement:function(a,b,c,h,k,g){var i=a.attr("style")||"";a.attr("width")&&(i="width:"+a.attr("width")+"px;"+i);a.attr("height")&&(i="height:"+a.attr("height")+"px;"+i);var p=d.trim(a.attr("class")),a={"class":b+" "+p,src:f,_ke_realelement:encodeURIComponent(k||a._4e_outerHtml(void 0)),_ke_real_node_type:a[0].nodeType,style:i};g&&(delete g.width,
delete g.height,d.mix(a,g,!1));c&&(a._ke_real_element_type=c);h&&(a._ke_resizable=h);return new j("<img/>",a,this.get("document")[0])},restoreRealElement:function(a){if(a.attr("_ke_real_node_type")!=i.NodeType.ELEMENT_NODE)return null;var a=d.urlDecode(a.attr("_ke_realelement")),b=new j("<div>",null,this.get("document")[0]);b.html(a);return b.first().remove()}});var c={tags:{$:function(c){var b=c.getAttribute("_ke_realelement"),f;b&&(f=(new a.Parser(d.urlDecode(b))).parse());if(b=f&&f.childNodes[0]){if(f=
c.getAttribute("style")){var h=/(?:^|\s)width\s*:\s*(\d+)/i.exec(f),c=h&&h[1];f=(h=/(?:^|\s)height\s*:\s*(\d+)/i.exec(f))&&h[1];c&&b.setAttribute("width",c);f&&b.setAttribute("height",f)}return b}}}};return{init:function(e){var b=e.htmlDataProcessor,g=b&&b.htmlFilter;b.createFakeParserElement||(g&&g.addRules(c),d.mix(b,{restoreRealElement:function(a){if(a.attr("_ke_real_node_type")!=i.NodeType.ELEMENT_NODE)return null;var a=d.urlDecode(a.attr("_ke_realelement")),b=new j("<div>",null,e.get("document")[0]);
b.html(a);return b.first().remove()},createFakeParserElement:function(b,c,e,g,i){var j=a.serialize(b),o=b.getAttribute("style")||"";b.getAttribute("width")&&(o="width:"+b.getAttribute("width")+"px;"+o);b.getAttribute("height")&&(o="height:"+b.getAttribute("height")+"px;"+o);var t=d.trim(b.getAttribute("class")),b={"class":c+" "+t,src:f,_ke_realelement:encodeURIComponent(j),_ke_real_node_type:b.nodeType+"",style:o,align:b.getAttribute("align")||""};i&&(delete i.width,delete i.height,d.mix(b,i,!1));
e&&(b._ke_real_element_type=e);g&&(b._ke_resizable="_ke_resizable");return new a.Tag("img",b)}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/flash-bridge/index",function(d,g,j){function i(a){this._init(a)}function f(b){var c="string"==typeof b?b.match(/(\d)+/g):b;d.isArray(c)&&(b=parseFloat(c[0]+"."+a(c[1],3)+a(c[2],5)));return b||0}function a(a,b){for(var c=(a+"").length;c++<b;)a="0"+a;return a}var c={};d.augment(i,d.EventTarget,{_init:function(a){var b=d.guid("flashbridge-");a.flashVars=a.flashVars||{};a.attrs=a.attrs||{};a.params=a.params||{};var e=a.flashVars,h=a.params;d.mix(a.attrs,{id:b,width:"100%",height:"100%"},
!1);d.mix(h,{allowScriptAccess:"always",allowNetworking:"all",scale:"noScale"},!1);d.mix(e,{shareData:!1,useCompression:!1},!1);h={YUISwfId:b,YUIBridgeCallback:"KISSY.Editor.FlashBridge.EventHandler"};a.ajbridge&&(h={swfID:b,jsEntry:"KISSY.Editor.FlashBridge.EventHandler"});d.mix(e,h);c[b]=this;this.id=b;this.swf=j.createSWFRuntime(a.movie,a);this._expose(a.methods)},_expose:function(a){for(var b=this,c=0;c<a.length;c++)(function(a){b[a]=function(){return b._callSWF(a,d.makeArray(arguments))}})(a[c])},
_callSWF:function(a,b){b=b||[];try{if(this.swf[a])return this.swf[a].apply(this.swf,b)}catch(c){var e="";0!==b.length&&(e="'"+b.join("', '")+"'");return(new Function("self","return self.swf."+a+"("+e+");"))(this)}},_eventHandler:function(a){var b=a.type;"log"!==b&&b&&this.fire(b,a)},ready:function(a){if(this._ready)a.call(this);else this.on("contentReady",a)},destroy:function(){delete c[this.id]}});i.EventHandler=function(a,b){var e=c[a];e&&setTimeout(function(){e._eventHandler.call(e,b)},100)};g.FlashBridge=
i;var e=d.UA,b,o,h=!0;e.fpv=function(a){if(a||h){h=!1;var c;if(navigator.plugins&&navigator.mimeTypes.length)c=(navigator.plugins["Shockwave Flash"]||{}).description;else if(window.ActiveXObject)try{c=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(e){}b=!c?void 0:c.match(/(\d)+/g);o=f(b)}return b};e.fpvGEQ=function(a,b){h&&e.fpv(b);return!!o&&o>=f(a)};return i},{requires:["editor","../flash-common/utils"]});
KISSY.add("editor/plugin/flash-common/baseClass",function(d,g,j,i,f,a){function c(){c.superclass.constructor.apply(this,arguments);this._init()}var e=d.Node;c.ATTRS={cls:{},type:{},label:{value:"\u5728\u65b0\u7a97\u53e3\u67e5\u770b"},bubbleId:{},contextMenuId:{},contextMenuHandlers:{}};d.extend(c,d.Base,{_init:function(){var a=this,c=a.get("cls"),e=a.get("editor"),f=e.get("prefixCls"),i=[],j=a.get("bubbleId"),p=a.get("contextMenuId"),m=a.get("contextMenuHandlers");d.each(m,function(a,b){i.push({content:b})});e.addContextMenu(p,
"."+c,{width:"120px",children:i,listeners:{click:function(a){a=a.target.get("content");m[a]&&m[a].call(this)}}});e.addBubble(j,function(a){return a.hasClass(c,void 0)&&a},{listeners:{afterRenderUI:function(){var c=this,i=c.get("contentEl");i.html(d.substitute(' <a class="{prefixCls}editor-bubble-url" target="_blank" href="#">{label}</a>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-change">\u7f16\u8f91</span>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-remove">\u5220\u9664</span>',
{label:a.get("label"),prefixCls:f}));var j=i.one("."+f+"editor-bubble-url"),o=i.one("."+f+"editor-bubble-change"),m=i.one("."+f+"editor-bubble-remove");g.Utils.preventFocus(i);o.on("click",function(e){a.show(c.get("editorSelectedEl"));e.halt()});m.on("click",function(a){if(d.UA.webkit){var b=e.getSelection().getRanges();if(b=b&&b[0])b.collapse(!0),b.select()}c.get("editorSelectedEl").remove();c.hide();e.notifySelectionChange();a.halt()});c.on("show",function(){var e=c.get("editorSelectedEl");e&&a._updateTip(j,
e)})}}});e.docReady(function(){e.get("document").on("dblclick",a._dbClick,a)})},_getFlashUrl:function(b){return a.getUrl(b)},_updateTip:function(a,c){var e=this.get("editor").restoreRealElement(c);e&&(e=this._getFlashUrl(e),a.attr("href",e))},_dbClick:function(a){var c=new e(a.target);"img"===c.nodeName()&&c.hasClass(this.get("cls"),void 0)&&(this.show(c),a.halt())},show:function(a){var c=this.get("editor");f.useDialog(c,this.get("type"),this.get("pluginConfig"),a)}});return c},{requires:["editor",
"../contextmenu/","../bubble/","../dialog-loader/","./utils"]});
KISSY.add("editor/plugin/flash-common/utils",function(d){var g=d.DOM,j=d.Node,i=d.UA,f={insertFlash:function(a,c,e,b,d){c=f.createSWF(c,{attrs:e},a.get("document")[0]);e=a.createFakeElement(c.el,b||"ke_flash",d||"flash",!0,c.html,e);a.insertElement(e);return e},isFlashEmbed:function(a){return"application/x-shockwave-flash"==a.getAttribute("type")||/\.swf(?:$|\?)/i.test(a.getAttribute("src")||"")},getUrl:function(a){var c="";if("object"==a.nodeName())for(var a=a[0].childNodes,e=0;e<a.length;e++)1==
a[e].nodeType&&("movie"==(g.attr(a[e],"name")||"").toLowerCase()?c=g.attr(a[e],"value"):"embed"==g.nodeName(a[e])?c=g.attr(a[e],"src"):"object"==g.nodeName(a[e])&&(c=g.attr(a[e],"data")));else"embed"==a.nodeName()&&(c=a.attr("src"));return c},createSWF:function(a,c,e){var b=c.attrs||{},f=c.flashVars,h="",g="",c=c.params||{},i="",e=e||document;d.mix(b,{wmode:"transparent"});for(var r in b)h+=r+"='"+b[r]+"' ";d.mix(c,{quality:"high",movie:a,wmode:"transparent"});for(var p in c)g+="<param name='"+p+
"' value='"+c[p]+"'/>";if(f){for(var m in f)i+="&"+m+"="+encodeURIComponent(f[m]);i=i.substring(1)}a="<object "+h+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+g+(i?'<param name="flashVars" value="'+i+'"/>':"")+"<embed "+h+" "+(i?'FlashVars="'+i+'"':"")+' pluginspage="http://www.macromedia.com/go/getflashplayer"  quality="high"  src="'+a+'"  type="application/x-shockwave-flash"/></object>';return{el:new j(a,null,e),html:a}},createSWFRuntime2:function(a,c,e){var e=e||document,b=(new j("<div style='width:0;height:0;overflow:hidden;'>",
null,e)).appendTo(e.body),b=f.createSWF.apply(this,arguments).el.appendTo(b);i.ie||(b=b.one("object"));return b[0]},createSWFRuntime:function(a,c,e){var b=c.attrs||{},f=c.flashVars||{},h=c.params||{},k="",s="",r="",e=e||document;b.id=b.id||d.guid("ks-editor-runtimeflash-");for(var p in b)k+=p+"='"+b[p]+"' ";for(var m in h)s+="<param name='"+m+"' value='"+h[m]+"'/>";for(var q in f)r+="&"+q+"="+encodeURIComponent(f[q]);var r=r.substring(1),a=i.ie?"<object "+k+' classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" >'+
s+'<param name="movie" value="'+a+'" />'+(r?'<param name="flashVars" value="'+r+'" />':"")+"</object>":"<object type='application/x-shockwave-flash' data='"+a+"' "+k+">"+s+(r?'<param name="flashVars" value="'+r+'"/>':"")+"</object>",t=c.holder;t||(t=(new j("<div style='"+(c.style?c.style:"width:1px;height:1px;position:absolute;NaN")+"'>",null,e)).appendTo(e.body),setTimeout(function(){t.offset({left:g.scrollLeft(),top:g.scrollTop()})},100));t.html(a);return e.getElementById(b.id)}};return f});
KISSY.add("editor/plugin/flash/index",function(d,g,j,i,f){function a(a){this.config=a||{}}d.augment(a,{renderUI:function(a){f.init(a);var e=a.htmlDataProcessor;e.dataFilter.addRules({tags:{object:function(a){var b;if(!a.getAttribute("classid")){var c=a.childNodes;for(b=0;b<c.length;b++)if("embed"==c[b].nodeName)if(i.isFlashEmbed(c[b][b]))break;else return e.createFakeParserElement(a,"ke_flash","flash",!0);return null}return e.createFakeParserElement(a,"ke_flash","flash",!0)},embed:function(a){return i.isFlashEmbed(a)?
e.createFakeParserElement(a,"ke_flash","flash",!0):null}}},5);var b=new j({editor:a,cls:"ke_flash",type:"flash",pluginConfig:this.config,bubbleId:"flash",contextMenuId:"flash",contextMenuHandlers:{"Flash\u5c5e\u6027":function(){var a=this.get("editorSelectedEl");a&&b.show(a)}}});this.flashControl=b;a.addButton("flash",{tooltip:"\u63d2\u5165Flash",listeners:{click:function(){b.show()}},mode:g.WYSIWYG_MODE})}});return a},{requires:["editor","../flash-common/baseClass","../flash-common/utils","../fake-objects/"]});
KISSY.add("editor/plugin/focus-fix/index",function(d,g){function j(){var c=this._focusEditor=a.currentInstance();if(f.ie&&c){window.focus();document.body.focus();var e=c.get("document")[0].selection,b;try{b=e.createRange()}catch(d){b=0}b&&b.item&&b.item(0).ownerDocument==c.get("document")[0]&&(c=document.body.createTextRange(),c.moveToElementText(this.get("el").first()[0]),c.collapse(!0),c.select())}}function i(){var a=this._focusEditor;a&&a.focus()}var f=d.UA,a=g.focusManager;return{init:function(a){a.on("beforeVisibleChange",
function(e){e.newVal&&j.call(a)});a.on("hide",function(){i.call(a)})}}},{requires:["editor"]});KISSY.add("editor/plugin/font-family/cmd",function(d,g,j){var i={element:"span",styles:{"font-family":"#(value)"},overrides:[{element:"font",attributes:{face:null}}]};return{init:function(d){j.addSelectCmd(d,"fontFamily",i)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/font-family/index",function(d,g,j,i){function f(a){this.config=a||{}}d.augment(f,{renderUI:function(a){i.init(a);var c=this.config,e={};d.mix(e,{children:[{content:"\u5b8b\u4f53",value:"SimSun"},{content:"\u9ed1\u4f53",value:"SimHei"},{content:"\u96b6\u4e66",value:"LiSu"},{content:"\u6977\u4f53",value:"KaiTi_GB2312"},{content:"\u5fae\u8f6f\u96c5\u9ed1",value:"Microsoft YaHei"},{content:"Georgia",value:"Georgia"},{content:"Times New Roman",value:"Times New Roman"},{content:"Impact",value:"Impact"},{content:"Courier New",value:"Courier New"},
{content:"Arial",value:"Arial"},{content:"Verdana",value:"Verdana"},{content:"Tahoma",value:"Tahoma"}],width:"130px"});d.each(e.children,function(a){var c=a.elAttrs||{},e=a.value;c.style=c.style||"";c.style+=";font-family:"+e;a.elAttrs=c});c.menu=d.mix(e,c.menu);a.addSelect("fontFamily",d.mix({cmdType:"fontFamily",defaultCaption:"\u5b57\u4f53",width:130,mode:g.WYSIWYG_MODE},c),j.Select)}});return f},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/font-size/cmd",function(d,g,j){var i={element:"span",styles:{"font-size":"#(value)"},overrides:[{element:"font",attributes:{size:null}}]};return{init:function(d){j.addSelectCmd(d,"fontSize",i)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/font-size/index",function(d,g,j,i){function f(a){this.config=a||{}}d.augment(f,{renderUI:function(a){i.init(a);var c=this.config;c.menu=d.mix({children:function(a){var b=[];d.each(a,function(a){b.push({content:a,value:a})});return b}("8px,10px,12px,14px,18px,24px,36px,48px,60px,72px,84px,96px".split(","))},c.menu);a.addSelect("fontSize",d.mix({cmdType:"fontSize",defaultCaption:"\u5927\u5c0f",width:"70px",mode:g.WYSIWYG_MODE},c),j.Select)}});return f},{requires:["editor","../font/ui",
"./cmd"]});
KISSY.add("editor/plugin/font/cmd",function(d,g){function j(d,a){var c=d.nodeName();if(a.element!=c)return!1;var e=a.styles,b,g;for(g in e)if(b=d.style(g))return b;e=a.overrides;for(g=0;g<e.length;g++)if(b=e[g],b.element==c){var h=b.attributes,i;for(i in h)if(b=d.attr(i))return b}return!1}var i=g.Utils.getQueryCmd;return{addButtonCmd:function(d,a,c){var e=i(a);d.hasCommand(a)||(d.addCommand(a,{exec:function(b){var e=b.get("document")[0];b.execCommand("save");b.queryCommandValue(a)?c.remove(e):c.apply(e);
b.execCommand("save");b.notifySelectionChange()}}),d.addCommand(e,{exec:function(a){if((a=a.getSelection())&&!a.isInvalid)return a=a.getStartElement(),a=new g.ElementPath(a),c.checkActive(a)}}))},addSelectCmd:function(d,a,c){var e=i(a);d.hasCommand(a)||(d.addCommand(a,{exec:function(b,e){b.focus();var d=b.queryCommandValue(a)||"",f=new g.Style(c,{value:e}),i=b.get("document")[0];b.execCommand("save");e.toLowerCase()==d.toLowerCase()?f.remove(i):f.apply(i);b.execCommand("save")}}),d.addCommand(e,{exec:function(a){if((a=
a.getSelection())&&!a.isInvalid){var a=a.getStartElement(),a=new g.ElementPath(a),e=a.elements,d,f,i;for(f=0;f<e.length;f++)if(d=e[f],!(d[0]==a.block[0]||d[0]==a.blockLimit[0]))if(i=j(d,c),!1!==i)break;return i}}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/font/ui",function(d,g,j,i){d=i.Select.extend({initializer:function(){var d=this,a=d.get("editor");d.on("click",function(c){var c=c.target.get("value"),e=d.get("cmdType");a.execCommand(e,c)});a.on("selectionChange",function(){if(a.get("mode")!=g.SOURCE_MODE){var c=d.get("cmdType"),e=d.get("menu");if(e=e.get&&e.get("children")){c=a.queryCommandValue(c);if(!1!==c)for(var c=(c+"").toLowerCase(),b=0;b<e.length;b++){var i=e[b].get("value");if(c==i.toLowerCase()){d.set("value",i);
return}}d.set("value",null)}}})}});return{Button:j.extend({initializer:function(){var d=this,a=d.get("editor"),c=d.get("cmdType");d.on("click",function(){d.get("checked")?a.execCommand(c):a.execCommand(c,!1);a.focus()});a.on("selectionChange",function(){if(a.get("mode")!=g.SOURCE_MODE){var c=d.get("cmdType");a.queryCommandValue(c)?d.set("checked",!0):d.set("checked",!1)}})}},{ATTRS:{checkable:{value:!0},mode:{value:g.WYSIWYG_MODE}}}),Select:d}},{requires:["editor","../button/","../menubutton/"]});
KISSY.add("editor/plugin/fore-color/cmd",function(d,g){var j={element:"span",styles:{color:"#(color)"},overrides:[{element:"font",attributes:{color:null}}],childRule:function(d){return!("a"==d.nodeName()||d.all("a").length)}};return{init:function(d){d.hasCommand("foreColor")||d.addCommand("foreColor",{exec:function(d,a){d.execCommand("save");g.applyColor(d,a,j);d.execCommand("save")}})}}},{requires:["../color/cmd"]});
KISSY.add("editor/plugin/fore-color/index",function(d,g,j,i){function f(a){this.config=a||{}}d.augment(f,{renderUI:function(a){i.init(a);j.init(a,{cmdType:"foreColor",defaultColor:"rgb(204, 0, 0)",tooltip:"\u6587\u672c\u989c\u8272"})}});return f},{requires:["editor","../color/btn","./cmd"]});
KISSY.add("editor/plugin/heading/cmd",function(d,g){return{init:function(d){if(!d.hasCommand("heading")){d.addCommand("heading",{exec:function(d,a){d.execCommand("save");if("p"!=a)var c=d.queryCommandValue("heading");a==c&&(a="p");(new g.Style({element:a})).apply(d.get("document")[0]);d.execCommand("save")}});var i=g.Utils.getQueryCmd("heading");d.addCommand(i,{exec:function(d){if((d=d.getSelection())&&!d.isInvalid)if(d=d.getStartElement(),d=new g.ElementPath(d),d=(d=d.block||d.blockLimit)&&d.nodeName()||
"",d.match(/^h\d$/)||"p"==d)return d}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/heading/index",function(d,g,j){function i(){}d.augment(i,{renderUI:function(d){j.init(d);var a=[],c={"\u666e\u901a\u6587\u672c":"p","\u6807\u98981":"h1","\u6807\u98982":"h2","\u6807\u98983":"h3","\u6807\u98984":"h4","\u6807\u98985":"h5","\u6807\u98986":"h6"},e={p:"1em",h1:"2em",h2:"1.5em",h3:"1.17em",h4:"1em",h5:"0.83em",h6:"0.67em"},b;for(b in c)a.push({content:b,value:c[b],elAttrs:{style:"font-size:"+e[c[b]]}});d.addSelect("heading",{defaultCaption:"\u6807\u9898",width:"120px",menu:{children:a},mode:g.WYSIWYG_MODE,listeners:{click:function(a){a=a.target.get("value");
d.execCommand("heading",a)},afterSyncUI:function(){var a=this;d.on("selectionChange",function(){if(d.get("mode")!=g.SOURCE_MODE){var b=d.queryCommandValue("heading"),c;for(c in e)if(c==b){a.set("value",c);return}a.set("value",null)}})}}})}});return i},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/image/index",function(d,g,j,i,f,a){function c(a){this.config=a||{}}var e=d.UA,b=d.Node,o=d.all,h=d.Event,k=function(a){a=o(a);if("img"===a.nodeName()&&!/(^|\s+)ke_/.test(a[0].className))return a};d.augment(c,{renderUI:function(c){function f(b){a.useDialog(c,"image",i.config,b)}var i=this,j=c.get("prefixCls");c.addButton("image",{tooltip:"\u63d2\u5165\u56fe\u7247",listeners:{click:function(){f(null)}},mode:g.WYSIWYG_MODE});var q=[{content:"\u56fe\u7247\u5c5e\u6027",fn:function(){var a=k(this.get("editorSelectedEl"));
a&&(this.hide(),f(o(a)))}},{content:"\u63d2\u5165\u65b0\u884c",fn:function(){this.hide();var a=c.get("document")[0],d=new b(a.createElement("p"));e.ie||d._4e_appendBogus(void 0);a=new g.Range(a);a.setStartAfter(this.get("editorSelectedEl"));a.select();c.insertElement(d);a.moveToElementEditablePosition(d,1);a.select()}}],t=[];d.each(q,function(a){t.push({content:a.content})});c.addContextMenu("image",k,{width:120,children:t,listeners:{click:function(a){var b=this,c=a.target.get("content");d.each(q,function(a){a.content==
c&&a.fn.call(b)})}}});c.docReady(function(){h.on(c.get("document")[0],"dblclick",function(a){a.halt();a=o(a.target);k(a)&&f(a)})});c.addBubble("image",k,{listeners:{afterRenderUI:function(){var a=this,b=a.get("contentEl");b.html(d.substitute('<a class="{prefixCls}editor-bubble-url" target="_blank" href="#">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  |  <a class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-change" href="#">\u7f16\u8f91</a>  |  <a class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-remove" href="#">\u5220\u9664</a>',
{prefixCls:j}));var h=b.one("."+j+"editor-bubble-url"),i=b.one("."+j+"editor-bubble-change"),k=b.one("."+j+"editor-bubble-remove");g.Utils.preventFocus(b);i.on("click",function(b){f(a.get("editorSelectedEl"));b.halt()});k.on("click",function(b){if(e.webkit){var d=c.getSelection().getRanges();d&&d[0]&&(d[0].collapse(),d[0].select())}a.get("editorSelectedEl").remove();a.hide();c.notifySelectionChange();b.halt()});a.on("show",function(){var b=a.get("editorSelectedEl");b&&(b=b.attr("_ke_saved_src")||
b.attr("src"),h.attr("href",b))})}}})}});return c},{requires:["editor","../button/","../bubble/","../contextmenu/","../dialog-loader/"]});KISSY.add("editor/plugin/indent/cmd",function(d,g,j){var i=j.addCommand;return{init:function(d){i(d,"indent")}}},{requires:["editor","../dent-utils/cmd"]});
KISSY.add("editor/plugin/indent/index",function(d,g,j){function i(){}d.augment(i,{renderUI:function(d){j.init(d);d.addButton("indent",{tooltip:"\u589e\u52a0\u7f29\u8fdb\u91cf ",listeners:{click:function(){d.execCommand("indent");d.focus()}},mode:g.WYSIWYG_MODE})}});return i},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/italic/cmd",function(d,g,j){var i=new g.Style({element:"em",overrides:[{element:"i"},{element:"span",attributes:{style:"font-style: italic;"}}]});return{init:function(d){j.addButtonCmd(d,"italic",i)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/italic/index",function(d,g,j,i){function f(){}d.augment(f,{renderUI:function(a){i.init(a);a.addButton("italic",{cmdType:"italic",tooltip:"\u659c\u4f53 "},j.Button);a.docReady(function(){a.get("document").on("keydown",function(c){c.ctrlKey&&c.keyCode==d.Node.KeyCodes.I&&(a.execCommand("italic"),c.preventDefault())})})}});return f},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/justify-center/cmd",function(d,g){return{init:function(d){g.addCommand(d,"justifyCenter","center")}}},{requires:["../justify-utils/cmd"]});
KISSY.add("editor/plugin/justify-center/index",function(d,g,j){function i(){var a=this.get("editor");a.execCommand("justifyCenter");a.focus()}function f(){}d.augment(f,{renderUI:function(a){j.init(a);a.addButton("justifyCenter",{tooltip:"\u5c45\u4e2d\u5bf9\u9f50",checkable:!0,listeners:{click:i,afterSyncUI:function(){var c=this;a.on("selectionChange",function(){a.get("mode")!=g.SOURCE_MODE&&(a.queryCommandValue("justifyCenter")?c.set("checked",!0):c.set("checked",!1))})}},mode:g.WYSIWYG_MODE});a.docReady(function(){a.get("document").on("keydown",
function(c){c.ctrlKey&&c.keyCode==d.Node.KeyCodes.E&&(a.execCommand("justifyCenter"),c.preventDefault())})})}});return f},{requires:["editor","./cmd"]});KISSY.add("editor/plugin/justify-left/cmd",function(d,g){return{init:function(d){g.addCommand(d,"justifyLeft","left")}}},{requires:["../justify-utils/cmd"]});
KISSY.add("editor/plugin/justify-left/index",function(d,g,j){function i(){var a=this.get("editor");a.execCommand("justifyLeft");a.focus()}function f(){}d.augment(f,{renderUI:function(a){j.init(a);a.addButton("justifyLeft",{tooltip:"\u5de6\u5bf9\u9f50",checkable:!0,listeners:{click:i,afterSyncUI:function(){var c=this;a.on("selectionChange",function(){a.get("mode")!=g.SOURCE_MODE&&(a.queryCommandValue("justifyLeft")?c.set("checked",!0):c.set("checked",!1))})}},mode:g.WYSIWYG_MODE});a.docReady(function(){a.get("document").on("keydown",
function(c){c.ctrlKey&&c.keyCode==d.Node.KeyCodes.L&&(a.execCommand("justifyLeft"),c.preventDefault())})})}});return f},{requires:["editor","./cmd"]});KISSY.add("editor/plugin/justify-right/cmd",function(d,g){return{init:function(d){g.addCommand(d,"justifyRight","right")}}},{requires:["../justify-utils/cmd"]});
KISSY.add("editor/plugin/justify-right/index",function(d,g,j){function i(){var a=this.get("editor");a.execCommand("justifyRight");a.focus()}function f(){}d.augment(f,{renderUI:function(a){j.init(a);a.addButton("justifyRight",{tooltip:"\u53f3\u5bf9\u9f50",checkable:!0,listeners:{click:i,afterSyncUI:function(){var c=this;a.on("selectionChange",function(){a.get("mode")!=g.SOURCE_MODE&&(a.queryCommandValue("justifyRight")?c.set("checked",!0):c.set("checked",!1))})}},mode:g.WYSIWYG_MODE});a.docReady(function(){a.get("document").on("keydown",
function(c){c.ctrlKey&&c.keyCode==d.Node.KeyCodes.R&&(a.execCommand("justifyRight"),c.preventDefault())})})}});return f},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/justify-utils/cmd",function(d,g){var j=/(-moz-|-webkit-|start|auto)/gi;return{addCommand:function(d,f,a){d.hasCommand(f)||(d.addCommand(f,{exec:function(c){c.focus();c.execCommand("save");for(var d=c.getSelection(),b=d.createBookmarks(),f=d.getRanges(),h,g,i=f.length-1;0<=i;i--){h=f[i].createIterator();for(h.enlargeBr=!0;g=h.getNextParagraph();)g.removeAttr("align"),(g.css("text-align").replace(j,"")||"left")==a?g.css("text-align",""):g.css("text-align",a)}d.selectBookmarks(b);
c.execCommand("save");c.notifySelectionChange()}}),d.addCommand(g.Utils.getQueryCmd(f),{exec:function(c){if((c=c.getSelection())&&!c.isInvalid)return c=c.getStartElement(),c=new g.ElementPath(c),c=c.block||c.blockLimit,!c||"body"===c.nodeName()?!1:(c.css("text-align").replace(j,"")||"left")==a}}))}}},{requires:["editor"]});
KISSY.add("editor/plugin/link/index",function(d,g,j,i,f){function a(a){a=e(a);return a.closest("a",void 0)}function c(a){this.config=a||{}}var e=d.all;d.augment(c,{renderUI:function(b){var c=b.get("prefixCls");b.addButton("link",{tooltip:"\u63d2\u5165\u94fe\u63a5",listeners:{click:function(){f.useDialog(b,"link",e.config,void 0)}},mode:g.WYSIWYG_MODE});var e=this;b.addBubble("link",a,{listeners:{afterRenderUI:function(){var a=this,j=a.get("contentEl");j.html(d.substitute('<a href=""  target="_blank" class="{prefixCls}editor-bubble-url">\u5728\u65b0\u7a97\u53e3\u67e5\u770b</a>  \u2013   <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-change">\u7f16\u8f91</span>   |    <span class="{prefixCls}editor-bubble-link {prefixCls}editor-bubble-remove">\u53bb\u9664</span>',
{prefixCls:c}));var r=j.one("."+c+"editor-bubble-url"),p=j.one("."+c+"editor-bubble-change"),m=j.one("."+c+"editor-bubble-remove");g.Utils.preventFocus(j);p.on("click",function(c){var d=a.get("editorSelectedEl");f.useDialog(b,"link",e.config,d);c.halt()});m.on("click",function(c){i.removeLink(b,a.get("editorSelectedEl"));c.halt()});a.on("show",function(){var b=a.get("editorSelectedEl");b&&(b=b.attr(i._ke_saved_href)||b.attr("href"),r.html(b),r.attr("href",b))})}}})}});return c},{requires:["editor",
"../bubble/","./utils","../dialog-loader/","../button/"]});
KISSY.add("editor/plugin/link/utils",function(d,g){var j=d.Node,i=g.Style,f={element:"a",attributes:{href:"#(href)",title:"#(title)",_ke_saved_href:"#(_ke_saved_href)",target:"#(target)"}};return{removeLink:function(a,c){a.execCommand("save");var d=a.getSelection(),b=d.getRanges()[0];if(b&&b.collapsed)b=d.createBookmarks(),c._4e_remove(!0),d.selectBookmarks(b);else if(b){for(var d=c[0],b=d.attributes,g={},h=0;h<b.length;h++){var k=b[h];k.specified&&(g[k.name]=k.value)}d.style.cssText&&(g.style=d.style.cssText);
(new i(f,g)).remove(a.get("document")[0])}a.execCommand("save");a.notifySelectionChange()},applyLink:function(a,c,d){c._ke_saved_href=c.href;d?(a.execCommand("save"),d.attr(c)):(d=(d=a.getSelection())&&d.getRanges()[0],!d||d.collapsed?(c=new j("<a>"+c.href+"</a>",c,a.get("document")[0]),a.insertElement(c)):(a.execCommand("save"),(new i(f,c)).apply(a.get("document")[0])));a.execCommand("save");a.notifySelectionChange()},_ke_saved_href:"_ke_saved_href"}},{requires:["editor"]});
KISSY.add("editor/plugin/list-utils/btn",function(d,g){return{init:function(d,i){var f=i.buttonId,a=i.cmdType,c=i.tooltip,e=d.addButton(f,{elCls:f+"Btn",mode:g.WYSIWYG_MODE,tooltip:"\u8bbe\u7f6e"+c});d.on("selectionChange",function(){var c;(c=d.queryCommandValue(a))?(e.set("checked",!0),b.set("value",c)):e.set("checked",!1)});var b=d.addSelect(f+"Arrow",{tooltip:"\u9009\u62e9\u5e76\u8bbe\u7f6e"+c,mode:g.WYSIWYG_MODE,menu:i.menu,matchElWidth:!1,elCls:"toolbar-"+f+"ArrowBtn"});b.on("click",function(b){b=b.target.get("value");e.listValue=
b;d.execCommand(a,b);d.focus()});e.on("click",function(){var c=e.listValue;e.get("checked")&&(c=b.get("value"));d.execCommand(a,c);d.focus()})}}},{requires:["editor","../button/","../menubutton/"]});
KISSY.add("editor/plugin/list-utils/cmd",function(d,g,j,i){function f(a){this.type=a}function a(a,b){var d,e,h,f=b.blockLimit,g=b.elements;if(!f)return!1;if(g)for(h=0;h<g.length&&(d=g[h])&&d[0]!==f[0];h++)if(c[e=d.nodeName()]&&e==a)return d.css("list-style-type");return!1}var c={ol:"insertOrderedList",ul:"insertUnorderedList"},e=g.RANGE,b=g.ElementPath,o=g.Walker,h=d.UA,k=d.Node,s=d.DOM,r=/^h[1-6]$/;f.prototype={changeListType:function(a,b,c,d,e){for(var h=j.listToArray(b.root,c,i,i,i),f=[],a=0;a<
b.contents.length;a++){var g=b.contents[a];if((g=g.closest("li",i))&&g[0]&&!g.data("list_item_processed"))f.push(g),g._4e_setMarker(c,"list_item_processed",!0,i)}g=new k(b.root[0].ownerDocument.createElement(this.type));g.css("list-style-type",e);for(a=0;a<f.length;a++)e=f[a].data("listarray_index"),h[e].parent=g;for(var c=j.arrayToList(h,c,null,"p"),o,e=c.listNode.childNodes.length,a=0;a<e&&(o=new k(c.listNode.childNodes[a]));a++)o.nodeName()==this.type&&d.push(o);b.root.before(c.listNode);b.root.remove()},
createList:function(a,b,c,d){var e=b.contents,a=b.root[0].ownerDocument,f=[];if(1==e.length&&e[0][0]===b.root[0]){var g=new k(a.createElement("div"));e[0][0].nodeType!=s.NodeType.TEXT_NODE&&e[0]._4e_moveChildren(g,i,i);e[0][0].appendChild(g[0]);e[0]=g}b=b.contents[0].parent();for(g=0;g<e.length;g++)b=b._4e_commonAncestor(e[g].parent(),i);for(g=0;g<e.length;g++)for(var j=e[g],o;o=j.parent();){if(o[0]===b[0]){f.push(j);break}j=o}if(!(1>f.length)){e=new k(f[f.length-1][0].nextSibling);g=new k(a.createElement(this.type));
g.css("list-style-type",d);for(c.push(g);f.length;)c=f.shift(),d=new k(a.createElement("li")),r.test(c.nodeName())?d[0].appendChild(c[0]):(c._4e_copyAttributes(d,i,i),c._4e_moveChildren(d,i,i),c.remove()),g[0].appendChild(d[0]),h.ie||d._4e_appendBogus(i);e[0]?g.insertBefore(e,i):b.append(g)}},removeList:function(a,b,c){function d(c){if((z=new k(r[c?"firstChild":"lastChild"]))&&!(z[0].nodeType==s.NodeType.ELEMENT_NODE&&z._4e_isBlockBoundary(i,i))&&(u=b.root[c?"prev":"next"](o.whitespaces(!0),1))&&
!(z[0].nodeType==s.NodeType.ELEMENT_NODE&&u._4e_isBlockBoundary({br:1},i)))z[c?"before":"after"](a.get("document")[0].createElement("br"))}for(var e=j.listToArray(b.root,c,i,i,i),h=[],f=0;f<b.contents.length;f++){var g=b.contents[f];if((g=g.closest("li",i))&&!g.data("list_item_processed"))h.push(g),g._4e_setMarker(c,"list_item_processed",!0,i)}g=null;for(f=0;f<h.length;f++)g=h[f].data("listarray_index"),e[g].indent=-1;for(f=g+1;f<e.length;f++)if(e[f].indent>Math.max(e[f-1].indent,0)){h=e[f-1].indent+
1-e[f].indent;for(g=e[f].indent;e[f]&&e[f].indent>=g;)e[f].indent+=h,f++;f--}var r=j.arrayToList(e,c,null,"p").listNode,z,u;d(!0);d(i);b.root.before(r);b.root.remove()},exec:function(d,h){var f=d.getSelection(),k=f&&f.getRanges();if(k&&!(1>k.length)){for(var j=f.getStartElement(),j=new g.ElementPath(j),r=a(this.type,j),j=f.createBookmarks(!0),n=[],w={};0<k.length;){var x=k.shift(),z=x.getBoundaryNodes(),u=z.startNode,y=z.endNode;u[0].nodeType==s.NodeType.ELEMENT_NODE&&"td"==u.nodeName()&&x.setStartAt(z.startNode,
e.POSITION_AFTER_START);y[0].nodeType==s.NodeType.ELEMENT_NODE&&"td"==y.nodeName()&&x.setEndAt(z.endNode,e.POSITION_BEFORE_END);x=x.createIterator();for(x.forceBrBreak=!1;z=x.getNextParagraph();)if(!z.data("list_block")){z._4e_setMarker(w,"list_block",1,i);for(var y=new b(z),C=y.elements,B=null,D=!1,B=y.blockLimit,A,u=C.length-1;0<=u&&(A=C[u]);u--)if(c[A.nodeName()]&&B.contains(A)){B.removeData("list_group_object");(u=A.data("list_group_object"))?u.contents.push(z):(u={root:A,contents:[z]},n.push(u),
A._4e_setMarker(w,"list_group_object",u,i));D=!0;break}D||(y=B||y.block,y.data("list_group_object")?y.data("list_group_object").contents.push(z):(u={root:y,contents:[z]},y._4e_setMarker(w,"list_group_object",u,i),n.push(u)))}}for(k=[];0<n.length;)u=n.shift(),r?c[u.root.nodeName()]&&(u.root.css("list-style-type")==h?this.removeList(d,u,w):u.root.css("list-style-type",h)):c[u.root.nodeName()]?this.changeListType(d,u,w,k,h):(g.Utils.clearAllMarkers(w),this.createList(d,u,k,h));for(var F=this,u=0;u<k.length;u++)B=
k[u],A=function(a,b){var c=b[a?"prev":"next"](o.whitespaces(!0),1);c&&c[0]&&c.nodeName()==F.type&&c.css("list-style-type")==h&&(c.remove(),c._4e_moveChildren(b,a?!0:!1,i))},A(i,B),A(!0,B);g.Utils.clearAllMarkers(w);f.selectBookmarks(j)}}};return{ListCommand:f,queryActive:a}},{requires:["editor","../list-utils/"]});
KISSY.add("editor/plugin/list-utils/index",function(d){var g={ol:1,ul:1},j=d.Node,i=d.DOM,f=i.NodeType,a=d.UA,c={listToArray:function(a,b,d,h,f){if(!g[a.nodeName()])return[];h||(h=0);d||(d=[]);for(var s=0,r=a[0].childNodes.length;s<r;s++){var p=new j(a[0].childNodes[s]);if("li"==p.nodeName()){var m={parent:a,indent:h,element:p,contents:[]};f?m.grandparent=f:(m.grandparent=a.parent(),m.grandparent&&"li"==m.grandparent.nodeName()&&(m.grandparent=m.grandparent.parent()));b&&p._4e_setMarker(b,"listarray_index",
d.length,void 0);d.push(m);for(var q=0,t=p[0].childNodes.length,l;q<t;q++)l=new j(p[0].childNodes[q]),l[0].nodeType==i.NodeType.ELEMENT_NODE&&g[l.nodeName()]?c.listToArray(l,b,d,h+1,m.grandparent):m.contents.push(l)}}return d},arrayToList:function(d,b,o,h){o||(o=0);if(!d||d.length<o+1)return null;for(var k=d[o].parent[0].ownerDocument,s=k.createDocumentFragment(),r=null,p=o,m=Math.max(d[o].indent,0),q=null;;){var t=d[p];if(t.indent==m){if(!r||d[p].parent.nodeName()!=r.nodeName())r=d[p].parent.clone(!1),
s.appendChild(r[0]);for(var q=r[0].appendChild(t.element.clone(!1)[0]),l=0;l<t.contents.length;l++)q.appendChild(t.contents[l].clone(!0)[0]);p++}else if(t.indent==Math.max(m,0)+1)p=c.arrayToList(d,null,p,h),q.appendChild(p.listNode),p=p.nextIndex;else if(-1==t.indent&&!o&&t.grandparent){g[t.grandparent.nodeName()]?q=t.element.clone(!1)[0]:"td"!=t.grandparent.nodeName()?(q=k.createElement(h),t.element._4e_copyAttributes(new j(q))):q=k.createDocumentFragment();for(l=0;l<t.contents.length;l++)r=t.contents[l].clone(!0),
q.nodeType==f.DOCUMENT_FRAGMENT_NODE&&t.element._4e_copyAttributes(new j(r)),q.appendChild(r[0]);q.nodeType==f.DOCUMENT_FRAGMENT_NODE&&p!=d.length-1&&(q.lastChild&&q.lastChild.nodeType==i.NodeType.ELEMENT_NODE&&"_moz"==q.lastChild.getAttribute("type")&&i._4e_remove(q.lastChild),i._4e_appendBogus(q));q.nodeType==i.NodeType.ELEMENT_NODE&&i.nodeName(q)==h&&q.firstChild&&(i._4e_trim(q),r=q.firstChild,r.nodeType==i.NodeType.ELEMENT_NODE&&i._4e_isBlockBoundary(r)&&(r=k.createDocumentFragment(),i._4e_moveChildren(q,
r),q=r));r=i.nodeName(q);!a.ie&&("div"==r||"p"==r)&&i._4e_appendBogus(q);s.appendChild(q);r=null;p++}else return null;if(d.length<=p||Math.max(d[p].indent,0)<m)break}if(b)for(d=new j(s.firstChild);d&&d[0];)d[0].nodeType==i.NodeType.ELEMENT_NODE&&d._4e_clearMarkers(b,!0),d=d._4e_nextSourceNode();return{listNode:s,nextIndex:p}}};return c},{requires:["editor"]});
KISSY.add("editor/plugin/local-storage/index",function(d,g,j,i){if(!d.UA.ie&&window.localStorage)return window.localStorage;var f=g.Utils.debugUrl("plugin/local-storage/swfstore.swf?t="+ +new Date),a=new i({movie:f,flashVars:{useCompression:!0},methods:["setItem","removeItem","getItem","setMinDiskSpace","getValueOf"]});a.swf.height=138;var c={width:215,border:"1px solid red"},e={width:0,border:"none"},b=new j({prefixCls:"ks-editor-",elStyle:{background:"white"},width:"0px",content:"<h1 style='text-align:center;'>\u8bf7\u70b9\u51fb\u5141\u8bb8</h1>",
zIndex:g.baseZIndex(g.zIndexManager.STORE_FLASH_SHOW)});b.render();b.get("contentEl").append(a.swf);b.center();b.show();a.on("pending",function(){b.get("el").css(c);b.center();b.show();setTimeout(function(){a.retrySave()},1E3)});a.on("save",function(){b.get("el").css(e)});var o=a.setItem;d.mix(a,{_ke:1,getItem:function(a){return this.getValueOf(a)},retrySave:function(){this.setItem(this.lastSave.k,this.lastSave.v)},setItem:function(a,b){this.lastSave={k:a,v:b};o.call(this,a,b)}});a.on("contentReady",
function(){a._ready=1});return a},{attach:!1,requires:["editor","overlay","../flash-bridge/"]});
KISSY.add("editor/plugin/maximize/cmd",function(d,g){function j(a){this.editor=a}var i=d.UA,f=i.ie,a=document,c=d.Node,e=d.Event,b=d.DOM,o;d.augment(j,{restoreWindow:function(){var a=this,b=a.editor;!1!==b.fire("beforeRestoreWindow")&&a._resize&&(e.remove(window,"resize",a._resize),a._resize.stop(),a._resize=0,a._saveEditorStatus(),a._restoreState(),setTimeout(function(){a._restoreEditorStatus();b.notifySelectionChange();b.fire("afterRestoreWindow")},30))},_restoreState:function(){var c=this.editor,
d=c.get("textarea"),e=this._savedParents;if(e){for(var g=0;g<e.length;g++){var i=e[g];i.el.css("position",i.position)}this._savedParents=null}d.parent().css({height:this.iframeHeight});d.css({height:this.iframeHeight});b.css(a.body,{width:"",height:"",overflow:""});a.documentElement.style.overflow="";d=c.get("el")[0].style;d.position="static";d.width=this.editorElWidth;o.css({left:"-99999px",top:"-99999px"});window.scrollTo(this.scrollLeft,this.scrollTop);8>f&&c.get("toolBarEl").removeClass(c.get("prefixCls")+
"editor-toolbar-padding",void 0)},_saveSate:function(){var a=this.editor,c=[],d=a.get("el");this.iframeHeight=a.get("textarea").parent().style("height");this.editorElWidth=d.style("width");this.scrollLeft=b.scrollLeft();this.scrollTop=b.scrollTop();window.scrollTo(0,0);for(d=d.parent();d;){var e=d.css("position");"static"!=e&&(c.push({el:d,position:e}),d.css("position","static"));d=d.parent()}this._savedParents=c;8>f&&a.get("toolBarEl").addClass(a.get("prefixCls")+"editor-toolbar-padding",void 0)},
_saveEditorStatus:function(){var a=this.editor;this.savedRanges=null;i.gecko&&a.__iframeFocus&&(this.savedRanges=(a=a.getSelection())&&a.getRanges())},_restoreEditorStatus:function(){var a=this.editor,b=a.getSelection(),c=this.savedRanges;i.gecko&&a.activateGecko();c&&b&&b.selectRanges(c);a.__iframeFocus&&b&&(a=b.getStartElement())&&a.scrollIntoView(void 0,!1)},_maximize:function(c){var d=this.editor,e=d.get("el"),i=b.viewportHeight(),j=b.viewportWidth(),m=d.get("textarea"),q=d.get("statusBarEl")?
d.get("statusBarEl")[0].offsetHeight:0,d=d.get("toolBarEl")[0].offsetHeight;f?a.body.style.overflow="hidden":b.css(a.body,{width:0,height:0,overflow:"hidden"});a.documentElement.style.overflow="hidden";e.css({position:"absolute",zIndex:g.baseZIndex(g.zIndexManager.MAXIMIZE),width:j+"px"});o.css({zIndex:g.baseZIndex(g.zIndexManager.MAXIMIZE-5),height:i+"px",width:j+"px"});e.offset({left:0,top:0});o.css({left:0,top:0});m.parent().css({height:i-q-d+"px"});m.css({height:i-q-d+"px"});!0!==c&&arguments.callee.call(this,
!0)},_real:function(){var a=this,b=a.editor;a._resize||(a._saveEditorStatus(),a._saveSate(),a._maximize(),a._resize||(a._resize=d.buffer(function(){a._maximize();b.fire("afterMaximizeWindow")},100)),e.on(window,"resize",a._resize),setTimeout(function(){a._restoreEditorStatus();b.notifySelectionChange();b.fire("afterMaximizeWindow")},30))},maximizeWindow:function(){!1!==this.editor.fire("beforeMaximizeWindow")&&(o||(o=(new c("<iframe  style='position:absolute;top:-9999px;left:-9999px;' frameborder='0'>")).prependTo(a.body,
void 0)),this._real())},destroy:function(){this._resize&&(e.remove(window,"resize",this._resize),this._resize.stop(),this._resize=0)}});return{init:function(a){if(!a.hasCommand("maximizeWindow")){var b=new j(a);a.addCommand("maximizeWindow",{exec:function(){b.maximizeWindow()}});a.addCommand("restoreWindow",{exec:function(){b.restoreWindow()}})}}}},{requires:["editor"]});
KISSY.add("editor/plugin/maximize/index",function(d,g,j){function i(){}d.augment(i,{renderUI:function(d){j.init(d);d.addButton("maximize",{tooltip:"\u5168\u5c4f",listeners:{click:function(){this.get("checked")?(d.execCommand("maximizeWindow"),this.set("tooltip","\u53d6\u6d88\u5168\u5c4f"),this.set("contentCls","restore")):(d.execCommand("restoreWindow"),this.set("tooltip","\u5168\u5c4f"),this.set("contentCls","maximize"));d.focus()}},checkable:!0})}});return i},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/menubutton/index",function(d,g,j){g.prototype.addSelect=function(i,f,a){var a=a||j.Select,c=this.get("prefixCls")+"editor-";if(f&&(f.editor=this,f.menu&&(f.menu.zIndex=g.baseZIndex(g.zIndexManager.SELECT),f.menu.xclass="popupmenu",d.each(f.menu.children,function(a){a.xclass="option"})),f.elCls))f.elCls=c+f.elCls;var e=(new a(d.mix({render:this.get("toolBarEl"),prefixCls:c},f))).render();e.get("el").unselectable();f.mode==g.WYSIWYG_MODE&&(this.on("wysiwygMode",function(){e.set("disabled",
!1)}),this.on("sourceMode",function(){e.set("disabled",!0)}));this.addControl(i+"/select",e);return e};return j},{requires:["editor","menubutton"]});KISSY.add("editor/plugin/multiple-upload/index",function(d,g,j){function i(d){this.config=d||{}}d.augment(i,{renderUI:function(d){var a=this;d.addButton("multipleUpload",{tooltip:"\u6279\u91cf\u63d2\u56fe",listeners:{click:function(){j.useDialog(d,"multiple-upload",a.config)}},mode:g.WYSIWYG_MODE})}});return i},{requires:["editor","../dialog-loader/"]});
KISSY.add("editor/plugin/ordered-list/cmd",function(d,g,j){var i=j.queryActive,f=new j.ListCommand("ol");return{init:function(a){a.hasCommand("insertOrderedList")||a.addCommand("insertOrderedList",{exec:function(a,b){a.focus();f.exec(a,b)}});var c=g.Utils.getQueryCmd("insertOrderedList");a.hasCommand(c)||a.addCommand(c,{exec:function(a){if((a=a.getSelection())&&!a.isInvalid)return a=a.getStartElement(),a=new g.ElementPath(a),i("ol",a)}})}}},{requires:["editor","../list-utils/cmd"]});
KISSY.add("editor/plugin/ordered-list/index",function(d,g,j,i){function f(){}d.augment(f,{renderUI:function(a){i.init(a);j.init(a,{cmdType:"insertOrderedList",buttonId:"orderedList",menu:{width:75,children:[{content:"1,2,3...",value:"decimal"},{content:"a,b,c...",value:"lower-alpha"},{content:"A,B,C...",value:"upper-alpha"},{content:"i,ii,iii...",value:"lower-roman"},{content:"I,II,III...",value:"upper-roman"}]},tooltip:"\u6709\u5e8f\u5217\u8868"})}});return f},{requires:["editor","../list-utils/btn","./cmd"]});
KISSY.add("editor/plugin/outdent/cmd",function(d,g,j){var i=j.addCommand,f=j.checkOutdentActive;return{init:function(a){i(a,"outdent");var c=g.Utils.getQueryCmd("outdent");a.hasCommand(c)||a.addCommand(c,{exec:function(a){if((a=a.getSelection())&&!a.isInvalid)return a=a.getStartElement(),a=new g.ElementPath(a),f(a)}})}}},{requires:["editor","../dent-utils/cmd"]});
KISSY.add("editor/plugin/outdent/index",function(d,g,j){function i(){}d.augment(i,{renderUI:function(d){j.init(d);d.addButton("outdent",{tooltip:"\u51cf\u5c11\u7f29\u8fdb\u91cf ",listeners:{click:function(){d.execCommand("outdent");d.focus()},afterSyncUI:function(){var a=this;d.on("selectionChange",function(){d.get("mode")!=g.SOURCE_MODE&&(d.queryCommandValue("outdent")?a.set("disabled",!1):a.set("disabled",!0))})}},mode:g.WYSIWYG_MODE})}});return i},{requires:["editor","./cmd"]});
KISSY.add("editor/plugin/overlay/index",function(d,g,j,i){var f=j.extend({bindUI:function(){i.init(this)}},{ATTRS:{prefixCls:{value:"ks-editor-"},zIndex:{value:g.baseZIndex(g.zIndexManager.OVERLAY)}}});f.Dialog=j.Dialog.extend({bindUI:function(){i.init(this)},show:function(){this.center();var a=this.get("y");200<a-d.DOM.scrollTop()&&(a=d.DOM.scrollTop()+200,this.set("y",a));f.prototype.show.call(this)}},{ATTRS:{prefixCls:{value:"ks-editor-"},zIndex:{value:g.baseZIndex(g.zIndexManager.OVERLAY)},draggable:{value:{constrain:!0}}}});
return f},{requires:["editor","overlay","../focus-fix/","dd/base","dd/constrain"]});
KISSY.add("editor/plugin/page-break/index",function(d,g,j){function i(){}var f=d.Node;d.augment(i,{renderUI:function(a){j.init(a);var c=a.htmlDataProcessor;(c&&c.dataFilter).addRules({tags:{div:function(a){var b=a.getAttribute("style"),d;if(b)for(var f=a.childNodes,g=0;g<f.length;g++)1==f[g].nodeType&&(d=f[g]);if((d=d&&"span"==d.nodeName&&d.getAttribute("style"))&&/page-break-after\s*:\s*always/i.test(b)&&/display\s*:\s*none/i.test(d))return c.createFakeParserElement(a,"ke_pagebreak","div")}}});a.addButton("pageBreak",
{tooltip:"\u5206\u9875",listeners:{click:function(){var c=new f('<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>',null,a.get("document")[0]),c=a.createFakeElement(c,"ke_pagebreak","div",!1,'<div style="page-break-after: always; "><span style="DISPLAY:none">&nbsp;</span></div>');a.focus();var b=a.getSelection();if(b=b&&b.getRanges()[0]){a.execCommand("save");for(var d=b.startContainer,g=d;"body"!==d.nodeName();)g=d,d=d.parent();b.collapse(!0);b.splitElement(g);c.insertAfter(g);
a.execCommand("save")}}},mode:g.WYSIWYG_MODE})}});return i},{requires:["editor","../fake-objects/"]});
KISSY.add("editor/plugin/preview/index",function(d){function g(){}var j=window;d.augment(g,{renderUI:function(d){d.addButton("preview",{tooltip:"\u9884\u89c8",listeners:{click:function(){try{var f=j.screen,a=Math.round(0.8*f.width),c=Math.round(0.7*f.height),e=Math.round(0.1*f.width)}catch(b){a=640,c=420,e=80}f=d.getDocHtml().replace(/\${title}/,"\u9884\u89c8");a=j.open("","","toolbar=yes,location=no,status=yes,menubar=yes,scrollbars=yes,resizable=yes,width="+a+",height="+c+",left="+e);c=a.document;c.open();c.write(f);
c.close();a.focus()}}})}});return g});
KISSY.add("editor/plugin/progressbar/index",function(d){function g(){g.superclass.constructor.apply(this,arguments);this._init()}var j=d.Node;g.ATTRS={container:{},width:{},height:{},progress:{value:0},prefixCls:{value:"ks-"}};d.extend(g,d.Base,{destroy:function(){this.detach();this.el.remove()},_init:function(){var g=this.get("height"),f=this.get("prefixCls"),a=new j(d.substitute("<div class='{prefixCls}editor-progressbar'  style='width:"+this.get("width")+";height:"+g+";'></div>",{prefixCls:f})),
c=this.get("container"),g=(new j(d.substitute("<div style='overflow:hidden;'><div class='{prefixCls}editor-progressbar-inner' style='height:"+(parseInt(g)-4)+"px'><div class='{prefixCls}editor-progressbar-inner-bg'></div></div></div>",{prefixCls:f}))).appendTo(a),f=(new j("<span class='"+f+"editor-progressbar-title'></span>")).appendTo(a);c&&a.appendTo(c);this.el=a;this._title=f;this._p=g;this.on("afterProgressChange",this._progressChange,this);this._progressChange({newVal:this.get("progress")})},
_progressChange:function(d){d=d.newVal;this._p.css("width",d+"%");this._title.html(d+"%")}});return g});
KISSY.add("editor/plugin/remove-format/cmd",function(d,g){function j(a,c){for(var d=0;d<c.length;d++)a.removeAttr(c[d])}var i=g.RANGE,f=g.ElementPath,a=d.DOM,c="class,style,lang,width,height,align,hspace,valign".split(/,/),e=RegExp("^(?:"+"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var,s".replace(/,/g,"|")+")$","i");return{init:function(b){b.hasCommand("removeFormat")||b.addCommand("removeFormat",{exec:function(){b.focus();e.lastIndex=0;var d=b.getSelection().getRanges();
b.execCommand("save");for(var g=0,k;k=d[g];g++)if(!k.collapsed){k.enlarge(i.ENLARGE_ELEMENT);var s=k.createBookmark(),r=s.startNode,p=s.endNode,m=function(a){for(var b=new f(a),c=b.elements,d=1,g;(g=c[d])&&!g.equals(b.block)&&!g.equals(b.blockLimit);d++)e.test(g.nodeName())&&a._4e_breakParent(g)};m(r);m(p);for(r=r._4e_nextSourceNode(!0,a.NodeType.ELEMENT_NODE,void 0,void 0);r&&!r.equals(p);)m=r._4e_nextSourceNode(!1,a.NodeType.ELEMENT_NODE,void 0,void 0),"img"==r.nodeName()&&(r.attr("_ke_realelement")||
/\bke_/.test(r[0].className))||(e.test(r.nodeName())?r._4e_remove(!0):j(r,c)),r=m;k.moveToBookmark(s)}b.getSelection().selectRanges(d);b.execCommand("save")}})}}},{requires:["editor"]});KISSY.add("editor/plugin/remove-format/index",function(d,g,j){function i(){}d.augment(i,{renderUI:function(d){j.init(d);d.addButton("removeFormat",{tooltip:"\u6e05\u9664\u683c\u5f0f",listeners:{click:function(){d.execCommand("removeFormat")}},mode:g.WYSIWYG_MODE})}});return i},{requires:["editor","./cmd","../button/"]});
KISSY.add("editor/plugin/resize/index",function(d,g,j){function i(a){this.config=a||{}}var f=d.Node;d.augment(i,{renderUI:function(a){var c=j.Draggable,e=a.get("statusBarEl");a.get("textarea");var b=this.config.direction||["x","y"],g="se-resize";1==b.length&&(g="x"==b[0]?"e-resize":"s-resize");var h=(new f("<div class='"+a.get("prefixCls")+"editor-resizer' style='cursor: "+g+"'></div>")).appendTo(e);a.on("maximizeWindow",function(){h.css("display","none")});a.on("restoreWindow",function(){h.css("display",
"")});var i=new c({node:h}),s=0,r=0,p=a.get("el"),m=a.get("el");i.on("dragstart",function(){s=p.height();r=m.width();a.fire("resizeStart")});i.on("drag",function(c){var e=c.left-this.get("startNodePos").left,c=c.top-this.get("startNodePos").top;d.inArray("y",b)&&a.set("height",s+c);d.inArray("x",b)&&a.set("width",r+e);a.fire("resize")});a.on("destroy",function(){i.destroy();h.remove()})}});return i},{requires:["editor","dd/base"]});
KISSY.add("editor/plugin/separator/index",function(d){function g(){}d.augment(g,{renderUI:function(g){d.all('<span class="'+g.get("prefixCls")+'editor-toolbar-separator">&nbsp;</span>').appendTo(g.get("toolBarEl"))}});return g},{requires:["editor"]});
KISSY.add("editor/plugin/smiley/index",function(d,g,j){function i(){}for(var f="<div class='{prefixCls}editor-smiley-sprite'>",a=0;98>=a;a++)f+="<a href='javascript:void(0)' data-icon='http://a.tbcdn.cn/sys/wangwang/smiley/48x48/"+a+".gif'></a>";f+="</div>";d.augment(i,{renderUI:function(a){var e=a.get("prefixCls");a.addButton("smiley",{tooltip:"\u63d2\u5165\u8868\u60c5",checkable:!0,listeners:{afterSyncUI:function(){var a=this;a.on("blur",function(){setTimeout(function(){a.smiley&&a.smiley.hide()},150)})},click:function(){var b=
this,i;if(b.get("checked")){if(!(i=b.smiley))i=b.smiley=(new j({content:d.substitute(f,{prefixCls:e}),focus4e:!1,width:300,elCls:e+"editor-popup",zIndex:g.baseZIndex(g.zIndexManager.POPUP_MENU),mask:!1})).render(),i.get("el").on("click",function(b){var b=new d.Node(b.target),e;if("a"==b.nodeName()&&(e=b.attr("data-icon")))e=new d.Node("<img alt='' src='"+e+"'/>",null,a.get("document")[0]),a.insertElement(e)}),i.on("hide",function(){b.set("checked",!1)});i.set("align",{node:this.get("el"),points:["bl",
"tl"],overflow:{adjustX:1,adjustY:1}});i.show()}else b.smiley&&b.smiley.hide()},destroy:function(){this.smiley&&this.smiley.destroy()}},mode:g.WYSIWYG_MODE})}});return i},{requires:["editor","../overlay/"]});
KISSY.add("editor/plugin/source-area/index",function(d,g){function j(){}var i=g.SOURCE_MODE,f=g.WYSIWYG_MODE;d.augment(j,{renderUI:function(a){a.addButton("sourceArea",{tooltip:"\u6e90\u7801",listeners:{afterSyncUI:function(){var c=this;a.on("wysiwygMode",function(){c.set("checked",!1)});a.on("sourceMode",function(){c.set("checked",!0)})},click:function(){this.get("checked")?a.set("mode",i):a.set("mode",f)}},checkable:!0})}});return j},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/strike-through/cmd",function(d,g,j){var i=new g.Style({element:"del",overrides:[{element:"span",attributes:{style:"text-decoration: line-through;"}},{element:"s"},{element:"strike"}]});return{init:function(d){j.addButtonCmd(d,"strikeThrough",i)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/strike-through/index",function(d,g,j,i){function f(){}d.augment(f,{renderUI:function(a){i.init(a);a.addButton("strikeThrough",{cmdType:"strikeThrough",tooltip:"\u5220\u9664\u7ebf "},j.Button)}});return f},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/table/index",function(d,g,j){function i(a){function b(a){!(0<e.length)&&a[0].nodeType==p.NodeType.ELEMENT_NODE&&t.test(a.nodeName())&&!a.data("selected_cell")&&(a._4e_setMarker(f,"selected_cell",!0,void 0),e.push(a))}for(var c=a.createBookmarks(),d=a.getRanges(),e=[],f={},h=0;h<d.length;h++){var i=d[h];if(i.collapsed)i=i.getCommonAncestor(),(i=i.closest("td",void 0)||i.closest("th",void 0))&&e.push(i);else{var i=new Walker(i),k;for(i.guard=b;k=i.next();)if((k=k.parent())&&
t.test(k.nodeName())&&!k.data("selected_cell"))k._4e_setMarker(f,"selected_cell",!0,void 0),e.push(k)}}g.Utils.clearAllMarkers(f);a.selectBookmarks(c);return e}function f(a,b){var c=a.getStartElement().parent("tr");if(c){var d=c.clone(!0);d.insertBefore(c);c=(b?d[0]:c[0]).cells;for(d=0;d<c.length;d++)c[d].innerHTML="",r.ie||(new m(c[d]))._4e_appendBogus(void 0)}}function a(b){if(b instanceof g.Selection){for(var c=i(b),d=c.length,b=[],e,f,h=0;h<d;h++){var k=c[h].parent(),j=k[0].rowIndex;!h&&(e=j-
1);b[j]=k;h==d-1&&(f=j+1)}h=k.parent("table");e=new m(f<h[0].rows.length&&h[0].rows[f]||0<e&&h[0].rows[e]||h[0].parentNode);for(h=b.length;0<=h;h--)b[h]&&a(b[h]);return e}b instanceof m&&(h=b.parent("table"),1==h[0].rows.length?h.remove():b.remove());return 0}function c(a,b){var c=a.getStartElement();if(c=c.closest("td",void 0)||c.closest("th",void 0))for(var d=c.parent("table"),e=c[0].cellIndex,g=0;g<d[0].rows.length;g++){var f=d[0].rows[g];f.cells.length<e+1||(c=new m(f.cells[e].cloneNode(void 0)),
r.ie||c._4e_appendBogus(void 0),f=new m(f.cells[e]),b?c.insertBefore(f):c.insertAfter(f))}}function e(b){if(b instanceof g.Selection){var c=i(b),d,f=[],b=c[0]&&c[0].parent("table"),h,k,j;h=0;for(k=c.length;h<k;h++)f.push(c[h][0].cellIndex);f.sort();h=1;for(k=f.length;h<k;h++)if(1<f[h]-f[h-1]){j=f[h-1]+1;break}j||(j=0<f[0]?f[0]-1:f[f.length-1]+1);f=b[0].rows;h=0;for(k=f.length;h<k&&!(d=f[h].cells[j]);h++);d=d?new m(d):b.prev();for(j=c.length-1;0<=j;j--)c[j]&&e(c[j]);return d}if(b instanceof m){c=b.parent("table");
if(!c)return null;d=b[0].cellIndex;for(j=c[0].rows.length-1;0<=j;j--)b=new m(c[0].rows[j]),!d&&1==b[0].cells.length?a(b):b[0].cells[d]&&b[0].removeChild(b[0].cells[d])}return null}function b(a,b){var c=new g.Range(a[0].ownerDocument);if(!c.moveToElementEditablePosition(a,b?!0:void 0))c.selectNodeContents(a),c.collapse(b?!1:!0);c.select(!0)}function o(a){var b=(a=a.getSelection())&&a.getStartElement(),c=b&&b.closest("table",void 0);if(c)return a=b.closest(function(a){var b=p.nodeName(a);return c.contains(a)&&
("td"==b||"th"==b)},void 0),b=b.closest(function(a){var b=p.nodeName(a);return c.contains(a)&&"tr"==b},void 0),{table:c,td:a,tr:b}}function h(a){return(a=o(a))&&a.td}function k(a){return(a=o(a))&&a.tr}function s(a){this.config=a||{}}var r=d.UA,p=d.DOM,m=d.Node,q=["tr","th","td","tbody","table"],t=/^(?:td|th)$/,l={"\u8868\u683c\u5c5e\u6027":o,"\u5220\u9664\u8868\u683c":h,"\u5220\u9664\u5217":h,"\u5220\u9664\u884c":k,"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":k,"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":k,"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":h,"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":h},v=(6===r.ie?["table.%2,","table.%2 td, table.%2 th,","{","border : #d3d3d3 1px dotted","}"]:" table.%2,; table.%2 > tr > td,  table.%2 > tr > th,; table.%2 > tbody > tr > td,  table.%2 > tbody > tr > th,; table.%2 > thead > tr > td,  table.%2 > thead > tr > th,; table.%2 > tfoot > tr > td,  table.%2 > tfoot > tr > th;{;border : #d3d3d3 1px dotted;}".split(";")).join("").replace(/%2/g,
"ke_show_border"),n={tags:{table:function(a){var b=a.getAttribute("class"),c=parseInt(a.getAttribute("border"),10);if(!c||0>=c)a.setAttribute("class",d.trim((b||"")+" ke_show_border"))}}},w={tags:{table:function(a){var b=a.getAttribute("class");b&&((b=d.trim(b.replace("ke_show_border","")))?a.setAttribute("class",b):a.removeAttribute("class"))}}};d.augment(s,{renderUI:function(h){h.addCustomStyle(v);var i=h.htmlDataProcessor,k=i&&i.htmlFilter;(i&&i.dataFilter).addRules(n);k.addRules(w);var m=this,
r={"\u8868\u683c\u5c5e\u6027":function(){this.hide();var a=o(h);a&&j.useDialog(h,"table",m.config,{selectedTable:a.table,selectedTd:a.td})},"\u5220\u9664\u8868\u683c":function(){this.hide();var a=h.getSelection(),b=a&&a.getStartElement();if(b=b&&b.closest("table",void 0)){h.execCommand("save");a.selectElement(b);var c=a.getRanges()[0];c.collapse();a.selectRanges([c]);a=b.parent();1==a[0].childNodes.length&&"body"!=a.nodeName()&&"td"!=a.nodeName()?a.remove():b.remove();h.execCommand("save")}},"\u5220\u9664\u884c ":function(){this.hide();h.execCommand("save");
var c=h.getSelection();b(a(c),void 0);h.execCommand("save")},"\u5220\u9664\u5217 ":function(){this.hide();h.execCommand("save");var a=h.getSelection();(a=e(a))&&b(a,!0);h.execCommand("save")},"\u5728\u4e0a\u65b9\u63d2\u5165\u884c":function(){this.hide();h.execCommand("save");var a=h.getSelection();f(a,!0);h.execCommand("save")},"\u5728\u4e0b\u65b9\u63d2\u5165\u884c":function(){this.hide();h.execCommand("save");var a=h.getSelection();f(a,void 0);h.execCommand("save")},"\u5728\u5de6\u4fa7\u63d2\u5165\u5217":function(){this.hide();h.execCommand("save");var a=h.getSelection();c(a,!0);h.execCommand("save")},
"\u5728\u53f3\u4fa7\u63d2\u5165\u5217":function(){this.hide();h.execCommand("save");var a=h.getSelection();c(a,void 0);h.execCommand("save")}},s=[];d.each(r,function(a,b){s.push({content:b})});h.addContextMenu("table",function(a){if(d.inArray(p.nodeName(a),q))return!0},{width:"120px",children:s,listeners:{click:function(a){a=a.target.get("content");r[a]&&r[a].apply(this)},beforeVisibleChange:function(a){if(a.newVal){var b=this,a=b.get("children"),c=b.get("editor");d.each(a,function(a){var d=a.get("content");!l[d]||l[d].call(b,
c)?a.set("disabled",!1):a.set("disabled",!0)})}}}});h.addButton("table",{mode:g.WYSIWYG_MODE,listeners:{click:function(){j.useDialog(h,"table",m.config,{selectedTable:0,selectedTd:0})}},tooltip:"\u63d2\u5165\u8868\u683c"})}});return s},{requires:["editor","../dialog-loader/","../contextmenu/"]});
KISSY.add("editor/plugin/underline/cmd",function(d,g,j){var i=new g.Style({element:"u",overrides:[{element:"span",attributes:{style:"text-decoration: underline;"}}]});return{init:function(d){j.addButtonCmd(d,"underline",i)}}},{requires:["editor","../font/cmd"]});
KISSY.add("editor/plugin/underline/index",function(d,g,j,i){function f(){}d.augment(f,{renderUI:function(a){i.init(a);a.addButton("underline",{cmdType:"underline",tooltip:"\u4e0b\u5212\u7ebf "},j.Button);a.docReady(function(){a.get("document").on("keydown",function(c){c.ctrlKey&&c.keyCode==d.Node.KeyCodes.U&&(a.execCommand("underline"),c.preventDefault())})})}});return f},{requires:["editor","../font/ui","./cmd"]});
KISSY.add("editor/plugin/undo/btn",function(d,g,j){d=j.extend({bindUI:function(){var d=this,f=d.get("editor");d.on("click",function(){f.execCommand("undo")});f.on("afterUndo afterRedo afterSave",function(a){0<a.index?d.set("disabled",!1):d.set("disabled",!0)})}},{ATTRS:{mode:{value:g.WYSIWYG_MODE},disabled:{value:!0}}});return{RedoBtn:j.extend({bindUI:function(){var d=this,f=d.get("editor");d.on("click",function(){f.execCommand("redo")});f.on("afterUndo afterRedo afterSave",function(a){a.index<a.history.length-
1?d.set("disabled",!1):d.set("disabled",!0)})}},{mode:{value:g.WYSIWYG_MODE},ATTRS:{disabled:{value:!0}}}),UndoBtn:d}},{requires:["editor","../button/"]});
KISSY.add("editor/plugin/undo/cmd",function(d,g){function j(a){var c=a.get("document")[0].body.innerHTML,d;c&&(d=a.getSelection());this.contents=c;this.bookmarks=d&&d.createBookmarks2(!0)}function i(a){this.history=[];this.index=-1;this.editor=a;this.bufferRunner=d.buffer(this.save,500,this);this._init()}var f=g.Utils.arrayCompare,a=d.UA;d.augment(j,{equals:function(a){if(this.contents!=a.contents)return!1;var c=this.bookmarks,a=a.bookmarks;if(c||a){if(!c||!a||c.length!=a.length)return!1;for(var d=
0;d<c.length;d++){var e=c[d],g=a[d];if(e.startOffset!=g.startOffset||e.endOffset!=g.endOffset||!f(e.start,g.start)||!f(e.end,g.end))return!1}}return!0}});var c={16:1,17:1,18:1},e={37:1,38:1,39:1,40:1,33:1,34:1};d.augment(i,{_keyMonitor:function(){var a=this,d=a.editor;d.docReady(function(){d.get("document").on("keydown",function(g){var f=g.keyCode;f in e||f in c||(90===f&&(g.ctrlKey||g.metaKey)?(!1!==d.fire("beforeRedo")&&a.restore(-1),g.halt()):89===f&&(g.ctrlKey||g.metaKey)?(!1!==d.fire("beforeUndo")&&
a.restore(1),g.halt()):!1!==d.fire("beforeSave",{buffer:1})&&a.save(1))})})},_init:function(){var a=this;a._keyMonitor();setTimeout(function(){a.save()},0)},save:function(a){var c=this.editor;if(c.get("mode")==g.WYSIWYG_MODE&&c.get("document"))if(a)this.bufferRunner();else{var a=this.history,d=this.index;a.length>d+1&&a.splice(d+1,a.length-d-1);var d=a[a.length-1],e=new j(c);if(!d||!d.equals(e))30===a.length&&a.shift(),a.push(e),this.index=d=a.length-1,c.fire("afterSave",{history:a,index:d})}},restore:function(b){if(this.editor.get("mode")==
g.WYSIWYG_MODE){var c=this.history,d=this.editor,e=d.get("document")[0].body,f=c[this.index+b];f&&(e.innerHTML=f.contents,f.bookmarks?d.getSelection().selectBookmarks(f.bookmarks):a.ie&&(e=e.createTextRange(),e.collapse(!0),e.select()),(e=d.getSelection())&&e.scrollIntoView(),this.index+=b,d.fire(0<b?"afterUndo":"afterRedo",{history:c,index:this.index}),d.notifySelectionChange());return f}}});return{init:function(a){if(!a.hasCommand("save")){var c=new i(a);a.addCommand("save",{exec:function(d,e){a.focus();
c.save(e)}});a.addCommand("undo",{exec:function(){a.focus();c.restore(-1)}});a.addCommand("redo",{exec:function(){a.focus();c.restore(1)}})}}}},{requires:["editor"]});KISSY.add("editor/plugin/undo/index",function(d,g,j,i){function f(){}d.augment(f,{renderUI:function(a){i.init(a);a.addButton("undo",{mode:g.WYSIWYG_MODE,tooltip:"\u64a4\u9500",editor:a},j.UndoBtn);a.addButton("redo",{mode:g.WYSIWYG_MODE,tooltip:"\u91cd\u505a",editor:a},j.RedoBtn)}});return f},{requires:["editor","./btn","./cmd"]});
KISSY.add("editor/plugin/unordered-list/cmd",function(d,g,j){var i=j.queryActive,f=new j.ListCommand("ul");return{init:function(a){a.hasCommand("insertUnorderedList")||a.addCommand("insertUnorderedList",{exec:function(a,b){a.focus();f.exec(a,b)}});var c=g.Utils.getQueryCmd("insertUnorderedList");a.hasCommand(c)||a.addCommand(c,{exec:function(a){if((a=a.getSelection())&&!a.isInvalid)return a=a.getStartElement(),a=new g.ElementPath(a),i("ul",a)}})}}},{requires:["editor","../list-utils/cmd"]});
KISSY.add("editor/plugin/unordered-list/index",function(d,g,j,i){function f(){}d.augment(f,{renderUI:function(a){i.init(a);j.init(a,{cmdType:"insertUnorderedList",buttonId:"unorderedList",menu:{width:75,children:[{content:"\u25cf \u5706\u70b9",value:"disc"},{content:"\u25cb \u5706\u5708",value:"circle"},{content:"\u25a0 \u65b9\u5757",value:"square"}]},tooltip:"\u65e0\u5e8f\u5217\u8868"})}});return f},{requires:["editor","../list-utils/btn","./cmd"]});
KISSY.add("editor/plugin/video/index",function(d,g,j,i,f){function a(a){this.config=a}d.augment(a,{renderUI:function(a){function d(a){for(var b=0;b<h.length;b++){var c=h[b];if(c.reg.test(a))return c}}f.init(a);var b=a.htmlDataProcessor,o=b&&b.dataFilter,h=[],k=this.config;k.providers&&h.push.apply(h,k.providers);k.getProvider=d;o&&o.addRules({tags:{object:function(a){var c=a.getAttribute("classid"),f=a.childNodes;if(!c){for(c=0;c<f.length;c++)if("embed"==f[c].nodeName){if(!j.isFlashEmbed(f[c]))break;
if(d(f[c].getAttribute("src")))return b.createFakeParserElement(a,"ke_video","video",!0)}return null}for(c=0;c<f.length;c++){var g=f[c];if("param"==g.nodeName&&"movie"==g.getAttribute("name").toLowerCase()&&d(g.getAttribute("value")))return b.createFakeParserElement(a,"ke_video","video",!0)}},embed:function(a){if(!j.isFlashEmbed(a))return null;if(d(a.getAttribute("src")))return b.createFakeParserElement(a,"ke_video","video",!0)}}},4);var s=new i({editor:a,cls:"ke_video",type:"video",pluginConfig:this.config,
bubbleId:"video",contextMenuId:"video",contextMenuHandlers:{"\u89c6\u9891\u5c5e\u6027":function(){var a=this.get("editorSelectedEl");a&&s.show(a)}}});a.addButton("video",{tooltip:"\u63d2\u5165\u89c6\u9891",listeners:{click:function(){s.show()}},mode:g.WYSIWYG_MODE})}});return a},{requires:["editor","../flash-common/utils","../flash-common/baseClass","../fake-objects/"]});
KISSY.add("editor/plugin/xiami-music/index",function(d,g,j,i,f){function a(){a.superclass.constructor.apply(this,arguments)}function c(a){this.config=a||{}}d.extend(a,j,{_updateTip:function(a,b){var c=this.get("editor").restoreRealElement(b);c&&(a.html(b.attr("title")),a.attr("href",this._getFlashUrl(c)))}});d.augment(c,{renderUI:function(c){function b(a){return/xiami\.com/i.test(a)}f.init(c);var d=c.htmlDataProcessor,h=d&&d.dataFilter;h&&h.addRules({tags:{object:function(a){var c=a.getAttribute("title"),
e,f;e=a.getAttribute("classid");var g=a.childNodes;if(!e){for(e=0;e<g.length;e++)if(f=g[e],"embed"==f.nodeName){if(!i.isFlashEmbed(f))break;if(b(f.attributes.src))return d.createFakeParserElement(a,"ke_xiami","xiami-music",!0,{title:c})}return null}for(e=0;e<g.length;e++)if(f=g[e],"param"==f.nodeName&&"movie"==f.getAttribute("name")&&b(f.getAttribute("value")))return d.createFakeParserElement(a,"ke_xiami","xiami-music",!0,{title:c})},embed:function(a){if(i.isFlashEmbed(a)&&b(a.getAttribute("src")))return d.createFakeParserElement(a,
"ke_xiami","xiami-music",!0,{title:a.getAttribute("title")})}}},4);var j=new a({editor:c,cls:"ke_xiami",type:"xiami-music",bubbleId:"xiami",pluginConfig:this.config,contextMenuId:"xiami",contextMenuHandlers:{"\u867e\u7c73\u5c5e\u6027":function(){var a=this.get("editorSelectedEl");a&&j.show(a)}}});c.addButton("xiamiMusic",{tooltip:"\u63d2\u5165\u867e\u7c73\u97f3\u4e50",listeners:{click:function(){j.show()}},mode:g.WYSIWYG_MODE})}});return c},{requires:["editor","../flash-common/baseClass","../flash-common/utils","../fake-objects/"]});
KISSY.add("editor/full",function(d,g){return g},{requires:["editor"]});
