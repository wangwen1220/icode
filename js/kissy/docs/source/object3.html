<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='global-property-'>/**
</span> * @ignore
 * @fileOverview event object for dom
 * @author yiminghe@gmail.com
 */
KISSY.add('event/dom/base/object', function (S, Event, undefined) {

    var doc = S.Env.host.document,
        TRUE = true,
        FALSE = false,
        props = ('type altKey attrChange attrName bubbles button cancelable ' +
            'charCode clientX clientY ctrlKey currentTarget data detail ' +
            'eventPhase fromElement handler keyCode metaKey ' +
            'newValue offsetX offsetY pageX pageY prevValue ' +
            'relatedNode relatedTarget screenX screenY shiftKey srcElement ' +
            'target toElement view wheelDelta which axis ' +
            'changedTouches touches targetTouches rotation scale').split(' ');

<span id='KISSY-Event-DOMEventObject'>    /**
</span>     * Do not new by yourself.
     *
     * KISSY 's dom event system normalizes the event object according to
     * W3C standards.
     *
     * The event object is guaranteed to be passed to
     * the event handler.
     *
     * Most properties from the original event are
     * copied over and normalized to the new event object
     * according to [W3C standards](http://www.w3.org/TR/dom/#event).
     *
     * @class KISSY.Event.DOMEventObject
     * @extends KISSY.Event.Object
     * @param domEvent native dom event
     */
    function DOMEventObject(domEvent) {
        var self = this;

        if ('@DEBUG@') {
<span id='KISSY-Event-DOMEventObject-property-altKey'>            /**
</span>             * altKey
             * @property altKey
             */
            self.altKey = undefined;
<span id='KISSY-Event-DOMEventObject-property-attrChange'>            /**
</span>             * attrChange
             * @property attrChange
             */
            self.attrChange = undefined;
<span id='KISSY-Event-DOMEventObject-property-attrName'>            /**
</span>             * attrName
             * @property attrName
             */
            self.attrName = undefined;
<span id='KISSY-Event-DOMEventObject-property-bubbles'>            /**
</span>             * bubbles
             * @property bubbles
             */
            self.bubbles = undefined;
<span id='KISSY-Event-DOMEventObject-property-button'>            /**
</span>             * button
             * @property button
             */
            self.button = undefined;
<span id='KISSY-Event-DOMEventObject-property-cancelable'>            /**
</span>             * cancelable
             * @property cancelable
             */
            self.cancelable = undefined;
<span id='KISSY-Event-DOMEventObject-property-charCode'>            /**
</span>             * charCode
             * @property charCode
             */
            self.charCode = undefined;
<span id='KISSY-Event-DOMEventObject-property-clientX'>            /**
</span>             * clientX
             * @property clientX
             */
            self.clientX = undefined;
<span id='KISSY-Event-DOMEventObject-property-clientY'>            /**
</span>             * clientY
             * @property clientY
             */
            self.clientY = undefined;
<span id='KISSY-Event-DOMEventObject-property-ctrlKey'>            /**
</span>             * ctrlKey
             * @property ctrlKey
             */
            self.ctrlKey = undefined;
<span id='KISSY-Event-DOMEventObject-property-data'>            /**
</span>             * data
             * @property data
             */
            self.data = undefined;
<span id='KISSY-Event-DOMEventObject-property-detail'>            /**
</span>             * detail
             * @property detail
             */
            self.detail = undefined;
<span id='KISSY-Event-DOMEventObject-property-eventPhase'>            /**
</span>             * eventPhase
             * @property eventPhase
             */
            self.eventPhase = undefined;
<span id='KISSY-Event-DOMEventObject-property-fromElement'>            /**
</span>             * fromElement
             * @property fromElement
             */
            self.fromElement = undefined;
<span id='KISSY-Event-DOMEventObject-property-handler'>            /**
</span>             * handler
             * @property handler
             */
            self.handler = undefined;
<span id='KISSY-Event-DOMEventObject-property-keyCode'>            /**
</span>             * keyCode
             * @property keyCode
             */
            self.keyCode = undefined;
<span id='KISSY-Event-DOMEventObject-property-metaKey'>            /**
</span>             * metaKey
             * @property metaKey
             */
            self.metaKey = undefined;
<span id='KISSY-Event-DOMEventObject-property-newValue'>            /**
</span>             * newValue
             * @property newValue
             */
            self.newValue = undefined;
<span id='KISSY-Event-DOMEventObject-property-offsetX'>            /**
</span>             * offsetX
             * @property offsetX
             */
            self.offsetX = undefined;
<span id='KISSY-Event-DOMEventObject-property-offsetY'>            /**
</span>             * offsetY
             * @property offsetY
             */
            self.offsetY = undefined;
<span id='KISSY-Event-DOMEventObject-property-pageX'>            /**
</span>             * pageX
             * @property pageX
             */
            self.pageX = undefined;
<span id='KISSY-Event-DOMEventObject-property-pageY'>            /**
</span>             * pageY
             * @property pageY
             */
            self.pageY = undefined;
<span id='KISSY-Event-DOMEventObject-property-prevValue'>            /**
</span>             * prevValue
             * @property prevValue
             */
            self.prevValue = undefined;
<span id='KISSY-Event-DOMEventObject-property-relatedNode'>            /**
</span>             * relatedNode
             * @property relatedNode
             */
            self.relatedNode = undefined;
<span id='KISSY-Event-DOMEventObject-property-relatedTarget'>            /**
</span>             * relatedTarget
             * @property relatedTarget
             */
            self.relatedTarget = undefined;
<span id='KISSY-Event-DOMEventObject-property-screenX'>            /**
</span>             * screenX
             * @property screenX
             */
            self.screenX = undefined;
<span id='KISSY-Event-DOMEventObject-property-screenY'>            /**
</span>             * screenY
             * @property screenY
             */
            self.screenY = undefined;
<span id='KISSY-Event-DOMEventObject-property-shiftKey'>            /**
</span>             * shiftKey
             * @property shiftKey
             */
            self.shiftKey = undefined;
<span id='KISSY-Event-DOMEventObject-property-srcElement'>            /**
</span>             * srcElement
             * @property srcElement
             */
            self.srcElement = undefined;

<span id='KISSY-Event-DOMEventObject-property-toElement'>            /**
</span>             * toElement
             * @property toElement
             */
            self.toElement = undefined;
<span id='KISSY-Event-DOMEventObject-property-view'>            /**
</span>             * view
             * @property view
             */
            self.view = undefined;
<span id='KISSY-Event-DOMEventObject-property-wheelDelta'>            /**
</span>             * wheelDelta
             * @property wheelDelta
             */
            self.wheelDelta = undefined;
<span id='KISSY-Event-DOMEventObject-property-which'>            /**
</span>             * which
             * @property which
             */
            self.which = undefined;
<span id='KISSY-Event-DOMEventObject-property-changedTouches'>            /**
</span>             * changedTouches
             * @property changedTouches
             */
            self.changedTouches = undefined;
<span id='KISSY-Event-DOMEventObject-property-touches'>            /**
</span>             * touches
             * @property touches
             */
            self.touches = undefined;
<span id='KISSY-Event-DOMEventObject-property-targetTouches'>            /**
</span>             * targetTouches
             * @property targetTouches
             */
            self.targetTouches = undefined;
<span id='KISSY-Event-DOMEventObject-property-rotation'>            /**
</span>             * rotation
             * @property rotation
             */
            self.rotation = undefined;
<span id='KISSY-Event-DOMEventObject-property-scale'>            /**
</span>             * scale
             * @property scale
             */
            self.scale = undefined;
        }

        DOMEventObject.superclass.constructor.call(self);
        self.originalEvent = domEvent;
        // in case dom event has been mark as default prevented by lower dom node
        self.isDefaultPrevented = ( domEvent['defaultPrevented'] || domEvent.returnValue === FALSE ||
            domEvent['getPreventDefault'] &amp;&amp; domEvent['getPreventDefault']() ) ? function () {
            return TRUE;
        } : function () {
            return FALSE;
        };
        fix(self);
        fixMouseWheel(self);
<span id='KISSY-Event-DOMEventObject-property-target'>        /**
</span>         * source html node of current event
         * @property target
         * @type {HTMLElement}
         */
<span id='KISSY-Event-DOMEventObject-property-currentTarget'>        /**
</span>         * current htm node which processes current event
         * @property currentTarget
         * @type {HTMLElement}
         */
    }

    function fix(self) {
        var originalEvent = self.originalEvent,
            l = props.length,
            prop,
            ct = originalEvent.currentTarget,
            ownerDoc = (ct.nodeType === 9) ? ct : (ct.ownerDocument || doc); // support iframe

        // clone properties of the original event object
        while (l) {
            prop = props[--l];
            self[prop] = originalEvent[prop];
        }

        // fix target property, if necessary
        if (!self.target) {
            self.target = self.srcElement || ownerDoc; // srcElement might not be defined either
        }

        // check if target is a text node (safari)
        if (self.target.nodeType === 3) {
            self.target = self.target.parentNode;
        }

        // add relatedTarget, if necessary
        if (!self.relatedTarget &amp;&amp; self.fromElement) {
            self.relatedTarget = (self.fromElement === self.target) ? self.toElement : self.fromElement;
        }

        // calculate pageX/Y if missing and clientX/Y available
        if (self.pageX === undefined &amp;&amp; self.clientX !== undefined) {
            var docEl = ownerDoc.documentElement, bd = ownerDoc.body;
            self.pageX = self.clientX + (docEl &amp;&amp; docEl.scrollLeft || bd &amp;&amp; bd.scrollLeft || 0) - (docEl &amp;&amp; docEl.clientLeft || bd &amp;&amp; bd.clientLeft || 0);
            self.pageY = self.clientY + (docEl &amp;&amp; docEl.scrollTop || bd &amp;&amp; bd.scrollTop || 0) - (docEl &amp;&amp; docEl.clientTop || bd &amp;&amp; bd.clientTop || 0);
        }

        // add which for key events
        if (self.which === undefined) {
            self.which = (self.charCode === undefined) ? self.keyCode : self.charCode;
        }

        // add metaKey to non-Mac browsers (use ctrl for PC's and Meta for Macs)
        if (self.metaKey === undefined) {
            self.metaKey = self.ctrlKey;
        }

        // add which for click: 1 === left; 2 === middle; 3 === right
        // Note: button is not normalized, so don't use it
        if (!self.which &amp;&amp; self.button !== undefined) {
            self.which = (self.button &amp; 1 ? 1 : (self.button &amp; 2 ? 3 : ( self.button &amp; 4 ? 2 : 0)));
        }
    }

    function fixMouseWheel(e) {
        var deltaX,
            deltaY,
            delta,
            detail = e.detail;

        if (e.wheelDelta) {
            delta = e.wheelDelta / 120;
        }
        if (e.detail) {
            // press control e.detail == 1 else e.detail == 3
            delta = -(detail % 3 == 0 ? detail / 3 : detail);
        }

        // Gecko
        if (e.axis !== undefined) {
            if (e.axis === e['HORIZONTAL_AXIS']) {
                deltaY = 0;
                deltaX = -1 * delta;
            } else if (e.axis === e['VERTICAL_AXIS']) {
                deltaX = 0;
                deltaY = delta;
            }
        }

        // Webkit
        if (e['wheelDeltaY'] !== undefined) {
            deltaY = e['wheelDeltaY'] / 120;
        }
        if (e['wheelDeltaX'] !== undefined) {
            deltaX = -1 * e['wheelDeltaX'] / 120;
        }

        // 默认 deltaY ( ie )
        if (!deltaX &amp;&amp; !deltaY) {
            deltaY = delta;
        }
        if (deltaX !== undefined ||
            deltaY !== undefined ||
            delta !== undefined) {
            S.mix(e, {
<span id='KISSY-Event-DOMEventObject-property-deltaY'>                /**
</span>                 * deltaY of mousewheel event
                 * @property deltaY
                 */
                deltaY: deltaY,
<span id='KISSY-Event-DOMEventObject-property-delta'>                /**
</span>                 * delta of mousewheel event
                 * @property delta
                 */
                delta: delta,
<span id='KISSY-Event-DOMEventObject-property-deltaX'>                /**
</span>                 * deltaX of mousewheel event
                 * @property deltaX
                 */
                deltaX: deltaX
            });
        }
    }

    S.extend(DOMEventObject, Event._Object, {

        constructor: DOMEventObject,

        preventDefault: function () {
            var e = this.originalEvent;

            // if preventDefault exists run it on the original event
            if (e.preventDefault) {
                e.preventDefault();
            }
            // otherwise set the returnValue property of the original event to FALSE (IE)
            else {
                e.returnValue = FALSE;
            }

            DOMEventObject.superclass.preventDefault.call(this);
        },

        stopPropagation: function () {
            var e = this.originalEvent;

            // if stopPropagation exists run it on the original event
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            // otherwise set the cancelBubble property of the original event to TRUE (IE)
            else {
                e.cancelBubble = TRUE;
            }

            DOMEventObject.superclass.stopPropagation.call(this);
        }
    });

    S.EventObject = DOMEventObject;

    return DOMEventObject;

}, {
    requires: ['event/base']
});

/*
 2012-10-30
 - consider touch properties

 2012-10-24
 - merge with mousewheel: not perfect in osx : accelerated scroll

 2010.04
 - http://www.w3.org/TR/2003/WD-DOM-Level-3-Events-20030331/ecma-script-binding.html

 - refer:
 https://github.com/brandonaaron/jquery-mousewheel/blob/master/jquery.mousewheel.js
 http://www.planabc.net/2010/08/12/mousewheel_event_in_javascript/
 http://www.switchonthecode.com/tutorials/javascript-tutorial-the-scroll-wheel
 http://stackoverflow.com/questions/5527601/normalizing-mousewheel-speed-across-browsers/5542105#5542105
 http://www.javascriptkit.com/javatutors/onmousewheel.shtml
 http://www.adomas.org/javascript-mouse-wheel/
 http://plugins.jquery.com/project/mousewheel
 http://www.cnblogs.com/aiyuchen/archive/2011/04/19/2020843.html
 http://www.w3.org/TR/DOM-Level-3-Events/#events-mousewheelevents
 */</pre>
</body>
</html>
