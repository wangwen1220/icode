define("arale/iframe-uploader/0.9.0/iframe-uploader",["gallery/jquery/1.7.2/jquery"],function(e,t,n){function s(e){if(!(this instanceof s))return new s(e);o(e)&&(e={trigger:e});var t={trigger:null,name:null,action:null,data:null,accept:null,change:null,error:null,success:null};e&&i.extend(t,e);var n=i(t.trigger);t.action=t.action||n.data("action")||"/upload",t.name=t.name||n.data("name")||"file",t.data=t.data||a(n.data("data")),t.accept=t.accept||n.data("accept"),t.success=t.success||n.data("success"),this.settings=t,this.setup(),this.bind()}function o(e){return Object.prototype.toString.call(e)==="[object String]"}function u(e){if(!e)return[];var t=[],n;for(var r in e)n=document.createElement("input"),n.type="hidden",n.name=r,n.value=e[r],t.push(n);return t}function a(e){if(!e)return{};var t={},n=e.split("&"),r=function(e){return decodeURIComponent(e.replace(/\+/g," "))};for(var i=0;i<n.length;i++){var s=n[i].split("="),o=r(s[0]),u=r(s[1]);t[o]=u}return t}var r=this,i=r.jQuery||e("gallery/jquery/1.7.2/jquery");s.prototype.setup=function(){var e="iframe-uploader-"+(new Date).getTime();this.iframe=i('<iframe name="'+e+'" />').hide(),this.form=i('<form method="post" enctype="multipart/form-data"target="'+e+'" '+'action="'+this.settings.action+'" />'),this.form.append(u(this.settings.data));var t=document.createElement("input");t.type="file",t.name=this.settings.name,this.settings.accept&&(t.accept=this.settings.accept),this.input=i(t);var n=i(this.settings.trigger);return this.input.attr("hidefocus",!0).css({position:"absolute",top:0,right:0,opacity:0,outline:0,cursor:"pointer",height:n.outerHeight(),fontSize:Math.max(64,n.outerHeight()*5)}),this.form.append(this.input),this.form.css({position:"absolute",top:n.offset().top,left:n.offset().left,overflow:"hidden",width:n.outerWidth(),height:n.outerHeight()}).appendTo("body"),this},s.prototype.bind=function(){var e=this,t=i(e.settings.trigger);t.mouseenter(function(){e.form.css({top:t.offset().top,left:t.offset().left,width:t.outerWidth(),height:t.outerHeight()})}),e.input.change(function(){var t=e.input.val();if(e.settings.change)t&&(t=t.substr(t.lastIndexOf("\\")+1)),e.settings.change(t);else if(t)return e.submit()})},s.prototype.submit=function(){var e=this;return i("body").append(e.iframe),e.iframe.on("load",function(){var t=e.iframe.contents().find("body").html();e.iframe.off("load").remove(),t?e.settings.success&&e.settings.success(t):e.settings.error&&e.settings.error(e.input.val())}),e.form.submit(),this},s.prototype.change=function(e){return e?(this.settings.change=e,this):this},s.prototype.success=function(e){return e?(this.settings.success=e,this):this},s.prototype.error=function(e){return e?(this.settings.error=e,this):this},n.exports=s});