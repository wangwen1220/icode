define("arale/messenger/1.0.0/messenger",["$"],function(e,t,n){function i(e){var t=e.target||parent;try{r.isWindow(t)||(t=r(t).get(0),t&&t.tagName==="IFRAME"&&(t=t.contentWindow))}catch(n){}this.win=t,this.onmessage=e.onmessage||function(){},this.init()}var r=e("$");i.prototype.init=function(){var e=this,t=function(t){if(t.source!=e.win)return;(e.onmessage||function(){}).call(e,t.data)};window.addEventListener?window.addEventListener("message",t,!1):window.attachEvent&&window.attachEvent("onmessage",t)},i.prototype.send=function(e){this.win.postMessage(e,"*")},!window.postMessage&&window.attachEvent&&(i.prototype.init=function(){var e=!1;try{e=!!this.win.location.href}catch(t){}if(e){this.send=this.sendForSameOrigin,this.initForSameOrigin();return}this.queue=[],window.parent==this.win?this.initForParent():this.initForFrame()},i.prototype.initForSameOrigin=function(){var e=this;document.attachEvent("ondataavailable",function(t){if(!t.eventType||t.eventType!=="message"||t.eventSource!=e.win)return;(e.onmessage||function(){}).call(e,t.eventData)})},i.prototype.sendForSameOrigin=function(e){var t=this;setTimeout(function(){var n=t.win.document.createEventObject();n.eventType="message",n.eventSource=window,n.eventData=e,t.win.document.fireEvent("ondataavailable",n)})},i.prototype.initForParent=function(){var e=document.createDocumentFragment(),t="width: 1px; height: 1px; position: absolute; left: -999px; top: -999px;",n=document.createElement("iframe");n.style.cssText=t,e.appendChild(n);var r=document.createElement("iframe");r.style.cssText=t,e.appendChild(r),document.body.insertBefore(e,document.body.firstChild),this.senderWin=n.contentWindow,this.receiverWin=r.contentWindow,this.startReceive()},i.prototype.initForFrame=function(){this.senderWin=null,this.receiverWin=null;var e=this;this.timerId=setInterval(function(){e.waitForFrame()},50)},i.prototype.waitForFrame=function(){var e,t;try{e=this.win[1],t=this.win[0]}catch(n){}if(!e||!t)return;clearInterval(this.timerId),this.senderWin=e,this.receiverWin=t,this.queue.length&&this.flush(),this.startReceive()},i.prototype.startReceive=function(){var e=this;this.timerId=setInterval(function(){e.tryReceive()},50)},i.prototype.tryReceive=function(){try{this.receiverWin.name;return}catch(e){}this.receiverWin.location.replace("about:blank");var t=this;setTimeout(function(){t.receive()},0)},i.prototype.receive=function(){var e=null;try{e=this.receiverWin.name}catch(t){}if(!e)return;this.receiverWin.name="";var n=this,r=e.substring(1).split("|");for(var i=0;i<r.length;i++)(function(){var e=decodeURIComponent(r[i]);setTimeout(function(){(n.onmessage||function(){}).call(n,e)},0)})()},i.prototype.send=function(e){this.queue.push(e);if(!this.senderWin)return;this.flush()},i.prototype.flush=function(){var e=[];for(var t=0;t<this.queue.length;t++)e[t]=encodeURIComponent(this.queue[t]);var n="|"+e.join("|");try{this.senderWin.name+=n,this.queue.length=0}catch(r){this.senderWin.location.replace("about:blank");var i=this;setTimeout(function(){i.flush()},0)}}),n.exports=i});